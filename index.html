<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Navigator - Problem Tracker</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    
    <!-- AG Grid CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/styles/ag-theme-alpine-dark.css">
    
    <style>
        :root {
            --accent-color: #ffffff; /* White */
            --accent-hover: #e2e8f0; /* Light gray on hover */
            --secondary-color: #f9fafb;
            --border-color: #334155;
            --header-bg: #1e293b;
            --sidebar-bg: #0f172a;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            --easy-color: #10b981; /* Changed to more subtle teal-green */
            --easy-color-dark: #0d9488; /* Darker variant for hover states */
            --medium-color: #f59e0b;
            --hard-color: #ef4444;
            --expired-color: #ef4444;
            --text-muted: #94a3b8;
            --text-color: #f1f5f9;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --accent-text: #10b981; /* Matching accent text color */
            --primary-color: var(--accent-color);
            --primary-hover: var(--accent-hover);
            --high-priority: #ef4444;
            --medium-priority: #f59e0b;
            --low-priority: #3b82f6;
        }
        
        /* Base Reset & Typography */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
        }
        
        /* Rotation Animation */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes colorChange {
            0% { stroke: #ffffff; }    /* White */
            25% { stroke: #22c55e; }   /* Green */
            50% { stroke: #3b82f6; }   /* Blue */
            75% { stroke: #facc15; }   /* Yellow */
            100% { stroke: #ffffff; }  /* Back to White */
        }
        
        /* Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background-color: var(--header-bg);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            z-index: 50;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .compass-icon {
            display: inline-block;
            margin: 0 8px;
            animation: rotate 4s linear infinite;
            transform-origin: center;
        }
        
        .compass-icon svg {
            stroke: var(--accent-color);
            animation: colorChange 4s linear infinite;
            display: block;
        }
        
        .app-logo h1 {
            display: flex;
            align-items: center;
            gap: 0px;
            margin: 0;
            font-size: 1.2rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
        }
        
        /* Auth Container */
        .auth-container {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-btn {
            background-color: #333;
            color: #ddd;
            border: 1px solid #555;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        
        .auth-btn:hover {
            background-color: #444;
        }
        
        /* Main Content Area */
        .main-content {
            margin-top: 64px;
            padding: 1.5rem;
        }
        
        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        /* Stats Section */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        .stat-value {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .total-value { color: white; }
        .completed-value { color: var(--easy-color); }
        .review-value { color: var(--accent-text); }
        .pending-value { color: var(--medium-color); }
        .today-value { color: var(--hard-color); }
        .priority-value { color: var(--accent-text); }
        
        /* Study Planner */
        .planner-row {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        .planner-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-text);
        }
        
        .planner-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .planner-input {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            color: white;
            padding: 0.25rem 0.5rem;
            width: 4rem;
            font-size: 0.875rem;
        }
        
        .planner-days {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .planner-btn {
            background-color: var(--easy-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .planner-btn:hover {
            background-color: var(--easy-color-dark);
        }
        
        /* Priority Checkboxes */
        .priority-filters {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-right: 1rem;
        }
        
        .priority-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .priority-check input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 1rem;
            height: 1rem;
            border-radius: 3px;
            border: 2px solid var(--border-color);
            outline: none;
            cursor: pointer;
            position: relative;
        }
        
        .priority-check input[type="checkbox"]:checked {
            background-color: var(--easy-color);
            border-color: var(--easy-color);
        }
        
        .priority-check input[type="checkbox"]:checked::after {
            content: "âœ“";
            position: absolute;
            top: -3px;
            left: 1px;
            color: white;
            font-size: 11px;
        }
        
        .priority-check.high input[type="checkbox"]:checked {
            background-color: var(--high-priority);
            border-color: var(--high-priority);
        }
        
        .priority-check.medium input[type="checkbox"]:checked {
            background-color: var(--medium-priority);
            border-color: var(--medium-priority);
        }
        
        .priority-check.low input[type="checkbox"]:checked {
            background-color: var(--low-priority);
            border-color: var(--low-priority);
        }
        
        .priority-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .priority-label.high {
            color: var(--high-priority);
        }
        
        .priority-label.medium {
            color: var(--medium-priority);
        }
        
        .priority-label.low {
            color: var(--low-priority);
        }
        
        /* View Tabs */
        .view-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .view-tab {
            background-color: var(--card-bg);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .view-tab:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .view-tab.active {
            background-color: var(--easy-color);
            color: white;
            border-color: var(--easy-color);
            font-weight: 500;
        }
        
        .revision-count {
            background-color: var(--easy-color);
            color: white;
            border-radius: 9999px;
            padding: 0.125rem 0.375rem;
            font-size: 0.625rem;
            font-weight: 500;
        }
        
        /* Problems Table */
        .problems-container {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            height: calc(100vh - 250px);
            overflow-y: auto;
        }
        
        .problems-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .problems-table th {
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-muted);
            font-weight: 500;
            text-align: left;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .problems-table td {
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        .problems-table tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        /* Problem Status */
        .status-checkbox {
            width: 1.125rem;
            height: 1.125rem;
            border-radius: 0.25rem;
            border: 2px solid var(--border-color);
            display: inline-block;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .status-checkbox.completed {
            background-color: var(--easy-color);
            border-color: var(--easy-color);
        }
        
        .status-checkbox.completed:after {
            content: "âœ“";
            position: absolute;
            top: -3px;
            left: 2px;
            color: white;
            font-size: 11px;
            font-weight: normal;
        }
        
        /* Problem Link */
        .problem-link {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .problem-link:hover {
            color: var(--accent-text);
        }
        
        /* Difficulty Tags */
        .difficulty-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .difficulty-tag.easy {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--easy-color);
        }
        
        .difficulty-tag.medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--medium-color);
        }
        
        .difficulty-tag.hard {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--hard-color);
        }
        
        /* Priority Tag */
        .priority-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .priority-tag.high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--high-priority);
        }
        
        .priority-tag.medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--medium-priority);
        }
        
        .priority-tag.low {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--low-priority);
        }
        
        /* Due Date */
        .due-date {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .due-date.expired {
            color: var(--expired-color);
            font-weight: 500;
        }
        
        /* Action Buttons */
        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--accent-text);
        }
        
        .action-btn.marked {
            color: var(--accent-text);
        }
        
        .action-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        /* Category Style */
        .category-tag {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
        
        /* AG Grid Custom Styles */
        .ag-theme-alpine-dark {
            --ag-background-color: var(--card-bg);
            --ag-foreground-color: var(--text-color);
            --ag-border-color: var(--border-color);
            --ag-header-background-color: rgba(0, 0, 0, 0.2);
            --ag-row-hover-color: rgba(255, 255, 255, 0.03);
            --ag-header-foreground-color: var(--text-muted);
            --ag-font-size: 0.875rem;
            --ag-font-family: 'Inter', sans-serif;
        }

        /* Table footer */
        .table-footer {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pagination {
            display: flex;
            gap: 0.25rem;
        }
        
        .pagination-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .pagination-btn.active {
            background-color: var(--easy-color);
            color: white;
            border-color: var(--easy-color);
            font-weight: 500;
        }
        
        /* Notes Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            overflow: auto;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 1.5rem;
            border-radius: 0.5rem;
            width: 60%;
            max-width: 700px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--text-muted);
            background: transparent;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: white;
        }
        
        .notes-textarea {
            width: 100%;
            height: 200px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: white;
            padding: 0.75rem;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: 1rem;
        }
        
        .save-notes {
            background-color: var(--easy-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .save-notes:hover {
            background-color: var(--easy-color-dark);
        }
        
        /* Notes View */
        .notes-view {
            display: none;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            height: calc(100vh - 250px);
        }
        
        .note-card {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .note-title {
            font-weight: 600;
        }
        
        .note-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .note-content {
            padding: 0.5rem 0;
            border-top: 1px solid var(--border-color);
            margin-top: 0.5rem;
            white-space: pre-wrap;
        }
        
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            padding: 1rem;
            overflow-y: auto;
            max-height: calc(100vh - 250px);
        }
        
        /* Firebase Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--easy-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.error {
            background-color: var(--hard-color);
        }
        /* Updated Stats Section CSS */
.stats-row {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 0.5rem;
    margin-bottom: 0.75rem; /* Reduced margin */
}

.stat-card {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    padding: 0.35rem; /* Reduced padding */
    text-align: center;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    font-size: 0.875rem; /* Smaller font size */
}

.stat-value {
    font-size: 1rem; /* Reduced from 1.125rem */
    font-weight: 600;
    margin-bottom: 0.15rem; /* Reduced margin */
}

.stat-label {
    font-size: 0.7rem; /* Reduced from 0.75rem */
    color: var(--text-muted);
}
        /* Problems Table - increased height */
.problems-container {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    height: calc(100vh - 215px); /* Increased from 250px */
    overflow-y: auto;
}

/* Notes View - match the problems container height */
.notes-view {
    display: none;
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    height: calc(100vh - 215px); /* Increased from 250px */
}

.notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
    padding: 1rem;
    overflow-y: auto;
    max-height: calc(100vh - 215px); /* Increased from 250px */
}
        /* Study Planner - more compact */
.planner-row {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    padding: 0.5rem 1rem; /* Reduced from 0.75rem */
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem; /* Reduced from 1rem */
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
}

/* View Tabs - more compact */
.view-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem; /* Reduced from 1rem */
}

.view-tab {
    background-color: var(--card-bg);
    color: var(--text-muted);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    padding: 0.35rem 0.75rem; /* Reduced from 0.5rem 1rem */
    font-size: 0.7rem; /* Reduced from 0.75rem */
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
}
        .reset-plan-btn {
    background-color: rgba(239, 68, 68, 0.2);
    color: var(--high-priority);
    border: 1px solid var(--high-priority);
    border-radius: 0.25rem;
    padding: 0.25rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    margin-left: 1rem;
}

.reset-plan-btn:hover {
    background-color: rgba(239, 68, 68, 0.3);
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="app-logo">
            <h1>
                <span>Tech</span>
                <div class="compass-icon">
                    <svg fill="none" height="28" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="28" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M16.24 7.76l-2.12 6.36-6.36 2.12 2.12-6.36 6.36-2.12z"></path>
                    </svg>
                </div>
                <span>Navigator</span>
            </h1>
        </div>
        <div class="auth-container">
            <button class="auth-btn" id="authBtn">
                <img alt="Google" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width: 18px; margin-right: 8px;"/>
                Sign in
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Stats Section -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value total-value" id="totalProblems">175</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value completed-value" id="completedProblems">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value review-value" id="reviewProblems">0</div>
                <div class="stat-label">Review</div>
            </div>
            <div class="stat-card">
                <div class="stat-value pending-value" id="pendingProblems">175</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-value today-value" id="todayProblems">0</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="highPriorityStats">0/95</div>
                <div class="stat-label">High</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="mediumPriorityStats">0/60</div>
                <div class="stat-label">Medium</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="lowPriorityStats">0/20</div>
                <div class="stat-label">Low</div>
            </div>
        </div>
        
        <!-- Study Planner -->
        <div class="planner-row">
            <div class="planner-title">Study Planner</div>
            <div class="planner-controls">
                <div class="priority-filters">
                    <label class="priority-check high">
                        <input type="checkbox" checked id="highPriorityCheck">
                        <span class="priority-label high">High</span>
                    </label>
                    <label class="priority-check medium">
                        <input type="checkbox" checked id="mediumPriorityCheck">
                        <span class="priority-label medium">Medium</span>
                    </label>
                    <label class="priority-check low">
                        <input type="checkbox" checked id="lowPriorityCheck">
                        <span class="priority-label low">Low</span>
                    </label>
                </div>
                <input type="number" class="planner-input" id="plannerDays" value="30" min="1">
                <span class="planner-days">days</span>
                <button class="planner-btn" id="generatePlanBtn">Generate</button>
                <button class="reset-plan-btn" id="resetPlanBtn">Reset Plan</button>
            </div>
        </div>
        
        <!-- View Tabs -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="all">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 6h13"></path>
                    <path d="M8 12h13"></path>
                    <path d="M8 18h13"></path>
                    <path d="M3 6h.01"></path>
                    <path d="M3 12h.01"></path>
                    <path d="M3 18h.01"></path>
                </svg>
                All Problems (<span id="allCount">175</span>)
            </button>
            <button class="view-tab" data-view="today">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Today (<span id="todayCount">0</span>)
            </button>
            <button class="view-tab" data-view="completed">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                Completed (<span id="completedCount">0</span>)
            </button>
            <button class="view-tab" data-view="review">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 11 12 14 22 4"></polyline>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                For Review (<span id="reviewCount">0</span>)
            </button>
            <button class="view-tab" data-view="pending">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                    <polyline points="13 2 13 9 20 9"></polyline>
                </svg>
                Pending (<span id="pendingCount">175</span>)
            </button>
            <button class="view-tab" data-view="notes">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <path d="M14 2v6h6"></path>
                    <path d="M16 13H8"></path>
                    <path d="M16 17H8"></path>
                    <path d="M10 9H8"></path>
                </svg>
                Notes (<span id="notesCount">0</span>)
            </button>
        </div>
        
        <!-- Problems Table -->
        <div class="problems-container" id="problemsContainer">
            <table class="problems-table" id="problemsTable">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Problem</th>
                        <th>Category</th>
                        <th>Difficulty</th>
                        <th>Priority</th>
                        <th>Due Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="problemsTableBody">
                    <!-- Table rows will be added here dynamically -->
                </tbody>
            </table>
            
            <!-- Table Footer with Pagination -->
            <div class="table-footer">
                <div id="tableInfo">Showing 0 of 175 problems</div>
                <div class="pagination" id="pagination">
                <button class="pagination-btn" id="prevPageBtn">Prev</button>
                <!-- Page buttons will be generated dynamically -->
                <button class="pagination-btn" id="nextPageBtn">Next</button>
            </div>
            </div>
        </div>
        
        <!-- Notes View -->
        <div class="notes-view" id="notesView">
            <div class="notes-grid" id="notesGrid">
                <!-- Notes will be populated here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Notes Modal -->
    <div class="modal" id="notesModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h3 class="modal-title" id="problemTitle">Problem Notes</h3>
            <textarea class="notes-textarea" id="notesTextarea" placeholder="Add your notes here..."></textarea>
            <button class="save-notes" id="saveNotesBtn">Save Notes</button>
        </div>
    </div>
    
    <!-- Toast Message -->
    <div class="toast" id="toast"></div>

    <!-- AG Grid JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/dist/ag-grid-community.min.js"></script>
    
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth-compat.js"></script>
    
    <script>
        // JavaScript code will go here
        // Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyBnbrX52t_Y2QgJv5nNA4xeb0ZX94_kKeY",
  authDomain: "technavigator-8ecd1.firebaseapp.com",
  projectId: "technavigator-8ecd1",
  storageBucket: "technavigator-8ecd1.firebasestorage.app",
  messagingSenderId: "316020740391",
  appId: "1:316020740391:web:2f3ba461d5a179154cd902",
  measurementId: "G-WE013C9L92"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Main data store and application state
let problems = []; // Will be populated from paste.txt data
let userProblems = []; // Will store user-specific problem data from Firebase
let currentUser = null;
let currentView = 'all';
let currentPage = 1;
const itemsPerPage = 20;
let problemsToShow = [];
let notesData = []; // Stores user notes

// DOM Elements
const authBtn = document.getElementById('authBtn');
const problemsContainer = document.getElementById('problemsContainer');
const notesView = document.getElementById('notesView');
const problemsTableBody = document.getElementById('problemsTableBody');
const tableInfo = document.getElementById('tableInfo');
const pagination = document.getElementById('pagination');
const prevPageBtn = document.getElementById('prevPageBtn');
const nextPageBtn = document.getElementById('nextPageBtn');
const notesModal = document.getElementById('notesModal');
const closeModal = document.getElementById('closeModal');
const problemTitle = document.getElementById('problemTitle');
const notesTextarea = document.getElementById('notesTextarea');
const saveNotesBtn = document.getElementById('saveNotesBtn');
const notesGrid = document.getElementById('notesGrid');
const generatePlanBtn = document.getElementById('generatePlanBtn');
const plannerDays = document.getElementById('plannerDays');
const highPriorityCheck = document.getElementById('highPriorityCheck');
const mediumPriorityCheck = document.getElementById('mediumPriorityCheck');
const lowPriorityCheck = document.getElementById('lowPriorityCheck');
const viewTabs = document.querySelectorAll('.view-tab');
const toast = document.getElementById('toast');

// Counter elements
const totalProblemsEl = document.getElementById('totalProblems');
const completedProblemsEl = document.getElementById('completedProblems');
const reviewProblemsEl = document.getElementById('reviewProblems');
const pendingProblemsEl = document.getElementById('pendingProblems');
const todayProblemsEl = document.getElementById('todayProblems');
const highPriorityStatsEl = document.getElementById('highPriorityStats');
const mediumPriorityStatsEl = document.getElementById('mediumPriorityStats');
const lowPriorityStatsEl = document.getElementById('lowPriorityStats');

// Tab count elements
const allCountEl = document.getElementById('allCount');
const todayCountEl = document.getElementById('todayCount');
const completedCountEl = document.getElementById('completedCount');
const reviewCountEl = document.getElementById('reviewCount');
const pendingCountEl = document.getElementById('pendingCount');
const notesCountEl = document.getElementById('notesCount');

// Load problems data from the variable in paste.txt
function loadProblemsData() {
    // This is the data from paste.txt
    // Include the full problems data from paste.txt
    
// Main data store - initializing these variables at the top level
const problems = [
{"id":1,"problem":"Group Anagrams","number":49,"category":"Arrays & Hashing","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/group-anagrams/"},
{"id":2,"problem":"Product of Array Except Self","number":238,"category":"Arrays & Hashing","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/product-of-array-except-self/"},
{"id":3,"problem":"Valid Sudoku","number":36,"category":"Arrays & Hashing","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/valid-sudoku/"},
{"id":4,"problem":"Longest Consecutive Sequence","number":128,"category":"Arrays & Hashing","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/longest-consecutive-sequence/"},
{"id":5,"problem":"3Sum","number":15,"category":"Two Pointers","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/3sum/"},
{"id":6,"problem":"Container With Most Water","number":11,"category":"Two Pointers","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/container-with-most-water/"},
{"id":7,"problem":"Trapping Rain Water","number":42,"category":"Two Pointers","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/trapping-rain-water/"},
{"id":8,"problem":"Longest Substring Without Repeating Characters","number":3,"category":"Sliding Window","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/longest-substring-without-repeating-characters/"},
{"id":9,"problem":"Longest Repeating Character Replacement","number":424,"category":"Sliding Window","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/longest-repeating-character-replacement/"},
{"id":10,"problem":"Minimum Window Substring","number":76,"category":"Sliding Window","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/minimum-window-substring/"},
{"id":11,"problem":"Sliding Window Maximum","number":239,"category":"Sliding Window","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/sliding-window-maximum/"},
{"id":12,"problem":"Min Stack","number":155,"category":"Stack","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/min-stack/"},
{"id":13,"problem":"Generate Parentheses","number":22,"category":"Stack","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/generate-parentheses/"},
{"id":14,"problem":"Daily Temperatures","number":739,"category":"Stack","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/daily-temperatures/"},
{"id":15,"problem":"Largest Rectangle in Histogram","number":84,"category":"Stack","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/largest-rectangle-in-histogram/"},
{"id":16,"problem":"Koko Eating Bananas","number":875,"category":"Binary Search","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/koko-eating-bananas/"},
{"id":17,"problem":"Search in Rotated Sorted Array","number":33,"category":"Binary Search","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/search-in-rotated-sorted-array/"},
{"id":18,"problem":"Find Minimum in Rotated Sorted Array","number":153,"category":"Binary Search","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/"},
{"id":19,"problem":"Median of Two Sorted Arrays","number":4,"category":"Binary Search","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/median-of-two-sorted-arrays/"},
{"id":20,"problem":"Reorder List","number":143,"category":"Linked List","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/reorder-list/"},
{"id":21,"problem":"Remove Nth Node From End of List","number":19,"category":"Linked List","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/remove-nth-node-from-end-of-list/"},
{"id":22,"problem":"Add Two Numbers","number":2,"category":"Linked List","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/add-two-numbers/"},
{"id":23,"problem":"Merge k Sorted Lists","number":23,"category":"Linked List","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/merge-k-sorted-lists/"},
{"id":24,"problem":"Reverse Nodes in k-Group","number":25,"category":"Linked List","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/reverse-nodes-in-k-group/"},
{"id":25,"problem":"Binary Tree Right Side View","number":199,"category":"Trees","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/binary-tree-right-side-view/"},
{"id":26,"problem":"Binary Tree Maximum Path Sum","number":124,"category":"Trees","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/binary-tree-maximum-path-sum/"},
{"id":27,"problem":"Kth Largest Element in an Array","number":215,"category":"Heap / Priority Queue","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/kth-largest-element-in-an-array/"},
{"id":28,"problem":"Task Scheduler","number":621,"category":"Heap / Priority Queue","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/task-scheduler/"},
{"id":29,"problem":"Letter Combinations of a Phone Number","number":17,"category":"Backtracking","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/letter-combinations-of-a-phone-number/"},
{"id":30,"problem":"N-Queens","number":51,"category":"Backtracking","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/n-queens/"},
{"id":31,"problem":"Subsets","number":78,"category":"Backtracking","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/subsets/"},
{"id":32,"problem":"Subsets II","number":90,"category":"Backtracking","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/subsets-ii/"},
{"id":33,"problem":"Number of Islands","number":200,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/number-of-islands/"},
{"id":34,"problem":"Pacific Atlantic Water Flow","number":417,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/pacific-atlantic-water-flow/"},
{"id":35,"problem":"Course Schedule","number":207,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/course-schedule/"},
{"id":36,"problem":"Network Delay Time","number":743,"category":"Advanced Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/network-delay-time/"},
{"id":37,"problem":"Cheapest Flights Within K Stops","number":787,"category":"Advanced Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/cheapest-flights-within-k-stops/"},
{"id":38,"problem":"Maximum Subarray","number":53,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximum-subarray/"},
{"id":39,"problem":"Jump Game","number":55,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/jump-game/"},
{"id":40,"problem":"House Robber","number":198,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/house-robber/"},
{"id":41,"problem":"Longest Palindromic Substring","number":5,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/longest-palindromic-substring/"},
{"id":42,"problem":"Maximum Product Subarray","number":152,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximum-product-subarray/"},
{"id":43,"problem":"Word Break","number":139,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/word-break/"},
{"id":44,"problem":"Longest Increasing Subsequence","number":300,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/longest-increasing-subsequence/"},
{"id":45,"problem":"Unique Paths","number":62,"category":"2D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/unique-paths/"},
{"id":46,"problem":"Target Sum","number":494,"category":"2D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/target-sum/"},
{"id":47,"problem":"Edit Distance","number":72,"category":"2D Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/edit-distance/"},
{"id":48,"problem":"Merge Intervals","number":56,"category":"Intervals","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/merge-intervals/"},
{"id":49,"problem":"Meeting Rooms II","number":253,"category":"Intervals","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/meeting-rooms-ii/"},
{"id":50,"problem":"Rotate Image","number":48,"category":"Math & Geometry","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/rotate-image/"},
{"id":51,"problem":"Spiral Matrix","number":54,"category":"Math & Geometry","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/spiral-matrix/"},
{"id":52,"problem":"Set Matrix Zeroes","number":73,"category":"Math & Geometry","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/set-matrix-zeroes/"},
{"id":53,"problem":"Pow(x, n)","number":50,"category":"Math & Geometry","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/powx-n/"},
{"id":54,"problem":"LRU Cache","number":146,"category":"Design","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/lru-cache/"},
{"id":55,"problem":"Time Based Key-Value Store","number":981,"category":"Design","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/time-based-key-value-store/"},
{"id":56,"problem":"Design Search Autocomplete System","number":642,"category":"Design","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/design-search-autocomplete-system/"},
{"id":57,"problem":"Logger Rate Limiter","number":359,"category":"Design","difficulty":"Easy","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/logger-rate-limiter/"},
{"id":58,"problem":"Finding MK Average","number":1825,"category":"Design","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/finding-mk-average/"},
{"id":59,"problem":"Range Sum Query - Immutable","number":303,"category":"Design","difficulty":"Easy","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/range-sum-query-immutable/"},
{"id":60,"problem":"Design Hit Counter","number":362,"category":"Design","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/design-hit-counter/"},
{"id":61,"problem":"Design In-Memory File System","number":588,"category":"Design","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/design-in-memory-file-system/"},
{"id":62,"problem":"Detect Squares","number":2013,"category":"Design","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/detect-squares/"},
{"id":63,"problem":"Find Median from Data Stream","number":295,"category":"Design","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/find-median-from-data-stream/"},
{"id":64,"problem":"4Sum","number":18,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/4sum/"},
{"id":65,"problem":"First Missing Positive","number":41,"category":"Arrays & Hashing","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/first-missing-positive/"},
{"id":66,"problem":"Rotate Array","number":189,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/rotate-array/"},
{"id":67,"problem":"Text Justification","number":68,"category":"Arrays & Hashing","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/text-justification/"},
{"id":68,"problem":"String Compression","number":443,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/string-compression/"},
{"id":69,"problem":"Maximum Swap","number":670,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximum-swap/"},
{"id":70,"problem":"Insert Delete GetRandom O(1)","number":380,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/insert-delete-getrandom-o1/"},
{"id":71,"problem":"Sort Colors","number":75,"category":"Two Pointers","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/sort-colors/"},
{"id":72,"problem":"Next Permutation","number":31,"category":"Two Pointers","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/next-permutation/"},
{"id":73,"problem":"Subarray Sum Equals K","number":560,"category":"Sliding Window","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/subarray-sum-equals-k/"},
{"id":74,"problem":"Max Consecutive Ones III","number":1004,"category":"Sliding Window","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/max-consecutive-ones-iii/"},
{"id":75,"problem":"Decode String","number":394,"category":"Stack","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/decode-string/"},
{"id":76,"problem":"Basic Calculator","number":224,"category":"Stack","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/basic-calculator/"},
{"id":77,"problem":"Number of Visible People in a Queue","number":1944,"category":"Stack","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/number-of-visible-people-in-a-queue/"},
{"id":78,"problem":"Find First and Last Position of Element in Sorted Array","number":34,"category":"Binary Search","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/find-first-and-last-position-of-element-in-sorted-array/"},
{"id":79,"problem":"Find Peak Element","number":162,"category":"Binary Search","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/find-peak-element/"},
{"id":80,"problem":"Single Element in a Sorted Array","number":540,"category":"Binary Search","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/single-element-in-a-sorted-array/"},
{"id":81,"problem":"Split Array Largest Sum","number":410,"category":"Binary Search","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/split-array-largest-sum/"},
{"id":82,"problem":"Peak Index in a Mountain Array","number":852,"category":"Binary Search","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/peak-index-in-a-mountain-array/"},
{"id":83,"problem":"Find K Closest Elements","number":658,"category":"Binary Search","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/find-k-closest-elements/"},
{"id":84,"problem":"Linked List Cycle II","number":142,"category":"Linked List","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/linked-list-cycle-ii/"},
{"id":85,"problem":"Odd Even Linked List","number":328,"category":"Linked List","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/odd-even-linked-list/"},
{"id":86,"problem":"Lowest Common Ancestor of a Binary Tree","number":236,"category":"Trees","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/"},
{"id":87,"problem":"Search Suggestions System","number":1268,"category":"Tries","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/search-suggestions-system/"},
{"id":88,"problem":"Top K Frequent Words","number":692,"category":"Heap / Priority Queue","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/top-k-frequent-words/"},
{"id":89,"problem":"Number of Provinces","number":547,"category":"Graphs","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/number-of-provinces/"},
{"id":90,"problem":"Accounts Merge","number":721,"category":"Graphs","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/accounts-merge/"},
{"id":91,"problem":"Best Time to Buy and Sell Stock II","number":122,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii/"},
{"id":92,"problem":"Maximal Square","number":221,"category":"2D Dynamic Programming","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximal-square/"},
{"id":93,"problem":"Maximal Rectangle","number":85,"category":"2D Dynamic Programming","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximal-rectangle/"},
{"id":94,"problem":"Russian Doll Envelopes","number":354,"category":"2D Dynamic Programming","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/russian-doll-envelopes/"},
{"id":95,"problem":"Interval List Intersections","number":986,"category":"Intervals","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/interval-list-intersections/"},
{"id":96,"problem":"LFU Cache","number":460,"category":"Design","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/lfu-cache/"},
{"id":97,"problem":"Design Circular Queue","number":622,"category":"Design","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/design-circular-queue/"},
{"id":98,"problem":"Design Underground System","number":1396,"category":"Design","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/design-underground-system/"},
{"id":99,"problem":"Meeting Rooms III","number":2402,"category":"Design","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/meeting-rooms-iii/"},
{"id":100,"problem":"Snapshot Array","number":1146,"category":"Design","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/snapshot-array/"},
{"id":101,"problem":"Range Module","number":715,"category":"Design","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/range-module/"},
{"id":102,"problem":"Insert Delete GetRandom O(1) - Duplicates allowed","number":381,"category":"Design","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/insert-delete-getrandom-o1-duplicates-allowed/"},
{"id":103,"problem":"Prefix and Suffix Search","number":745,"category":"Design","difficulty":"Hard","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/prefix-and-suffix-search/"},
{"id":104,"problem":"Flatten Nested List Iterator","number":341,"category":"Design","difficulty":"Medium","priority":"Medium","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/flatten-nested-list-iterator/"},
{"id":105,"problem":"Two Sum","number":1,"category":"Arrays & Hashing","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/two-sum/"},
{"id":106,"problem":"Contains Duplicate","number":217,"category":"Arrays & Hashing","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/contains-duplicate/"},
{"id":107,"problem":"Valid Anagram","number":242,"category":"Arrays & Hashing","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/valid-anagram/"},
{"id":108,"problem":"Top K Frequent Elements","number":347,"category":"Arrays & Hashing","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/top-k-frequent-elements/"},
{"id":109,"problem":"Valid Palindrome","number":125,"category":"Two Pointers","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/valid-palindrome/"},
{"id":110,"problem":"Two Sum II - Input Array Is Sorted","number":167,"category":"Two Pointers","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/"},
{"id":111,"problem":"Best Time to Buy and Sell Stock","number":121,"category":"Sliding Window","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/best-time-to-buy-and-sell-stock/"},
{"id":112,"problem":"Valid Parentheses","number":20,"category":"Stack","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/valid-parentheses/"},
{"id":113,"problem":"Binary Search","number":704,"category":"Binary Search","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/binary-search/"},
{"id":114,"problem":"Reverse Linked List","number":206,"category":"Linked List","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/reverse-linked-list/"},
{"id":115,"problem":"Merge Two Sorted Lists","number":21,"category":"Linked List","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/merge-two-sorted-lists/"},
{"id":116,"problem":"Copy List with Random Pointer","number":138,"category":"Linked List","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/copy-list-with-random-pointer/"},
{"id":117,"problem":"Invert Binary Tree","number":226,"category":"Trees","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/invert-binary-tree/"},
{"id":118,"problem":"Maximum Depth of Binary Tree","number":104,"category":"Trees","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/maximum-depth-of-binary-tree/"},
{"id":119,"problem":"Binary Tree Level Order Traversal","number":102,"category":"Trees","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/binary-tree-level-order-traversal/"},
{"id":120,"problem":"Validate Binary Search Tree","number":98,"category":"Trees","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/validate-binary-search-tree/"},
{"id":121,"problem":"Kth Smallest Element in a BST","number":230,"category":"Trees","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/kth-smallest-element-in-a-bst/"},
{"id":122,"problem":"Serialize and Deserialize Binary Tree","number":297,"category":"Trees","difficulty":"Hard","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/serialize-and-deserialize-binary-tree/"},
{"id":123,"problem":"Implement Trie (Prefix Tree)","number":208,"category":"Tries","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/implement-trie-prefix-tree/"},
{"id":124,"problem":"Word Search II","number":212,"category":"Tries","difficulty":"Hard","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/word-search-ii/"},
{"id":125,"problem":"K Closest Points to Origin","number":973,"category":"Heap / Priority Queue","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/k-closest-points-to-origin/"},
{"id":126,"problem":"Combination Sum","number":39,"category":"Backtracking","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/combination-sum/"},
{"id":127,"problem":"Permutations","number":46,"category":"Backtracking","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/permutations/"},
{"id":128,"problem":"Word Search","number":79,"category":"Backtracking","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/word-search/"},
{"id":129,"problem":"Palindrome Partitioning","number":131,"category":"Backtracking","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/palindrome-partitioning/"},
{"id":130,"problem":"Clone Graph","number":133,"category":"Graphs","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/clone-graph/"},
{"id":131,"problem":"Rotting Oranges","number":994,"category":"Graphs","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/rotting-oranges/"},
{"id":132,"problem":"Course Schedule II","number":210,"category":"Graphs","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/course-schedule-ii/"},
{"id":133,"problem":"Alien Dictionary","number":269,"category":"Graphs","difficulty":"Hard","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/alien-dictionary/"},
{"id":134,"problem":"Min Cost to Connect All Points","number":1584,"category":"Advanced Graphs","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/min-cost-to-connect-all-points/"},
{"id":135,"problem":"Climbing Stairs","number":70,"category":"1D Dynamic Programming","difficulty":"Easy","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/climbing-stairs/"},
{"id":136,"problem":"Decode Ways","number":91,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/decode-ways/"},
{"id":137,"problem":"Coin Change","number":322,"category":"1D Dynamic Programming","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/coin-change/"},
{"id":138,"problem":"Regular Expression Matching","number":10,"category":"2D Dynamic Programming","difficulty":"Hard","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/regular-expression-matching/"},
{"id":139,"problem":"Insert Interval","number":57,"category":"Intervals","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/insert-interval/"},
{"id":140,"problem":"Non-overlapping Intervals","number":435,"category":"Intervals","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/non-overlapping-intervals/"},
{"id":141,"problem":"Reverse Integer","number":7,"category":"Bit Manipulation","difficulty":"Medium","priority":"Low","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/reverse-integer/"},
{"id":142,"problem":"Path With Maximum Minimum Value","number":1102,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/path-with-maximum-minimum-value/"},
{"id":143,"problem":"Open the Lock","number":752,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/open-the-lock/"},
{"id":144,"problem":"Bus Routes","number":815,"category":"Graphs","difficulty":"Hard","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/bus-routes/"},
{"id":145,"problem":"Can I Win","number":464,"category":"Dynamic Programming","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/can-i-win/"},
{"id":146,"problem":"Detonate the Maximum Bombs","number":2101,"category":"Graphs","difficulty":"Medium","priority":"High","status":"Not Started","lastAttempt":"","notes":"","leetCodeUrl":"https://leetcode.com/problems/detonate-the-maximum-bombs/"}
]

    // Set up initial user problems based on master data
    userProblems = problems.map(problem => ({
        ...problem,
        status: "Not Started",
        forReview: false,
        dueDate: null,
        userNotes: ""
    }));

    // Initialize the view with the data
    updateStats();
    showProblems(currentView);
}

// Authentication functions
function setupAuth() {
    authBtn.addEventListener('click', () => {
        if (currentUser) {
            // User is signed in, sign out
            auth.signOut()
                .then(() => {
                    showToast('Successfully signed out');
                })
                .catch(error => {
                    showToast('Error signing out: ' + error.message, true);
                });
        } else {
            // User is not signed in, sign in
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .catch(error => {
                    showToast('Error signing in: ' + error.message, true);
                });
        }
    });

    // Listen for auth state changes
    auth.onAuthStateChanged(user => {
        currentUser = user;
        if (user) {
            authBtn.innerHTML = `
                <img src="${user.photoURL || ''}" alt="${user.displayName || 'User'}" style="width: 18px; height: 18px; border-radius: 50%; margin-right: 8px;">
                Sign Out
            `;
            loadUserData();
        } else {
            authBtn.innerHTML = `
                <img alt="Google" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width: 18px; margin-right: 8px;"/>
                Sign in
            `;
            // Reset to default data when signed out
            userProblems = problems.map(problem => ({
                ...problem,
                status: "Not Started",
                forReview: false,
                dueDate: null,
                userNotes: ""
            }));
            notesData = [];
            updateStats();
            showProblems(currentView);
        }
    });
}

// Firebase data functions
function loadUserData() {
    if (!currentUser) return;

    const userRef = db.collection('users').doc(currentUser.uid);
    
    // Get user problems data
    userRef.collection('problems').get()
        .then(snapshot => {
            if (!snapshot.empty) {
                const data = {};
                snapshot.forEach(doc => {
                    data[doc.id] = doc.data();
                });
                
                // Update userProblems with user-specific data
                userProblems = problems.map(problem => {
                    const userData = data[problem.id.toString()] || {};
                    return {
                        ...problem,
                        status: userData.status || "Not Started",
                        forReview: userData.forReview || false,
                        dueDate: userData.dueDate || null,
                        userNotes: userData.userNotes || ""
                    };
                });
                
                updateStats();
                showProblems(currentView);
            }
        })
        .catch(error => {
            console.error("Error loading user data: ", error);
            showToast('Error loading your data: ' + error.message, true);
        });
    
    // Get user notes
    userRef.collection('notes').get()
        .then(snapshot => {
            notesData = [];
            snapshot.forEach(doc => {
                notesData.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            updateNotesCount();
        })
        .catch(error => {
            console.error("Error loading notes: ", error);
        });
}

// Save problem data to Firebase
function saveProblemData(problemId, data) {
    if (!currentUser) return Promise.reject(new Error("User not signed in"));
    
    return db.collection('users').doc(currentUser.uid)
        .collection('problems').doc(problemId.toString())
        .set(data, { merge: true });
}

// Save a note to Firebase
function saveNote(problemId, content) {
    if (!currentUser) return Promise.reject(new Error("User not signed in"));
    
    const noteData = {
        problemId: problemId,
        problemName: userProblems.find(p => p.id === problemId)?.problem || "",
        content: content,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    return db.collection('users').doc(currentUser.uid)
        .collection('notes').add(noteData);
}

function updateStats() {
    const today = new Date();
    
    const completedCount = userProblems.filter(p => p.status === "Completed").length;
    const reviewCount = userProblems.filter(p => p.forReview).length;
    
    // Update pending count to include overdue problems
   const pendingCount = userProblems.filter(p => {
    // Only count problems with due dates in the past that aren't completed
        if (p.dueDate) {
            const dueDate = new Date(p.dueDate);
            return dueDate < today && p.status !== "Completed";
        }
        return false;
    }).length;
    
    const todayCount = userProblems.filter(p => {
        if (!p.dueDate) return false;
        const dueDate = new Date(p.dueDate);
        
        // Compare only the date parts
        return dueDate.getFullYear() === today.getFullYear() && 
               dueDate.getMonth() === today.getMonth() && 
               dueDate.getDate() === today.getDate();
    }).length;
    
    // Map data priorities to UI priorities
    // Map data priorities to UI priorities
    const highPriority = userProblems.filter(p => p.priority === "High");
    const mediumPriority = userProblems.filter(p => p.priority === "Medium");
    const lowPriority = userProblems.filter(p => p.priority === "Low");
    
    const highCompleted = highPriority.filter(p => p.status === "Completed").length;
    const mediumCompleted = mediumPriority.filter(p => p.status === "Completed").length;
    const lowCompleted = lowPriority.filter(p => p.status === "Completed").length;
    
    // Update stats display
    totalProblemsEl.textContent = userProblems.length;
    completedProblemsEl.textContent = completedCount;
    reviewProblemsEl.textContent = reviewCount;
    pendingProblemsEl.textContent = pendingCount;
    todayProblemsEl.textContent = todayCount;
    
    highPriorityStatsEl.textContent = `${highCompleted}/${highPriority.length}`;
    mediumPriorityStatsEl.textContent = `${mediumCompleted}/${mediumPriority.length}`;
    lowPriorityStatsEl.textContent = `${lowCompleted}/${lowPriority.length}`;
    
    // Update tab counts too
    allCountEl.textContent = userProblems.length;
    todayCountEl.textContent = todayCount;
    completedCountEl.textContent = completedCount;
    reviewCountEl.textContent = reviewCount;
    pendingCountEl.textContent = pendingCount;
    
    // Update notes count too
    updateNotesCount();
}

function updateNotesCount() {
    // Count problems with notes (rather than number of note entries)
    const problemsWithNotes = userProblems.filter(p => p.userNotes && p.userNotes.trim() !== "").length;
    notesCountEl.textContent = problemsWithNotes;
}

function savePrioritySelection() {
    // Save current priority checkbox states
    const lastPrioritySelection = {
        high: highPriorityCheck.checked,
        medium: mediumPriorityCheck.checked,
        low: lowPriorityCheck.checked
    };
    
    // Save to localStorage if available
    if (window.localStorage) {
        localStorage.setItem('techNavigator_prioritySelection', JSON.stringify(lastPrioritySelection));
    }
}

function loadPrioritySelection() {
    // Try to load from localStorage
    if (window.localStorage) {
        const saved = localStorage.getItem('techNavigator_prioritySelection');
        if (saved) {
            try {
                const lastPrioritySelection = JSON.parse(saved);
                
                // Apply saved selections to checkboxes
                highPriorityCheck.checked = lastPrioritySelection.high !== false; // default to true if undefined
                mediumPriorityCheck.checked = lastPrioritySelection.medium !== false; // default to true if undefined
                lowPriorityCheck.checked = lastPrioritySelection.low !== false; // default to true if undefined
            } catch (e) {
                console.error("Error loading saved priority selection:", e);
                // Set default values if there's an error
                highPriorityCheck.checked = true;
                mediumPriorityCheck.checked = true;
                lowPriorityCheck.checked = true;
            }
        } else {
            // Set default values if nothing saved
            highPriorityCheck.checked = true;
            mediumPriorityCheck.checked = true;
            lowPriorityCheck.checked = true;
        }
    }
}

// Generate a random due date within the specified days
function generateDueDate(days) {
    const date = new Date();
    const randomDays = Math.floor(Math.random() * days) + 1;
    date.setDate(date.getDate() + randomDays);
    return date.toISOString().split('T')[0];
}

function resetStudyPlan() {
    // Confirm with the user before proceeding
    if (!confirm("Are you sure you want to reset the study plan? This will clear all scheduled due dates.")) {
        return;
    }
    
    // Clear all due dates
    let updatePromises = [];
    let changedCount = 0;
    
    userProblems.forEach(problem => {
        if (problem.dueDate) {
            const index = userProblems.findIndex(p => p.id === problem.id);
            if (index !== -1) {
                userProblems[index].dueDate = null;
                changedCount++;
                
                // Save to Firebase if user is signed in
                if (currentUser) {
                    const savePromise = saveProblemData(problem.id, { dueDate: null });
                    updatePromises.push(savePromise);
                }
            }
        }
    });
    
    // Wait for all updates to complete
    if (updatePromises.length > 0) {
        Promise.all(updatePromises)
            .then(() => {
                showToast(`Study plan reset: cleared ${changedCount} scheduled problems`);
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error resetting study plan: ", error);
                showToast("Error resetting study plan", true);
            });
    } else {
        if (changedCount > 0) {
            showToast(`Study plan reset: cleared ${changedCount} scheduled problems`);
            updateStats();
            showProblems(currentView);
        } else {
            showToast("No scheduled problems to reset");
        }
    }
}

function generateStudyPlan() {
    const days = parseInt(plannerDays.value) || 30;
    if (days < 1) {
        showToast("Please enter a valid number of days (minimum 1)", true);
        return;
    }

    // Filter problems based on priority checkboxes
    const includeHigh = highPriorityCheck.checked;
    const includeMedium = mediumPriorityCheck.checked;
    const includeLow = lowPriorityCheck.checked;
    
    if (!includeHigh && !includeMedium && !includeLow) {
        showToast("Please select at least one priority level", true);
        return;
    }
    
    // Save the current priority selection
    savePrioritySelection();
    
    // Filter eligible problems - Fixed priority filtering logic
    let eligibleProblems = userProblems.filter(p => {
        if (p.status !== "Not Started") return false;
        
        // Check priorities with exact matching
        if (p.priority === "High" && includeHigh) return true;
        if (p.priority === "Medium" && includeMedium) return true;
        if (p.priority === "Low" && includeLow) return true;
        
        return false;
    });
    
    // Debug logging
    console.log("Priority selection:", { high: includeHigh, medium: includeMedium, low: includeLow });
    console.log("Found eligible problems:", eligibleProblems.length);
    console.log("Sample eligible problems:", eligibleProblems.slice(0, 5).map(p => ({
        id: p.id,
        name: p.problem,
        priority: p.priority,
        status: p.status
    })));
    
    if (eligibleProblems.length === 0) {
        showToast("No eligible problems found for the selected priorities", true);
        return;
    }
    
    // Define category order following NeetCode roadmap
    const categoryOrder = [
        "Arrays & Hashing",
        "Two Pointers",
        "Sliding Window",
        "Stack",
        "Binary Search",
        "Linked List",
        "Trees",
        "Tries",
        "Heap / Priority Queue",
        "Backtracking",
        "Graphs",
        "1D Dynamic Programming",
        "2D Dynamic Programming",
        "Greedy",
        "Intervals",
        "Bit Manipulation",
        "Design"
    ];
    
    // Priority weights (higher is more important)
    const priorityWeight = {
        "High": 3,
        "Medium": 2,
        "Low": 1
    };
    
    // Difficulty weights
    const difficultyWeight = {
        "Easy": 1,
        "Medium": 2,
        "Hard": 3
    };
    
    // Sort all eligible problems first by priority, then by category, then by difficulty
    eligibleProblems.sort((a, b) => {
        // First sort by priority (High > Medium > Low)
        if (priorityWeight[a.priority] !== priorityWeight[b.priority]) {
            return priorityWeight[b.priority] - priorityWeight[a.priority];
        }
        
        // Then by category (following NeetCode roadmap order)
        const categoryA = categoryOrder.indexOf(a.category);
        const categoryB = categoryOrder.indexOf(b.category);
        if (categoryA !== categoryB) {
            return categoryA - categoryB;
        }
        
        // Finally by difficulty (Easy > Medium > Hard)
        return difficultyWeight[a.difficulty] - difficultyWeight[b.difficulty];
    });
    
    // Calculate problems per day
    const problemsPerDay = Math.max(1, Math.ceil(eligibleProblems.length / days));
    
    // Save current plan settings to localStorage
    if (window.localStorage) {
        localStorage.setItem('techNavigator_planDays', days.toString());
    }
    
    // Assign due dates to the sorted problems
    let dueDate = new Date();
    let problemsAssigned = 0;
    let updatePromises = [];
    
    for (let i = 0; i < eligibleProblems.length; i++) {
        // Move to next day if we've assigned enough problems for today
        if (problemsAssigned >= problemsPerDay && problemsAssigned > 0) {
            dueDate.setDate(dueDate.getDate() + 1);
            problemsAssigned = 0;
        }
        
        const problem = eligibleProblems[i];
        const dueDateStr = dueDate.toISOString().split('T')[0];
        
        // Update problem due date
        const index = userProblems.findIndex(p => p.id === problem.id);
        if (index !== -1) {
            userProblems[index].dueDate = dueDateStr;
            
            // Save to Firebase if user is signed in
            if (currentUser) {
                const savePromise = saveProblemData(problem.id, { dueDate: dueDateStr });
                updatePromises.push(savePromise);
            }
        }
        
        problemsAssigned++;
    }
    
    // Wait for all updates to complete
    if (updatePromises.length > 0) {
        Promise.all(updatePromises)
            .then(() => {
                showToast(`Study plan generated: ${eligibleProblems.length} problems over ${days} days`);
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving study plan: ", error);
                showToast("Error saving study plan", true);
            });
    } else {
        showToast(`Study plan generated: ${eligibleProblems.length} problems over ${days} days`);
        updateStats();
        showProblems(currentView);
    }
}

// Helper function to shuffle an array
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Filter problems based on current view
function filterProblems(view) {
    const today = new Date();
    let filteredProblems = [];
    
    switch (view) {
        case 'today':
            filteredProblems = userProblems.filter(p => {
                if (!p.dueDate) return false;
                const dueDate = new Date(p.dueDate);
                
                // Compare only the date parts (year, month, day)
                return dueDate.getFullYear() === today.getFullYear() && 
                       dueDate.getMonth() === today.getMonth() && 
                       dueDate.getDate() === today.getDate();
            });
            break;
        case 'completed':
            filteredProblems = userProblems.filter(p => p.status === "Completed");
            break;
        case 'review':
            filteredProblems = userProblems.filter(p => p.forReview);
            break;
        case 'pending':
            filteredProblems = userProblems.filter(p => {
                // Only show problems that have a due date in the past and aren't completed
                if (p.dueDate) {
                    const dueDate = new Date(p.dueDate);
                    return dueDate < today && p.status !== "Completed";
                }
                return false;
            });
            break;
        case 'notes':
            filteredProblems = userProblems.filter(p => p.userNotes && p.userNotes.trim() !== "");
            break;
        case 'all':
        default:
            filteredProblems = [...userProblems];
            break;
    }
    
    // Define category ordering for NeetCode roadmap
    const categoryOrder = [
        "Arrays & Hashing",
        "Two Pointers",
        "Sliding Window",
        "Stack",
        "Binary Search", 
        "Linked List",
        "Trees",
        "Tries",
        "Heap / Priority Queue",
        "Backtracking",
        "Graphs",
        "1D Dynamic Programming",
        "2D Dynamic Programming",
        "Greedy",
        "Intervals",
        "Bit Manipulation",
        "Design"
    ];
    
    const priorityWeight = {
        "High": 3,
        "Medium": 2,
        "Low": 1
    };
    
    const difficultyWeight = {
        "Easy": 1,
        "Medium": 2,
        "Hard": 3
    };
    
    // Sort problems by priority, then category, then difficulty
    filteredProblems.sort((a, b) => {
        // First by priority (high to low)
        if (priorityWeight[a.priority] !== priorityWeight[b.priority]) {
            return priorityWeight[b.priority] - priorityWeight[a.priority];
        }
        
        // Then by category (following NeetCode roadmap order)
        const categoryA = categoryOrder.indexOf(a.category);
        const categoryB = categoryOrder.indexOf(b.category);
        if (categoryA !== categoryB) {
            return categoryA - categoryB;
        }
        
        // Finally by difficulty (easy to hard)
        const diffA = difficultyWeight[a.difficulty];
        const diffB = difficultyWeight[b.difficulty];
        return diffA - diffB;
    });
    
    return filteredProblems;
}

// Update the problems table
function showProblems(view) {
    currentView = view;
    
    // Show problems container or notes view based on the selected view
    if (view === 'notes') {
        problemsContainer.style.display = 'none';
        notesView.style.display = 'block';
        renderNotes();
        return;
    } else {
        problemsContainer.style.display = 'block';
        notesView.style.display = 'none';
    }
    
    // Filter problems for the current view
    problemsToShow = filterProblems(view);
    
    // Clear table
    problemsTableBody.innerHTML = '';
    
    // Populate table with all problems (no pagination)
    problemsToShow.forEach(problem => {
        const row = document.createElement('tr');
        
        // Add problem status checkbox
        const statusTd = document.createElement('td');
        statusTd.style.textAlign = 'center';
        const statusCheckbox = document.createElement('span');
        statusCheckbox.className = `status-checkbox${problem.status === "Completed" ? " completed" : ""}`;
        statusCheckbox.dataset.id = problem.id;
        statusTd.appendChild(statusCheckbox);
        
        // Add problem name with link
        const problemTd = document.createElement('td');
        const problemLink = document.createElement('a');
        problemLink.href = problem.leetCodeUrl;
        problemLink.className = 'problem-link';
        problemLink.textContent = problem.problem;
        problemLink.target = '_blank';
        problemTd.appendChild(problemLink);
        
        // Add category
        const categoryTd = document.createElement('td');
        const categoryTag = document.createElement('span');
        categoryTag.className = 'category-tag';
        categoryTag.textContent = problem.category;
        categoryTd.appendChild(categoryTag);
        
        // Add difficulty
        const difficultyTd = document.createElement('td');
        const difficultyTag = document.createElement('span');
        difficultyTag.className = `difficulty-tag ${problem.difficulty.toLowerCase()}`;
        difficultyTag.textContent = problem.difficulty;
        difficultyTd.appendChild(difficultyTag);
        
        // Add priority
        const priorityTd = document.createElement('td');
        const priorityTag = document.createElement('span');

        // Map data priorities to UI priorities for styling
        let priorityClass;
        switch(problem.priority) {
            case "High":
                priorityClass = "high";
                break;
            case "High-Medium":
                priorityClass = "medium";
                break;
            case "Medium":
                priorityClass = "low";
                break;
            default:
                priorityClass = problem.priority.toLowerCase();
        }
        priorityTag.className = `priority-tag ${priorityClass}`;
        priorityTag.textContent = problem.priority;
        priorityTd.appendChild(priorityTag);
        
        // Add due date with fixed date comparison
        const dueDateTd = document.createElement('td');
        if (problem.dueDate) {
            const dueDate = new Date(problem.dueDate);
            const today = new Date();
            
            // Compare date parts for "expired" check
            const isExpired = 
                (dueDate.getFullYear() < today.getFullYear()) ||
                (dueDate.getFullYear() === today.getFullYear() && 
                 dueDate.getMonth() < today.getMonth()) ||
                (dueDate.getFullYear() === today.getFullYear() && 
                 dueDate.getMonth() === today.getMonth() && 
                 dueDate.getDate() < today.getDate());
            
            const dueDateSpan = document.createElement('span');
            dueDateSpan.className = `due-date${isExpired ? " expired" : ""}`;
            
            // Format date as Month Day, Year
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            dueDateSpan.textContent = dueDate.toLocaleDateString('en-US', options);
            
            dueDateTd.appendChild(dueDateSpan);
        }
        
        // Add action buttons
        const actionsTd = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'action-cell';
        
        // Review button
        const reviewBtn = document.createElement('button');
        reviewBtn.className = `action-btn${problem.forReview ? " marked" : ""}`;
        reviewBtn.title = "Mark for revision";
        reviewBtn.dataset.id = problem.id;
        reviewBtn.dataset.action = "review";
        reviewBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="${problem.forReview ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        `;
        
        // Notes button
        const notesBtn = document.createElement('button');
        notesBtn.className = `action-btn${problem.userNotes && problem.userNotes.trim() !== "" ? " marked" : ""}`;
        notesBtn.title = "Add notes";
        notesBtn.dataset.id = problem.id;
        notesBtn.dataset.action = "notes";
        notesBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <path d="M14 2v6h6"></path>
                <path d="M16 13H8"></path>
                <path d="M16 17H8"></path>
                <path d="M10 9H8"></path>
            </svg>
        `;
        
        // Code solution button
        const codeBtn = document.createElement('button');
        codeBtn.className = 'action-btn';
        codeBtn.title = "View code solution";
        codeBtn.dataset.url = problem.codeUrl;
        codeBtn.dataset.action = "code";
        codeBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
        `;
        
        actionsDiv.appendChild(reviewBtn);
        actionsDiv.appendChild(notesBtn);
        actionsDiv.appendChild(codeBtn);
        actionsTd.appendChild(actionsDiv);
        
        // Add all cells to the row
        row.appendChild(statusTd);
        row.appendChild(problemTd);
        row.appendChild(categoryTd);
        row.appendChild(difficultyTd);
        row.appendChild(priorityTd);
        row.appendChild(dueDateTd);
        row.appendChild(actionsTd);
        
        // Add row to table
        problemsTableBody.appendChild(row);
    });
    
    // Update table info - show all problems now
    tableInfo.textContent = `Showing all ${problemsToShow.length} problems`;
    
    // Hide pagination since we're showing all problems
    pagination.style.display = 'none';
}
        
function getPriorityDisplayName(dataPriority) {
    switch(dataPriority) {
        case "High": return "High";
        case "High-Medium": return "Medium";
        case "Medium": return "Low";
        default: return dataPriority;
    }
}

function setupPlannerEvents() {
    // Event listener for the generate plan button
    generatePlanBtn.addEventListener('click', generateStudyPlan);
    
    // Event listener for the reset plan button
    const resetPlanBtn = document.getElementById('resetPlanBtn');
    if (resetPlanBtn) {
        resetPlanBtn.addEventListener('click', resetStudyPlan);
    }
    
    // Event listeners for the priority checkboxes to save preferences on change
    highPriorityCheck.addEventListener('change', savePrioritySelection);
    mediumPriorityCheck.addEventListener('change', savePrioritySelection);
    lowPriorityCheck.addEventListener('change', savePrioritySelection);
}

// Render pagination controls
function renderPagination(totalPages) {
    // Clear existing page buttons except prev and next
    const pageButtons = pagination.querySelectorAll('.pagination-btn:not(#prevPageBtn):not(#nextPageBtn)');
    pageButtons.forEach(btn => btn.remove());
    
    // Add page buttons
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    // Adjust if we're near the end
    if (endPage - startPage < maxVisiblePages - 1) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    // Add first page button if not visible
    if (startPage > 1) {
        const firstBtn = document.createElement('button');
        firstBtn.className = 'pagination-btn';
        firstBtn.textContent = '1';
        firstBtn.dataset.page = 1;
        pagination.insertBefore(firstBtn, nextPageBtn);
        
        // Add ellipsis if needed
        if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.margin = '0 0.25rem';
            pagination.insertBefore(ellipsis, nextPageBtn);
        }
    }
    
    // Add visible page buttons
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-btn${i === currentPage ? " active" : ""}`;
        pageBtn.textContent = i;
        pageBtn.dataset.page = i;
        pagination.insertBefore(pageBtn, nextPageBtn);
    }
    
    // Add last page button if not visible
    if (endPage < totalPages) {
        // Add ellipsis if needed
        if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.margin = '0 0.25rem';
            pagination.insertBefore(ellipsis, nextPageBtn);
        }
        
        const lastBtn = document.createElement('button');
        lastBtn.className = 'pagination-btn';
        lastBtn.textContent = totalPages;
        lastBtn.dataset.page = totalPages;
        pagination.insertBefore(lastBtn, nextPageBtn);
    }
    
    // Update prev/next button states
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages;
}

// Render notes in the notes view
function renderNotes() {
    notesGrid.innerHTML = '';
    
    if (notesData.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'note-card';
        emptyMessage.innerHTML = `
            <div class="note-header">
                <div class="note-title">No Notes Yet</div>
            </div>
            <div class="note-content">
                Add notes to problems by clicking the notes button in the actions column.
            </div>
        `;
        notesGrid.appendChild(emptyMessage);
        return;
    }
    
    // Sort notes by updated time, newest first
    const sortedNotes = [...notesData].sort((a, b) => {
        const dateA = a.updatedAt?.toDate() || new Date(0);
        const dateB = b.updatedAt?.toDate() || new Date(0);
        return dateB - dateA;
    });
    
    sortedNotes.forEach(note => {
        const noteCard = document.createElement('div');
        noteCard.className = 'note-card';
        
        const updatedDate = note.updatedAt?.toDate() || new Date();
        const formattedDate = updatedDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        noteCard.innerHTML = `
            <div class="note-header">
                <div class="note-title">${note.problemName}</div>
                <div class="note-meta">Updated: ${formattedDate}</div>
            </div>
            <div class="note-content">${note.content}</div>
        `;
        
        notesGrid.appendChild(noteCard);
    });
}

// Show toast message
function showToast(message, isError = false) {
    toast.textContent = message;
    toast.className = `toast${isError ? " error" : ""}`;
    
    // Show the toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Hide the toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Handle problem status toggle
function toggleProblemStatus(problemId) {
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    const newStatus = userProblems[index].status === "Completed" ? "Not Started" : "Completed";
    userProblems[index].status = newStatus;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        saveProblemData(problemId, { status: newStatus })
            .then(() => {
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving problem status: ", error);
                showToast("Error saving problem status", true);
                // Revert the change
                userProblems[index].status = userProblems[index].status === "Completed" ? "Not Started" : "Completed";
                showProblems(currentView);
            });
    } else {
        updateStats();
        showProblems(currentView);
    }
}

// Handle review toggle
function toggleReview(problemId) {
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    const newReviewStatus = !userProblems[index].forReview;
    userProblems[index].forReview = newReviewStatus;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        saveProblemData(problemId, { forReview: newReviewStatus })
            .then(() => {
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving review status: ", error);
                showToast("Error saving review status", true);
                // Revert the change
                userProblems[index].forReview = !newReviewStatus;
                showProblems(currentView);
            });
    } else {
        updateStats();
        showProblems(currentView);
    }
}

// Open notes modal
function openNotesModal(problemId) {
    const problem = userProblems.find(p => p.id === problemId);
    if (!problem) return;
    
    problemTitle.textContent = problem.problem;
    notesTextarea.value = problem.userNotes || "";
    notesTextarea.dataset.problemId = problemId;
    
    notesModal.style.display = 'block';
}

// Close notes modal
function closeNotesModal() {
    notesModal.style.display = 'none';
}

// Save notes
function saveNotes() {
    const problemId = parseInt(notesTextarea.dataset.problemId);
    const content = notesTextarea.value.trim();
    
    if (!problemId) return;
    
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    userProblems[index].userNotes = content;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        // Update problem user notes
        saveProblemData(problemId, { userNotes: content })
            .then(() => {
                // Add to notes collection if there's content
                if (content) {
                    return saveNote(problemId, content);
                }
                return Promise.resolve();
            })
            .then(() => {
                showToast("Notes saved successfully");
                closeNotesModal();
                
                // Reload notes data
                if (currentUser) {
                    db.collection('users').doc(currentUser.uid).collection('notes').get()
                        .then(snapshot => {
                            notesData = [];
                            snapshot.forEach(doc => {
                                notesData.push({
                                    id: doc.id,
                                    ...doc.data()
                                });
                            });
                            
                            updateNotesCount();
                            if (currentView === 'notes') {
                                renderNotes();
                            }
                        });
                }
                
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving notes: ", error);
                showToast("Error saving notes", true);
            });
    } else {
        showToast("Notes saved locally. Sign in to save permanently");
        closeNotesModal();
        updateStats();
        showProblems(currentView);
    }
}

// Set up event listeners
function setupEventListeners() {
    // Status checkbox toggle
    problemsTableBody.addEventListener('click', (e) => {
        const statusCheckbox = e.target.closest('.status-checkbox');
        if (statusCheckbox) {
            const problemId = parseInt(statusCheckbox.dataset.id);
            toggleProblemStatus(problemId);
        }
    });
    
    // Action buttons
    problemsTableBody.addEventListener('click', (e) => {
        const actionBtn = e.target.closest('.action-btn');
        if (!actionBtn) return;
        
        const action = actionBtn.dataset.action;
        const problemId = parseInt(actionBtn.dataset.id);
        
        switch (action) {
            case 'review':
                toggleReview(problemId);
                break;
            case 'notes':
                openNotesModal(problemId);
                break;
            case 'code':
                if (actionBtn.dataset.url) {
                    window.open(actionBtn.dataset.url, '_blank');
                }
                break;
        }
    });
    
    // Notes modal
    closeModal.addEventListener('click', closeNotesModal);
    window.addEventListener('click', (e) => {
        if (e.target === notesModal) {
            closeNotesModal();
        }
    });
    
    // Save notes button
    saveNotesBtn.addEventListener('click', saveNotes);
    
    // Study plan generator
    setupPlannerEvents();
    
    // View tabs
    viewTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            viewTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            const view = tab.dataset.view;
            showProblems(view);
        });
    });
    
    // Remove pagination event listeners since we're displaying all problems
}

function initApp() {
    loadProblemsData();
    
    // Load saved priority selection preferences
    loadPrioritySelection();
    
    // Load saved days setting
    if (window.localStorage) {
        const savedDays = localStorage.getItem('techNavigator_planDays');
        if (savedDays && plannerDays) {
            plannerDays.value = savedDays;
        }
    }
    
    setupAuth();
    setupEventListeners();
}

// Start the application when DOM is loaded
document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
