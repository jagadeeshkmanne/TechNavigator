<!-- Modified HTML with new tab structure -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Tracker - 175 Google Interview Problems</title>
    <!-- Add Firebase and Google Auth SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-highlight: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --blue: #3b82f6;
            --blue-dark: #2563eb;
            --green: #10b981;
            --yellow: #f59e0b;
            --orange: #f97316;
            --red: #ef4444;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 1.25rem;
            color: var(--blue);
        }

        .header-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* New status tabs style */
        .status-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .status-tab {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .status-tab:hover {
            background-color: var(--bg-tertiary);
        }

        .status-tab.active {
            border-color: var(--blue);
            background-color: var(--bg-tertiary);
        }

        .status-tab-title {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .status-tab-count {
            font-size: 1rem;
            font-weight: bold;
        }

        .status-tab.completed .status-tab-count {
            color: var(--green);
        }

        .status-tab.review .status-tab-count {
            color: var(--orange);
        }

        .status-tab.today .status-tab-count {
            color: var(--blue);
        }

        .status-tab.pending .status-tab-count {
            color: var(--red);
        }

        /* Total progress indicator */
        .total-progress {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 0.5rem 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .total-progress-label {
            color: var(--text-muted);
        }

        .total-progress-value {
            margin-left: 0.5rem;
            font-weight: 500;
        }

        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .tab-button {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 500;
        }

        .tab-button.active {
            color: var(--blue);
            border-bottom: 2px solid var(--blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }

        th {
            text-align: left;
            padding: 0.5rem;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 500;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:nth-child(even) {
            background-color: var(--bg-secondary);
        }

        tr:nth-child(odd) {
            background-color: #263149;
        }

        .table-container {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background-color: var(--bg-tertiary);
            font-size: 0.75rem;
        }

        .pagination-info {
            color: var(--text-muted);
        }

        .pagination-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: var(--blue);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--blue-dark);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background-color: var(--bg-highlight);
        }

        .btn-disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        /* Filter styles */
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        select, input {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        input[type="search"] {
            padding-left: 1.5rem;
            width: 200px;
        }

        /* Card styles */
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .problem-list {
            list-style: none;
        }

        .problem-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background-color: #263149;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .problem-info {
            flex: 1;
        }

        .problem-title {
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .problem-meta {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .problem-actions {
            display: flex;
            gap: 0.25rem;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-button:hover {
            background-color: var(--bg-tertiary);
        }

        /* Progress bars */
        .progress-container {
            margin-bottom: 0.75rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .progress-bar {
            height: 0.375rem;
            background-color: var(--bg-tertiary);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--blue);
        }

        .easy {
            color: var(--green);
        }

        .medium {
            color: var(--yellow);
        }

        .hard {
            color: var(--red);
        }

        .status-dot {
            display: inline-block;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            margin-right: 0.25rem;
        }

        .status-complete {
            background-color: var(--green);
        }

        .status-in-progress {
            background-color: var(--yellow);
        }

        .status-needs-revision {
            background-color: var(--orange);
        }

        .status-not-started {
            background-color: var(--text-muted);
        }

        a {
            color: var(--blue);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .status-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Small status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            font-size: 0.7rem;
        }

        .planner-day {
            margin-bottom: 1rem;
            border-left: 3px solid var(--blue);
            padding-left: 0.5rem;
        }

        .planner-day-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .planner-day-title {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .planner-day-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Form controls for planner */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.8rem;
        }

        .form-control {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Compact cards */
        .compact-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }

        .compact-card-title {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Revision settings */
        .revision-settings {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .revision-setting {
            flex: 1;
        }

        /* Priority checkboxes */
        .priority-checkboxes {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .priority-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .priority-checkbox input[type="checkbox"] {
            appearance: none;
            width: 1rem;
            height: 1rem;
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            cursor: pointer;
            position: relative;
        }

        .priority-checkbox input[type="checkbox"]:checked {
            background-color: var(--blue);
        }

        .priority-checkbox input[type="checkbox"]:checked::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
        }

        /* Auth styles */
        .auth-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }

        .auth-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auth-button.google {
            background-color: #4285F4;
            color: white;
        }

        .auth-button.signout {
            background-color: var(--red);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .user-name {
            font-size: 0.75rem;
        }

        /* Calculation results */
        .calculation-results {
            background-color: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            font-size: 0.75rem;
        }

        .calculation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .calculation-total {
            font-weight: bold;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        /* Content tabs for filtered problems view */
        .content-tabs {
            margin-bottom: 1rem;
        }

        .content-tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .content-tab-button {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        .content-tab-button.active {
            color: var(--blue);
            border-bottom-color: var(--blue);
        }

        .content-tab-panel {
            display: none;
            padding-top: 1rem;
        }

        .content-tab-panel.active {
            display: block;
        }

        .badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.7rem;
            font-weight: 500;
            background-color: var(--bg-tertiary);
            color: var(--text-muted);
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>LeetCode Tracker</h1>
                <div class="header-subtitle">175 Google Interview Problems</div>
            </div>
            <div class="auth-container" id="auth-container">
                <!-- Auth buttons will be loaded here -->
            </div>
        </header>
        
        <!-- Status Tabs (Replacing stat cards) -->
        <div class="status-tabs">
            <div class="status-tab completed" data-status="completed">
                <div class="status-tab-title">Completed</div>
                <div class="status-tab-count" id="completed-count">0</div>
            </div>
            <div class="status-tab review" data-status="review">
                <div class="status-tab-title">Review</div>
                <div class="status-tab-count" id="review-count">0</div>
            </div>
            <div class="status-tab today" data-status="today">
                <div class="status-tab-title">Today's</div>
                <div class="status-tab-count" id="today-count">0</div>
            </div>
            <div class="status-tab pending" data-status="pending">
                <div class="status-tab-title">Pending</div>
                <div class="status-tab-count" id="pending-count">0</div>
            </div>
        </div>
        
        <!-- Total Progress Indicator -->
        <div class="total-progress">
            <span class="total-progress-label">Total Progress:</span>
            <span class="total-progress-value" id="total-progress">0/175 (0%)</span>
        </div>
        
        <!-- Compact Stats Cards -->
        <div class="card-grid">
            <div class="compact-card">
                <div class="compact-card-title">Problem Priorities</div>
                <div id="priority-progress">
                    <!-- Priority progress will be loaded here -->
                </div>
            </div>
            <div class="compact-card">
                <div class="compact-card-title">Progress by Difficulty</div>
                <div id="difficulty-progress">
                    <!-- Difficulty progress will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="tracker">Problem Tracker</button>
            <button class="tab-button" data-tab="planner">Study Planner</button>
            <button class="tab-button" data-tab="analytics">Analytics</button>
        </div>
        
        <!-- Content tabs for problems view -->
        <div id="content-tabs" class="content-tabs">
            <div class="content-tab-buttons">
                <button class="content-tab-button active" data-content-tab="all">All Problems</button>
                <button class="content-tab-button" data-content-tab="completed">Completed <span class="badge" id="completed-badge">0</span></button>
                <button class="content-tab-button" data-content-tab="review">Review <span class="badge" id="review-badge">0</span></button>
                <button class="content-tab-button" data-content-tab="today">Today's <span class="badge" id="today-badge">0</span></button>
                <button class="content-tab-button" data-content-tab="pending">Pending <span class="badge" id="pending-badge">0</span></button>
            </div>
            
            <!-- All Problems Tab Panel (default) -->
            <div class="content-tab-panel active" id="all-tab-panel">
                <!-- Tracker Tab -->
                <div id="tracker-tab" class="tab-content active">
                    <div class="filters">
                        <div class="filter-group">
                            <select id="category-filter">
                                <option value="All">All Categories</option>
                            </select>
                            <select id="difficulty-filter">
                                <option value="All">All Difficulties</option>
                            </select>
                            <select id="priority-filter">
                                <option value="All">All Priorities</option>
                            </select>
                        </div>
                        <div class="search-container">
                            <span class="search-icon">🔍</span>
                            <input type="search" id="search-input" placeholder="Search problems...">
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="problems-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px">#</th>
                                    <th>Problem</th>
                                    <th style="width: 150px">Category</th>
                                    <th style="width: 80px">Difficulty</th>
                                    <th style="width: 80px">Priority</th>
                                    <th style="width: 100px">Last Attempt</th>
                                    <th style="width: 130px">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="problems-table-body">
                                <!-- Problems will be loaded here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <div class="pagination-info" id="pagination-info">Showing 0-0 of 0</div>
                            <div class="pagination-controls">
                                <button class="btn btn-disabled" id="prev-page">Prev</button>
                                <span id="page-info">0 / 0</span>
                                <button class="btn btn-disabled" id="next-page">Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Completed Tab Panel -->
            <div class="content-tab-panel" id="completed-tab-panel">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th>Problem</th>
                                <th style="width: 150px">Category</th>
                                <th style="width: 80px">Difficulty</th>
                                <th style="width: 100px">Last Attempt</th>
                                <th style="width: 130px">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="completed-problems-body">
                            <!-- Completed problems will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Review Tab Panel -->
            <div class="content-tab-panel" id="review-tab-panel">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th>Problem</th>
                                <th style="width: 150px">Category</th>
                                <th style="width: 80px">Difficulty</th>
                                <th style="width: 100px">Last Attempt</th>
                                <th style="width: 130px">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="review-problems-body">
                            <!-- Review problems will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Today's Tab Panel -->
            <div class="content-tab-panel" id="today-tab-panel">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th>Problem</th>
                                <th style="width: 150px">Category</th>
                                <th style="width: 80px">Difficulty</th>
                                <th style="width: 100px">Status</th>
                                <th style="width: 130px">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="today-problems-body">
                            <!-- Today's problems will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Pending Tab Panel -->
            <div class="content-tab-panel" id="pending-tab-panel">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th>Problem</th>
                                <th style="width: 150px">Category</th>
                                <th style="width: 80px">Difficulty</th>
                                <th style="width: 100px">Scheduled</th>
                                <th style="width: 130px">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pending-problems-body">
                            <!-- Pending problems will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Planner Tab -->
        <div id="planner-tab" class="tab-content">
            <div class="card">
                <div class="card-title">Study Plan Configuration</div>
                
                <div class="priority-checkboxes">
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-high" checked>
                        <span>High Priority</span>
                    </label>
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-high-medium" checked>
                        <span>High-Medium Priority</span>
                    </label>
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-medium">
                        <span>Medium Priority</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="plan-days">Number of Study Days</label>
                    <input type="number" id="plan-days" class="form-control" min="1" value="30">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="problems-per-day">Problems Per Day</label>
                    <input type="number" id="problems-per-day" class="form-control" min="1" value="3" readonly>
                </div>
                
                <div id="calculation-results" class="calculation-results">
                    <div class="calculation-row">
                        <span>High Priority Problems:</span>
                        <span id="high-count">0</span>
                    </div>
                    <div class="calculation-row">
                        <span>High-Medium Priority Problems:</span>
                        <span id="high-medium-count">0</span>
                    </div>
                    <div class="calculation-row">
                        <span>Medium Priority Problems:</span>
                        <span id="medium-count">0</span>
                    </div>
                    <div class="calculation-row calculation-total">
                        <span>Total Selected Problems:</span>
                        <span id="total-selected">0</span>
                    </div>
                </div>
                
                <div class="revision-settings">
                    <div class="form-group revision-setting">
                        <label class="form-label" for="first-revision">First Revision (days)</label>
                        <input type="number" id="first-revision" class="form-control" min="1" value="5">
                    </div>
                    <div class="form-group revision-setting">
                        <label class="form-label" for="second-revision">Second Revision (days)</label>
                        <input type="number" id="second-revision" class="form-control" min="1" value="14">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="generate-plan" class="btn btn-primary">Generate Plan</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Today's Problems</div>
                <div id="today-problems" class="problem-list">
                    <!-- Today's problems will be loaded here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Pending Problems</div>
                <div id="pending-problems" class="problem-list">
                    <!-- Pending problems will be loaded here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Problems Needing Revision</div>
                <div id="revision-problems" class="problem-list">
                    <!-- Revision problems will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="card-grid">
                <div class="card">
                    <div class="card-title">Progress by Category</div>
                    <div id="category-progress">
                        <!-- Category progress will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Estimated Completion</div>
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Overall Progress</span>
                            <span id="overall-progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="progress-meta" id="estimated-days" style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-muted);">
                            Est. 0 days remaining (3 problems/day)
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem;">Status Breakdown</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;">
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--green);" id="status-complete-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Complete</div>
                            </div>
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--orange);" id="status-needs-revision-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Review</div>
                            </div>
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--text-muted);" id="status-not-started-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Not Started</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Initialize Firebase with your configuration
const firebaseConfig = {
  apiKey: "AIzaSyBnbrX52t_Y2QgJv5nNA4xeb0ZX94_kKeY",
  authDomain: "technavigator-8ecd1.firebaseapp.com",
  projectId: "technavigator-8ecd1",
  storageBucket: "technavigator-8ecd1.firebasestorage.app",
  messagingSenderId: "316020740391",
  appId: "1:316020740391:web:2f3ba461d5a179154cd902",
  measurementId: "G-WE013C9L92"
};

// Main data store - initializing these variables at the top level
const problems = [
{ id: 1, problem: "Contains Duplicate", number: 217, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/contains-duplicate/", codeUrl: "https://leetcode.com/problems/contains-duplicate/description/" },
{ id: 2, problem: "Two Sum", number: 1, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/two-sum/", codeUrl: "https://leetcode.com/problems/two-sum/description/" },
{ id: 3, problem: "Valid Anagram", number: 242, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-anagram/", codeUrl: "https://leetcode.com/problems/valid-anagram/description/" },
{ id: 4, problem: "Group Anagrams", number: 49, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/group-anagrams/", codeUrl: "https://leetcode.com/problems/group-anagrams/description/" },
{ id: 5, problem: "Top K Frequent Elements", number: 347, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/top-k-frequent-elements/", codeUrl: "https://leetcode.com/problems/top-k-frequent-elements/description/" },
{ id: 6, problem: "Product of Array Except Self", number: 238, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/product-of-array-except-self/", codeUrl: "https://leetcode.com/problems/product-of-array-except-self/description/" },
{ id: 7, problem: "Longest Consecutive Sequence", number: 128, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-consecutive-sequence/", codeUrl: "https://leetcode.com/problems/longest-consecutive-sequence/description/" },
{ id: 8, problem: "Valid Palindrome", number: 125, category: "Two Pointers", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-palindrome/", codeUrl: "https://leetcode.com/problems/valid-palindrome/description/" },
{ id: 9, problem: "3Sum", number: 15, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/3sum/", codeUrl: "https://leetcode.com/problems/3sum/description/" },
{ id: 10, problem: "Container With Most Water", number: 11, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/container-with-most-water/", codeUrl: "https://leetcode.com/problems/container-with-most-water/description/" },
{ id: 11, problem: "Trapping Rain Water", number: 42, category: "Two Pointers", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/trapping-rain-water/", codeUrl: "https://leetcode.com/problems/trapping-rain-water/description/" },
{ id: 12, problem: "Two Sum II - Input Array Is Sorted", number: 167, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/", codeUrl: "https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/description/" },
{ id: 13, problem: "Best Time to Buy and Sell Stock", number: 121, category: "Sliding Window", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", codeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/description/" },
{ id: 14, problem: "Longest Substring Without Repeating Characters", number: 3, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", codeUrl: "https://leetcode.com/problems/longest-substring-without-repeating-characters/description/" },
{ id: 15, problem: "Longest Repeating Character Replacement", number: 424, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-repeating-character-replacement/", codeUrl: "https://leetcode.com/problems/longest-repeating-character-replacement/description/" },
{ id: 16, problem: "Permutation in String", number: 567, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/permutation-in-string/", codeUrl: "https://leetcode.com/problems/permutation-in-string/description/" },
{ id: 17, problem: "Minimum Window Substring", number: 76, category: "Sliding Window", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/minimum-window-substring/", codeUrl: "https://leetcode.com/problems/minimum-window-substring/description/" },
{ id: 18, problem: "Valid Parentheses", number: 20, category: "Stack", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-parentheses/", codeUrl: "https://leetcode.com/problems/valid-parentheses/description/" },
{ id: 19, problem: "Min Stack", number: 155, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/min-stack/", codeUrl: "https://leetcode.com/problems/min-stack/description/" },
{ id: 20, problem: "Generate Parentheses", number: 22, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/generate-parentheses/", codeUrl: "https://leetcode.com/problems/generate-parentheses/description/" },
{ id: 21, problem: "Daily Temperatures", number: 739, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/daily-temperatures/", codeUrl: "https://leetcode.com/problems/daily-temperatures/description/" },
{ id: 22, problem: "Largest Rectangle in Histogram", number: 84, category: "Stack", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/largest-rectangle-in-histogram/", codeUrl: "https://leetcode.com/problems/largest-rectangle-in-histogram/description/" },
{ id: 23, problem: "Binary Search", number: 704, category: "Binary Search", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/binary-search/", codeUrl: "https://leetcode.com/problems/binary-search/description/" },
{ id: 24, problem: "Search a 2D Matrix", number: 74, category: "Binary Search", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/search-a-2d-matrix/", codeUrl: "https://leetcode.com/problems/search-a-2d-matrix/description/" },
{ id: 25, problem: "Find Minimum in Rotated Sorted Array", number: 153, category: "Binary Search", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", codeUrl: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/description/" },
// truncated to 25 problems for brevity, but you should include all 175 problems in your actual implementation
];

// Initialize variables for data management
let userProblems = [...problems]; // Copy of problems that will be modified by user
let categories = [];
let studyPlan = [];
let currentPage = 0;
let rowsPerPage = 15;
let filteredProblems = [];
let currentUser = null;

// State for filters
let filters = {
    search: '',
    category: 'All',
    difficulty: 'All',
    priority: 'All'
};

// Stats
let stats = {
    total: 0,
    completed: 0,
    needsRevision: 0,
    notStarted: 0
};

// Status tabs
let statusCounts = {
    completed: 0,
    review: 0,
    today: 0,
    pending: 0
};

// Initialize Firebase with your configuration
const firebaseConfig = {
  apiKey: "AIzaSyBnbrX52t_Y2QgJv5nNA4xeb0ZX94_kKeY",
  authDomain: "technavigator-8ecd1.firebaseapp.com",
  projectId: "technavigator-8ecd1",
  storageBucket: "technavigator-8ecd1.firebasestorage.app",
  messagingSenderId: "316020740391",
  appId: "1:316020740391:web:2f3ba461d5a179154cd902",
  measurementId: "G-WE013C9L92"
};

document.addEventListener('DOMContentLoaded', () => {
    if (typeof firebase !== 'undefined') {
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Set up authentication
        setupAuth();
        
        // Set up tabs
        setupTabs();
        
        // Initialize the app
        initializeApp();
        
        // Set up event listeners
        setupEventListeners();
    } else {
        console.error("Firebase SDK not loaded");
        // Continue with local functionality even if Firebase isn't available
        setupTabs();
        initializeApp();
        setupEventListeners();
    }
});

function setupAuth() {
    const auth = firebase.auth();
    
    auth.onAuthStateChanged(async (user) => {
        console.log('Auth state changed:', user ? user.uid : 'no user');
        
        if (user) {
            currentUser = user;
            updateUIForUser(user);
            
            try {
                await loadUserData();
                initializeApp();
            } catch (error) {
                console.error('Error loading user data:', error);
                alert('There was an error loading your data. Proceeding with default data.');
                initializeApp();
            }
        } else {
            renderSignInButton();
            initializeApp(); // Proceed with default data for non-logged in users
        }
    });
}

function updateUIForUser(user) {
    const authContainer = document.getElementById('auth-container');
    if (!authContainer) return;
    
    authContainer.innerHTML = `
        <div class="user-info">
            <img class="user-avatar" src="${user.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.displayName || 'User')}" 
                 alt="${user.displayName || 'User'}">
            <span class="user-name">${user.displayName || user.email || 'User'}</span>
        </div>
        <button class="auth-button signout compact" id="signout-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Sign out</span>
        </button>
    `;
    
    document.getElementById('signout-button').addEventListener('click', () => {
        firebase.auth().signOut().then(() => {
            window.location.reload();
        });
    });
}

function renderSignInButton() {
    const authContainer = document.getElementById('auth-container');
    if (!authContainer) return;
    
    authContainer.innerHTML = `
        <button class="auth-button google compact" id="signin-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                <path fill="none" d="M0 0h48v48H0z"/>
            </svg>
            <span>Sign in</span>
        </button>
    `;
    
    document.getElementById('signin-button').addEventListener('click', signInWithGooglePopup);
}

async function signInWithGooglePopup() {
    try {
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();
        
        provider.addScope('profile');
        provider.addScope('email');
        
        const result = await auth.signInWithPopup(provider);
        console.log('Sign-in successful', result.user);
        
        await initializeUserData(result.user);
        updateUIForUser(result.user);
        
    } catch (error) {
        console.error('Sign-in error:', error);
        
        if (error.code === 'auth/account-exists-with-different-credential') {
            alert('An account already exists with this email. Please sign in with the original method.');
        } else if (error.code === 'auth/popup-closed-by-user') {
            console.log('Sign-in popup was closed by user');
        } else {
            alert('Sign-in failed: ' + error.message);
        }
    }
}

async function initializeUserData(user) {
    if (!user || typeof firebase === 'undefined') return false;
    
    try {
        const db = firebase.firestore();
        const userRef = db.collection('users').doc(user.uid);
        
        const doc = await userRef.get();
        
        if (!doc.exists) {
            console.log('Creating new user document');
            await userRef.set({
                problems: userProblems,
                studyPlan: [],
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                email: user.email,
                displayName: user.displayName,
                photoURL: user.photoURL || ''
            });
            console.log('User document created successfully');
            return true;
        } else {
            console.log('User document already exists');
            return true;
        }
    } catch (error) {
        console.error('Error initializing user data:', error);
        return false;
    }
}

async function loadUserData() {
    if (!currentUser || typeof firebase === 'undefined') {
        console.log('No current user or Firebase not initialized, using default data');
        return false;
    }
    
    try {
        console.log('Loading user data for:', currentUser.uid);
        const db = firebase.firestore();
        const userRef = db.collection('users').doc(currentUser.uid);
        
        const doc = await userRef.get();
        
        if (doc.exists) {
            const data = doc.data();
            console.log('User data loaded');
            
            if (data.problems && Array.isArray(data.problems)) {
                userProblems = data.problems;
                console.log(`Loaded ${userProblems.length} problems`);
            }
            
            if (data.studyPlan && Array.isArray(data.studyPlan)) {
                studyPlan = data.studyPlan.map(day => {
                    let validDate = day.date;
                    
                    if (day.date && typeof day.date.toDate === 'function') {
                        validDate = day.date.toDate();
                    } else if (typeof day.date === 'string' || typeof day.date === 'number') {
                        validDate = new Date(day.date);
                    } else {
                        console.warn('Invalid date found in study plan, using today');
                        validDate = new Date();
                    }
                    
                    return {
                        ...day,
                        date: validDate
                    };
                });
                
                console.log(`Loaded ${studyPlan.length} study plan days`);
            }
            
            return true;
        } else {
            console.log('No user document found, initializing');
            await initializeUserData(currentUser);
            return false;
        }
    } catch (error) {
        console.error('Error loading user data:', error);
        return false;
    }
}

async function saveUserData() {
    if (!currentUser || typeof firebase === 'undefined') {
        console.log('Cannot save: No current user or Firebase not initialized');
        return false;
    }
    
    try {
        console.log('Saving user data for:', currentUser.uid);
        
        const db = firebase.firestore();
        const userRef = db.collection('users').doc(currentUser.uid);
        
        // Convert dates to Firestore timestamps
        const processedStudyPlan = studyPlan.map(day => {
            let validDate = day.date;
            
            if (!(validDate instanceof Date)) {
                console.warn('Invalid date found in study plan before save:', day.date);
                validDate = new Date();
            }
            
            return {
                ...day,
                date: firebase.firestore.Timestamp.fromDate(validDate)
            };
        });
        
        await userRef.set({
            problems: userProblems,
            studyPlan: processedStudyPlan,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        
        console.log('User data saved successfully');
        return true;
    } catch (error) {
        console.error('Error saving user data:', error);
        return false;
    }
}

function setupTabs() {
    // Main tabs (Tracker, Planner, Analytics)
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabName = button.getAttribute('data-tab');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            button.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Special case for planner tab
            if (tabName === 'planner') {
                updateProblemsPerDay();
                renderTodayProblems();
                renderPendingProblems();
                renderRevisionProblems();
            }
        });
    });
    
    // Content tabs (All, Completed, Review, Today's, Pending)
    const contentTabButtons = document.querySelectorAll('.content-tab-button');
    const contentTabPanels = document.querySelectorAll('.content-tab-panel');
    
    contentTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabName = button.getAttribute('data-content-tab');
            
            contentTabButtons.forEach(btn => btn.classList.remove('active'));
            contentTabPanels.forEach(panel => panel.classList.remove('active'));
            
            button.classList.add('active');
            document.getElementById(`${tabName}-tab-panel`).classList.add('active');
            
            // Render the appropriate table
            if (tabName === 'all') {
                renderProblemsTable();
            } else if (tabName === 'completed') {
                renderCompletedProblems();
            } else if (tabName === 'review') {
                renderReviewProblems();
            } else if (tabName === 'today') {
                renderTodaysProblems();
            } else if (tabName === 'pending') {
                renderPendingProblemsTable();
            }
        });
    });
}

function setupEventListeners() {
    // Filter changes
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const difficultyFilter = document.getElementById('difficulty-filter');
    const priorityFilter = document.getElementById('priority-filter');
    
    if (searchInput) searchInput.addEventListener('input', handleFilterChange);
    if (categoryFilter) categoryFilter.addEventListener('change', handleFilterChange);
    if (difficultyFilter) difficultyFilter.addEventListener('change', handleFilterChange);
    if (priorityFilter) priorityFilter.addEventListener('change', handleFilterChange);
    
    // Pagination
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    if (prevPageBtn) {
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                renderProblemsTable();
            }
        });
    }
    
    if (nextPageBtn) {
        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredProblems.length / rowsPerPage);
            if (currentPage < totalPages - 1) {
                currentPage++;
                renderProblemsTable();
            }
        });
    }
    
    // Generate study plan
    const generatePlanBtn = document.getElementById('generate-plan');
    if (generatePlanBtn) {
        generatePlanBtn.addEventListener('click', () => generateStudyPlan(true));
    }
    
    // Priority checkboxes and days input for study planner
    const priorityHigh = document.getElementById('priority-high');
    const priorityHighMedium = document.getElementById('priority-high-medium');
    const priorityMedium = document.getElementById('priority-medium');
    const planDays = document.getElementById('plan-days');
    
    if (priorityHigh) priorityHigh.addEventListener('change', updateProblemsPerDay);
    if (priorityHighMedium) priorityHighMedium.addEventListener('change', updateProblemsPerDay);
    if (priorityMedium) priorityMedium.addEventListener('change', updateProblemsPerDay);
    if (planDays) planDays.addEventListener('input', updateProblemsPerDay);
    
    // Status tabs
    const statusTabs = document.querySelectorAll('.status-tab');
    statusTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const status = tab.getAttribute('data-status');
            filterByStatus(status);
        });
    });
    
    // Add debug controls for testing
    setTimeout(addDebugControls, 1000);
}

function initializeApp() {
    // Extract categories from problems for filtering
    updateFilters();
    
    // Apply initial filters
    applyFilters();
    
    // Calculate and update statistics
    updateStats();
    updateStatusCounts();
    
    // Render initial tables
    renderProblemsTable();
    
    // Initialize the study planner
    updateProblemsPerDay();
    renderTodayProblems();
    renderPendingProblems();
    renderRevisionProblems();
}

function updateFilters() {
    // Get unique categories for filtering
    const uniqueCategories = [...new Set(userProblems.map(p => p.category))];
    const categoryFilter = document.getElementById('category-filter');
    
    if (categoryFilter) {
        // Clear existing options except the first one
        while (categoryFilter.options.length > 1) {
            categoryFilter.remove(1);
        }
        
        // Add new options
        uniqueCategories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categoryFilter.appendChild(option);
        });
    }
    
    // Get unique difficulties
    const uniqueDifficulties = [...new Set(userProblems.map(p => p.difficulty))];
    const difficultyFilter = document.getElementById('difficulty-filter');
    
    if (difficultyFilter) {
        while (difficultyFilter.options.length > 1) {
            difficultyFilter.remove(1);
        }
        
        uniqueDifficulties.forEach(difficulty => {
            const option = document.createElement('option');
            option.value = difficulty;
            option.textContent = difficulty;
            difficultyFilter.appendChild(option);
        });
    }
    
    // Get unique priorities
    const uniquePriorities = [...new Set(userProblems.map(p => p.priority))];
    const priorityFilter = document.getElementById('priority-filter');
    
    if (priorityFilter) {
        while (priorityFilter.options.length > 1) {
            priorityFilter.remove(1);
        }
        
        uniquePriorities.forEach(priority => {
            const option = document.createElement('option');
            option.value = priority;
            option.textContent = priority;
            priorityFilter.appendChild(option);
        });
    }
    
    // Store categories for later use
    categories = uniqueCategories;
}

function handleFilterChange() {
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const difficultyFilter = document.getElementById('difficulty-filter');
    const priorityFilter = document.getElementById('priority-filter');
    
    filters.search = searchInput ? searchInput.value.toLowerCase() : '';
    filters.category = categoryFilter ? categoryFilter.value : 'All';
    filters.difficulty = difficultyFilter ? difficultyFilter.value : 'All';
    filters.priority = priorityFilter ? priorityFilter.value : 'All';
    
    applyFilters();
    currentPage = 0;
    renderProblemsTable();
}

function applyFilters() {
    // Start with a copy of all problems
    filteredProblems = [...userProblems];
    
    // Apply search filter if any
    if (filters.search) {
        filteredProblems = filteredProblems.filter(item => 
            item.problem.toLowerCase().includes(filters.search) ||
            item.number.toString().includes(filters.search) ||
            item.category.toLowerCase().includes(filters.search)
        );
    }
    
    // Apply category filter if not "All"
    if (filters.category !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.category === filters.category);
    }
    
    // Apply difficulty filter if not "All"
    if (filters.difficulty !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.difficulty === filters.difficulty);
    }
    
    // Apply priority filter if not "All"
    if (filters.priority !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.priority === filters.priority);
    }
}

function updateStats() {
    // Calculate statistics from problems data
    stats.total = userProblems.length;
    stats.completed = userProblems.filter(p => p.status === 'Complete').length;
    stats.needsRevision = userProblems.filter(p => p.status === 'Needs Revision').length;
    stats.notStarted = stats.total - stats.completed - stats.needsRevision;
    
    // Update the total progress display
    const totalProgressElement = document.getElementById('total-progress');
    if (totalProgressElement) {
        const progressPercentage = Math.round((stats.completed / stats.total) * 100) || 0;
        totalProgressElement.textContent = `${stats.completed}/${stats.total} (${progressPercentage}%)`;
    }
}

function updateStatusCounts() {
    // Count completed and review problems
    statusCounts.completed = userProblems.filter(p => p.status === 'Complete').length;
    statusCounts.review = userProblems.filter(p => p.status === 'Needs Revision').length;
    
    // Count today's problems
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const todayPlan = studyPlan.find(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        return planDate.getTime() === today.getTime();
    });
    statusCounts.today = todayPlan ? todayPlan.problems.length : 0;
    
    // Count pending problems (problems from past days that are not completed)
    statusCounts.pending = studyPlan.reduce((count, day) => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        
        if (planDate.getTime() < today.getTime()) {
            return count + day.problems.filter(p => p.status !== 'Complete').length;
        }
        return count;
    }, 0);
    
    // Update status tab counts
    const completedCount = document.getElementById('completed-count');
    const reviewCount = document.getElementById('review-count');
    const todayCount = document.getElementById('today-count');
    const pendingCount = document.getElementById('pending-count');
    
    if (completedCount) completedCount.textContent = statusCounts.completed;
    if (reviewCount) reviewCount.textContent = statusCounts.review;
    if (todayCount) todayCount.textContent = statusCounts.today;
    if (pendingCount) pendingCount.textContent = statusCounts.pending;
    
    // Update content tab badges
    const completedBadge = document.getElementById('completed-badge');
    const reviewBadge = document.getElementById('review-badge');
    const todayBadge = document.getElementById('today-badge');
    const pendingBadge = document.getElementById('pending-badge');
    
    if (completedBadge) completedBadge.textContent = statusCounts.completed;
    if (reviewBadge) reviewBadge.textContent = statusCounts.review;
    if (todayBadge) todayBadge.textContent = statusCounts.today;
    if (pendingBadge) pendingBadge.textContent = statusCounts.pending;
}

function filterByStatus(status) {
    // Update active tab
    const statusTabs = document.querySelectorAll('.status-tab');
    statusTabs.forEach(tab => tab.classList.remove('active'));
    
    const activeTab = document.querySelector(`.status-tab[data-status="${status}"]`);
    if (activeTab) activeTab.classList.add('active');
    
    // Filter problems based on status
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    switch(status) {
        case 'completed':
            filteredProblems = userProblems.filter(p => p.status === 'Complete');
            break;
        case 'review':
            filteredProblems = userProblems.filter(p => p.status === 'Needs Revision');
            break;
        case 'today':
            const todayPlan = studyPlan.find(day => {
                const planDate = new Date(day.date);
                planDate.setHours(0, 0, 0, 0);
                return planDate.getTime() === today.getTime();
            });
            
            if (todayPlan) {
                // Create a new deep copy of the problems to avoid reference issues
                filteredProblems = todayPlan.problems.map(p => {
                    // Find the latest version of this problem in userProblems
                    const latest = userProblems.find(up => up.id === p.id) || p;
                    return { ...latest };
                });
            } else {
                filteredProblems = [];
            }
            break;
        case 'pending':
            // Get all problems from past days that aren't complete
            filteredProblems = [];
            
            studyPlan.forEach(day => {
                const planDate = new Date(day.date);
                planDate.setHours(0, 0, 0, 0);
                
                if (planDate.getTime() < today.getTime()) {
                    day.problems.forEach(p => {
                        // Find current status of the problem
                        const currentVersion = userProblems.find(up => up.id === p.id);
                        
                        if (currentVersion && currentVersion.status !== 'Complete') {
                            // Add the current version to filtered problems
                            filteredProblems.push({...currentVersion});
                        }
                    });
                }
            });
            
            // Remove duplicates (a problem might appear in multiple days)
            filteredProblems = Array.from(new Map(
                filteredProblems.map(p => [p.id, p])
            ).values());
            break;
        default:
            filteredProblems = [...userProblems];
    }
    
    currentPage = 0;
    renderProblemsTable();
}

function renderProblemsTable() {
    const tableBody = document.getElementById('problems-table-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    const totalPages = Math.ceil(filteredProblems.length / rowsPerPage);
    const startIndex = currentPage * rowsPerPage;
    const endIndex = Math.min(startIndex + rowsPerPage, filteredProblems.length);
    const paginatedProblems = filteredProblems.slice(startIndex, endIndex);
    
    paginatedProblems.forEach((problem) => {
        const row = document.createElement('tr');
        
        // ID column
        const idCell = document.createElement('td');
        idCell.textContent = problem.id;
        row.appendChild(idCell);
        
        // Problem column
        const problemCell = document.createElement('td');
        const problemLink = document.createElement('a');
        problemLink.href = problem.leetCodeUrl;
        problemLink.target = '_blank';
        problemLink.rel = 'noopener noreferrer';
        problemLink.textContent = problem.problem;
        problemCell.appendChild(problemLink);
        row.appendChild(problemCell);
        
        // Category column
        const categoryCell = document.createElement('td');
        categoryCell.textContent = problem.category;
        row.appendChild(categoryCell);
        
        // Difficulty column
        const difficultyCell = document.createElement('td');
        difficultyCell.classList.add(problem.difficulty.toLowerCase());
        difficultyCell.textContent = problem.difficulty;
        row.appendChild(difficultyCell);
        
        // Priority column
        const priorityCell = document.createElement('td');
        priorityCell.textContent = problem.priority;
        row.appendChild(priorityCell);
        
        // Last Attempt column
        const lastAttemptCell = document.createElement('td');
        lastAttemptCell.textContent = problem.lastAttempt || '-';
        row.appendChild(lastAttemptCell);
        
        // Actions column
        const actionsCell = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.style.display = 'flex';
        actionsDiv.style.gap = '4px';
        
        // Complete button
        const completeBtn = document.createElement('button');
        completeBtn.classList.add('icon-button');
        completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
        completeBtn.title = 'Mark Complete';
        completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
        actionsDiv.appendChild(completeBtn);
        
        // Needs Revision button
        const needsRevisionBtn = document.createElement('button');
        needsRevisionBtn.classList.add('icon-button');
        needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
        needsRevisionBtn.title = 'Mark Needs Revision';
        needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
        actionsDiv.appendChild(needsRevisionBtn);
        
        // Code button
        const codeBtn = document.createElement('a');
        codeBtn.classList.add('icon-button');
        codeBtn.href = problem.codeUrl || problem.leetCodeUrl;
        codeBtn.target = '_blank';
        codeBtn.rel = 'noopener noreferrer';
        codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
        codeBtn.title = 'View Problem Code';
        actionsDiv.appendChild(codeBtn);
        
        actionsCell.appendChild(actionsDiv);
        row.appendChild(actionsCell);
        
        tableBody.appendChild(row);
    });
    
    // Update pagination info
    const paginationInfo = document.getElementById('pagination-info');
    const pageInfo = document.getElementById('page-info');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    if (paginationInfo) {
        paginationInfo.textContent = `Showing ${startIndex + 1}-${endIndex} of ${filteredProblems.length}`;
    }
    
    if (pageInfo) {
        pageInfo.textContent = `${currentPage + 1} / ${Math.max(1, totalPages)}`;
    }
    
    if (prevPageBtn) {
        prevPageBtn.classList.toggle('btn-disabled', currentPage === 0);
        prevPageBtn.classList.toggle('btn-primary', currentPage > 0);
    }
    
    if (nextPageBtn) {
        nextPageBtn.classList.toggle('btn-disabled', currentPage >= totalPages - 1);
        nextPageBtn.classList.toggle('btn-primary', currentPage < totalPages - 1);
    }
}

function renderCompletedProblems() {
    const tableBody = document.getElementById('completed-problems-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    const completedProblems = userProblems.filter(p => p.status === 'Complete');
    
    completedProblems.forEach(problem => {
        const row = createProblemTableRow(problem, false);
        tableBody.appendChild(row);
    });
}

function renderReviewProblems() {
    const tableBody = document.getElementById('review-problems-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    const reviewProblems = userProblems.filter(p => p.status === 'Needs Revision');
    
    reviewProblems.forEach(problem => {
        const row = createProblemTableRow(problem, false);
        tableBody.appendChild(row);
    });
}

function renderTodaysProblems() {
    const tableBody = document.getElementById('today-problems-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const todayPlan = studyPlan.find(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        return planDate.getTime() === today.getTime();
    });
    
    if (todayPlan && todayPlan.problems.length > 0) {
        todayPlan.problems.forEach(p => {
            // Find the latest status for this problem
            const currentProblem = userProblems.find(up => up.id === p.id) || p;
            const row = createProblemTableRow(currentProblem, true);
            tableBody.appendChild(row);
        });
    } else {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 6;
        cell.textContent = 'No problems scheduled for today.';
        cell.style.textAlign = 'center';
        cell.style.padding = '1rem';
        row.appendChild(cell);
        tableBody.appendChild(row);
    }
}

function renderPendingProblemsTable() {
    const tableBody = document.getElementById('pending-problems-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Collect all problems from past days that aren't complete
    const pendingProblems = [];
    const processedIds = new Set(); // To prevent duplicates
    
    studyPlan.forEach(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        
        if (planDate.getTime() < today.getTime()) {
            day.problems.forEach(p => {
                // Only process each problem once
                if (!processedIds.has(p.id)) {
                    processedIds.add(p.id);
                    
                    // Get current status of the problem
                    const currentProblem = userProblems.find(up => up.id === p.id);
                    
                    if (currentProblem && currentProblem.status !== 'Complete') {
                        // Store the original planned date with the problem
                        pendingProblems.push({
                            ...currentProblem,
                            plannedDate: planDate
                        });
                    }
                }
            });
        }
    });
    
    if (pendingProblems.length > 0) {
        pendingProblems.forEach(problem => {
            const row = document.createElement('tr');
            
            // ID column
            const idCell = document.createElement('td');
            idCell.textContent = problem.id;
            row.appendChild(idCell);
            
            // Problem column
            const problemCell = document.createElement('td');
            const problemLink = document.createElement('a');
            problemLink.href = problem.leetCodeUrl;
            problemLink.target = '_blank';
            problemLink.rel = 'noopener noreferrer';
            problemLink.textContent = problem.problem;
            problemCell.appendChild(problemLink);
            row.appendChild(problemCell);
            
            // Category column
            const categoryCell = document.createElement('td');
            categoryCell.textContent = problem.category;
            row.appendChild(categoryCell);
            
            // Difficulty column
            const difficultyCell = document.createElement('td');
            difficultyCell.classList.add(problem.difficulty.toLowerCase());
            difficultyCell.textContent = problem.difficulty;
            row.appendChild(difficultyCell);
            
            // Scheduled column
            const scheduledCell = document.createElement('td');
            scheduledCell.textContent = problem.plannedDate ? problem.plannedDate.toLocaleDateString() : '-';
            row.appendChild(scheduledCell);
            
            // Actions column
            const actionsCell = document.createElement('td');
            const actionsDiv = document.createElement('div');
            actionsDiv.style.display = 'flex';
            actionsDiv.style.gap = '4px';
            
            // Complete button
            const completeBtn = document.createElement('button');
            completeBtn.classList.add('icon-button');
            completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            completeBtn.title = 'Mark Complete';
            completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
            actionsDiv.appendChild(completeBtn);
            
            // Needs Revision button
            const needsRevisionBtn = document.createElement('button');
            needsRevisionBtn.classList.add('icon-button');
            needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
            needsRevisionBtn.title = 'Mark Needs Revision';
            needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
            actionsDiv.appendChild(needsRevisionBtn);
            
            // Code button
            const codeBtn = document.createElement('a');
            codeBtn.classList.add('icon-button');
            codeBtn.href = problem.codeUrl || problem.leetCodeUrl;
            codeBtn.target = '_blank';
            codeBtn.rel = 'noopener noreferrer';
            codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
            codeBtn.title = 'View Problem Code';
            actionsDiv.appendChild(codeBtn);
            
            actionsCell.appendChild(actionsDiv);
            row.appendChild(actionsCell);
            
            tableBody.appendChild(row);
        });
    } else {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 6;
        cell.textContent = 'No pending problems. You\'re all caught up!';
        cell.style.textAlign = 'center';
        cell.style.padding = '1rem';
        row.appendChild(cell);
        tableBody.appendChild(row);
    }
}

function createProblemTableRow(problem, includeStatus = false) {
    const row = document.createElement('tr');
    
    // ID column
    const idCell = document.createElement('td');
    idCell.textContent = problem.id;
    row.appendChild(idCell);
    
    // Problem column
    const problemCell = document.createElement('td');
    const problemLink = document.createElement('a');
    problemLink.href = problem.leetCodeUrl;
    problemLink.target = '_blank';
    problemLink.rel = 'noopener noreferrer';
    problemLink.textContent = problem.problem;
    problemCell.appendChild(problemLink);
    row.appendChild(problemCell);
    
    // Category column
    const categoryCell = document.createElement('td');
    categoryCell.textContent = problem.category;
    row.appendChild(categoryCell);
    
    // Difficulty column
    const difficultyCell = document.createElement('td');
    difficultyCell.classList.add(problem.difficulty.toLowerCase());
    difficultyCell.textContent = problem.difficulty;
    row.appendChild(difficultyCell);
    
    // Status/Last Attempt column
    if (includeStatus) {
        const statusCell = document.createElement('td');
        const statusBadge = document.createElement('span');
        statusBadge.className = 'status-badge';
        
        const statusDot = document.createElement('span');
        const statusClass = problem.status.toLowerCase().replace(' ', '-');
        statusDot.className = `status-dot status-${statusClass}`;
        statusBadge.appendChild(statusDot);
        
        statusBadge.appendChild(document.createTextNode(problem.status));
        statusCell.appendChild(statusBadge);
        row.appendChild(statusCell);
    } else {
        const lastAttemptCell = document.createElement('td');
        lastAttemptCell.textContent = problem.lastAttempt || '-';
        row.appendChild(lastAttemptCell);
    }
    
    // Actions column
    const actionsCell = document.createElement('td');
    const actionsDiv = document.createElement('div');
    actionsDiv.style.display = 'flex';
    actionsDiv.style.gap = '4px';
    
    // Complete button
    const completeBtn = document.createElement('button');
    completeBtn.classList.add('icon-button');
    completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    completeBtn.title = 'Mark Complete';
    completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
    actionsDiv.appendChild(completeBtn);
    
    // Needs Revision button
    const needsRevisionBtn = document.createElement('button');
    needsRevisionBtn.classList.add('icon-button');
    needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
    needsRevisionBtn.title = 'Mark Needs Revision';
    needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
    actionsDiv.appendChild(needsRevisionBtn);
    
    // Code button
    const codeBtn = document.createElement('a');
    codeBtn.classList.add('icon-button');
    codeBtn.href = problem.codeUrl || problem.leetCodeUrl;
    codeBtn.target = '_blank';
    codeBtn.rel = 'noopener noreferrer';
    codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
    codeBtn.title = 'View Problem Code';
    actionsDiv.appendChild(codeBtn);
    
    actionsCell.appendChild(actionsDiv);
    row.appendChild(actionsCell);
    
    return row;
}

function updateProblemStatus(id, status) {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    // Update the problem status in the main problems array
    userProblems = userProblems.map(problem => {
        if (problem.id === id) {
            const updatedProblem = {
                ...problem, 
                status, 
                lastAttempt: status !== 'Not Started' ? today.toLocaleDateString() : ''
            };
            
            // If completing a problem, set up revision dates
            if (status === 'Complete') {
                updatedProblem.completedDate = today;
                
                // Set up revision schedules
                const firstRevisionDays = parseInt(document.getElementById('first-revision')?.value) || 5;
                const secondRevisionDays = parseInt(document.getElementById('second-revision')?.value) || 14;
                
                updatedProblem.revisionDates = [
                    new Date(today.getTime() + firstRevisionDays * 24 * 60 * 60 * 1000),
                    new Date(today.getTime() + secondRevisionDays * 24 * 60 * 60 * 1000)
                ];
            }
            
            return updatedProblem;
        }
        return problem;
    });
    
    // Also update the problem in study plan if it exists
    studyPlan = studyPlan.map(day => {
        const updatedProblems = day.problems.map(problem => {
            if (problem.id === id) {
                return {
                    ...problem,
                    status,
                    lastAttempt: status !== 'Not Started' ? today.toLocaleDateString() : ''
                };
            }
            return problem;
        });
        
        return {
            ...day,
            problems: updatedProblems
        };
    });
    
    // Update the UI
    updateStats();
    updateStatusCounts();
    applyFilters();
    renderProblemsTable();
    
    // Also update specific views
    renderTodayProblems();
    renderPendingProblems();
    renderRevisionProblems();
    
    // Save changes to Firebase if user is logged in
    saveUserData();
}

function updateProblemsPerDay() {
    const highChecked = document.getElementById('priority-high')?.checked || false;
    const highMediumChecked = document.getElementById('priority-high-medium')?.checked || false;
    const mediumChecked = document.getElementById('priority-medium')?.checked || false;
    
    let highCount = 0;
    let highMediumCount = 0;
    let mediumCount = 0;
    
    if (highChecked) {
        highCount = userProblems.filter(p => 
            p.priority === 'High' && (p.status === 'Not Started' || p.status === 'In Progress')
        ).length;
    }
    
    if (highMediumChecked) {
        highMediumCount = userProblems.filter(p => 
            p.priority === 'High-Medium' && (p.status === 'Not Started' || p.status === 'In Progress')
        ).length;
    }
    
    if (mediumChecked) {
        mediumCount = userProblems.filter(p => 
            p.priority === 'Medium' && (p.status === 'Not Started' || p.status === 'In Progress')
        ).length;
    }
    
    const totalSelected = highCount + highMediumCount + mediumCount;
    const days = parseInt(document.getElementById('plan-days')?.value) || 30;
    
    // Update calculation results
    const highCountEl = document.getElementById('high-count');
    const highMediumCountEl = document.getElementById('high-medium-count');
    const mediumCountEl = document.getElementById('medium-count');
    const totalSelectedEl = document.getElementById('total-selected');
    
    if (highCountEl) highCountEl.textContent = highChecked ? highCount : 'Not selected';
    if (highMediumCountEl) highMediumCountEl.textContent = highMediumChecked ? highMediumCount : 'Not selected';
    if (mediumCountEl) mediumCountEl.textContent = mediumChecked ? mediumCount : 'Not selected';
    if (totalSelectedEl) totalSelectedEl.textContent = totalSelected;
    
    // Calculate problems per day
    const problemsPerDay = Math.ceil(totalSelected / days) || 0;
    const problemsPerDayInput = document.getElementById('problems-per-day');
    if (problemsPerDayInput) problemsPerDayInput.value = problemsPerDay;
}

// This contains the missing functions for your LeetCode Tracker implementation

// Complete the generateStudyPlan function
function generateStudyPlan(forceRegenerate = false) {
    if (studyPlan.length > 0 && !forceRegenerate) {
        console.log('Study plan already exists. Rendering existing plan.');
        renderTodayProblems();
        renderPendingProblems();
        renderRevisionProblems();
        return;
    }
    
    const planDaysEl = document.getElementById('plan-days');
    const problemsPerDayEl = document.getElementById('problems-per-day');
    
    if (!planDaysEl || !problemsPerDayEl) {
        console.error('Required elements not found');
        return;
    }
    
    const numDays = parseInt(planDaysEl.value) || 30;
    const problemsPerDay = parseInt(problemsPerDayEl.value) || 3;
    
    // Get selected priorities
    const selectedPriorities = [];
    const highEl = document.getElementById('priority-high');
    const highMediumEl = document.getElementById('priority-high-medium');
    const mediumEl = document.getElementById('priority-medium');
    
    if (highEl && highEl.checked) selectedPriorities.push('High');
    if (highMediumEl && highMediumEl.checked) selectedPriorities.push('High-Medium');
    if (mediumEl && mediumEl.checked) selectedPriorities.push('Medium');
    
    if (selectedPriorities.length === 0) {
        alert('Please select at least one priority level');
        return;
    }
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    console.log('Generating study plan from:', today);
    console.log('Days:', numDays, 'Problems per day:', problemsPerDay);
    console.log('Selected priorities:', selectedPriorities);
    
    // Clear the existing study plan
    studyPlan = [];
    
    // Filter available problems
    const availableProblems = userProblems.filter(p => 
        (p.status === 'Not Started' || p.status === 'In Progress') &&
        selectedPriorities.includes(p.priority)
    );
    
    console.log(`Found ${availableProblems.length} available problems matching criteria`);
    
    if (availableProblems.length === 0) {
        alert('No problems found matching the selected priorities.');
        return;
    }
    
    // Sort problems by priority and difficulty
    const sortedProblems = [...availableProblems].sort((a, b) => {
        const priorityOrder = { 'High': 0, 'High-Medium': 1, 'Medium': 2 };
        const priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];
        
        if (priorityDiff !== 0) return priorityDiff;
        
        if (a.status === 'In Progress' && b.status !== 'In Progress') return -1;
        if (a.status !== 'In Progress' && b.status === 'In Progress') return 1;
        
        const difficultyOrder = { 'Easy': 0, 'Medium': 1, 'Hard': 2 };
        return difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty];
    });
    
    // Create a deep copy of the sorted problems to avoid reference issues
    const problemsCopy = JSON.parse(JSON.stringify(sortedProblems));
    let problemIndex = 0;
    
    // Generate a plan for each day
    for (let i = 0; i < numDays && problemIndex < problemsCopy.length; i++) {
        const planDate = new Date(today);
        planDate.setDate(today.getDate() + i);
        planDate.setHours(0, 0, 0, 0);
        
        const dayProblems = [];
        
        // Add problems for this day
        for (let j = 0; j < problemsPerDay && problemIndex < problemsCopy.length; j++) {
            dayProblems.push(problemsCopy[problemIndex]);
            problemIndex++;
        }
        
        if (dayProblems.length === 0) continue;
        
        // Determine categories covered in this day
        const dayCategories = [...new Set(dayProblems.map(p => p.category))];
        
        studyPlan.push({
            day: i,
            date: new Date(planDate.getTime()),
            problems: dayProblems,
            categories: dayCategories,
            focus: dayCategories.join(', ')
        });
    }
    
    console.log(`Generated ${studyPlan.length} study days`);
    
    // Update UI
    renderTodayProblems();
    renderPendingProblems();
    renderRevisionProblems();
    updateStatusCounts();
    
    // Save the study plan
    saveUserData()
        .then(() => {
            alert('Study plan generated and saved successfully!');
        })
        .catch(error => {
            console.error('Failed to save study plan:', error);
            alert('Study plan generated but there was an error saving to the database. Your changes may not persist after refreshing the page.');
        });
}

function createProblemItem(problem) {
    const item = document.createElement('li');
    item.className = 'problem-item';
    
    const problemInfo = document.createElement('div');
    problemInfo.className = 'problem-info';
    
    const problemTitle = document.createElement('div');
    problemTitle.className = 'problem-title';
    const problemLink = document.createElement('a');
    problemLink.href = problem.leetCodeUrl;
    problemLink.target = '_blank';
    problemLink.rel = 'noopener noreferrer';
    problemLink.textContent = problem.problem;
    problemTitle.appendChild(problemLink);
    problemInfo.appendChild(problemTitle);
    
    const problemMeta = document.createElement('div');
    problemMeta.className = 'problem-meta';
    problemMeta.innerHTML = `
        ${problem.category} - 
        <span class="${problem.difficulty.toLowerCase()}">${problem.difficulty}</span>
        ${problem.status !== 'Not Started' ? 
            `<span class="status-badge">
            <span class="status-dot status-${problem.status.toLowerCase().replace(' ', '-')}"></span>
            ${problem.status}
            </span>` : ''}
    `;
    problemInfo.appendChild(problemMeta);
    
    item.appendChild(problemInfo);
    
    const problemActions = document.createElement('div');
    problemActions.className = 'problem-actions';
    
    const completeBtn = document.createElement('button');
    completeBtn.className = 'icon-button';
    completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    completeBtn.title = 'Mark Complete';
    completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
    problemActions.appendChild(completeBtn);
    
    const needsRevisionBtn = document.createElement('button');
    needsRevisionBtn.className = 'icon-button';
    needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
    needsRevisionBtn.title = 'Mark Needs Revision';
    needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
    problemActions.appendChild(needsRevisionBtn);
    
    const codeBtn = document.createElement('a');
    codeBtn.className = 'icon-button';
    codeBtn.href = problem.codeUrl || problem.leetCodeUrl;
    codeBtn.target = '_blank';
    codeBtn.rel = 'noopener noreferrer';
    codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
    codeBtn.title = 'View Problem Code';
    problemActions.appendChild(codeBtn);
    
    item.appendChild(problemActions);
    
    return item;
}

function renderTodayProblems() {
    const todayContainer = document.getElementById('today-problems');
    if (!todayContainer) return;
    
    todayContainer.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Find today's problems from study plan
    let todayProblems = [];
    const todayPlan = studyPlan.find(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        return planDate.getTime() === today.getTime();
    });
    
    if (todayPlan) {
        // Get the latest version of each problem
        todayProblems = todayPlan.problems.map(p => {
            const currentVersion = userProblems.find(up => up.id === p.id);
            return currentVersion || p;
        });
    }
    
    // Also add problems that need revision today
    const revisionProblems = userProblems.filter(problem => {
        if (problem.status === 'Complete' && problem.revisionDates) {
            return problem.revisionDates.some(date => {
                if (!date) return false;
                const revisionDate = new Date(date);
                revisionDate.setHours(0, 0, 0, 0);
                return revisionDate.getTime() === today.getTime();
            });
        }
        return false;
    });
    
    // Combine regular and revision problems
    const allTodayProblems = [...todayProblems, ...revisionProblems.map(p => ({
        ...p,
        status: 'Needs Revision' // Override the status for display
    }))];
    
    if (allTodayProblems.length > 0) {
        allTodayProblems.forEach(problem => {
            const problemItem = createProblemItem(problem);
            todayContainer.appendChild(problemItem);
        });
    } else {
        todayContainer.innerHTML = '<div class="problem-item">No problems scheduled for today.</div>';
    }
}

function renderPendingProblems() {
    const pendingContainer = document.getElementById('pending-problems');
    if (!pendingContainer) return;
    
    pendingContainer.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Track processed problem IDs to avoid duplicates
    const processedIds = new Set();
    const pendingProblems = [];
    
    // Go through study plan to find pending problems
    studyPlan.forEach(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        
        if (planDate.getTime() < today.getTime()) {
            day.problems.forEach(problem => {
                // Check if we've already processed this problem
                if (!processedIds.has(problem.id)) {
                    processedIds.add(problem.id);
                    
                    // Find the current status of this problem
                    const currentProblem = userProblems.find(p => p.id === problem.id);
                    
                    // Only add if it's not completed
                    if (currentProblem && currentProblem.status !== 'Complete') {
                        pendingProblems.push({
                            ...currentProblem,
                            originalDate: planDate
                        });
                    }
                }
            });
        }
    });
    
    if (pendingProblems.length > 0) {
        // Sort by original scheduled date (oldest first)
        pendingProblems.sort((a, b) => a.originalDate - b.originalDate);
        
        pendingProblems.forEach(problem => {
            const problemItem = createProblemItem(problem);
            pendingContainer.appendChild(problemItem);
        });
    } else {
        pendingContainer.innerHTML = '<div class="problem-item">No pending problems. You\'re all caught up!</div>';
    }
}

function renderRevisionProblems() {
    const revisionContainer = document.getElementById('revision-problems');
    if (!revisionContainer) return;
    
    revisionContainer.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Find problems that need revision today
    const revisionProblems = userProblems.filter(problem => {
        if (problem.status === 'Complete' && problem.revisionDates) {
            return problem.revisionDates.some(date => {
                if (!date) return false;
                const revisionDate = new Date(date);
                revisionDate.setHours(0, 0, 0, 0);
                return revisionDate.getTime() === today.getTime();
            });
        }
        return false;
    });
    
    if (revisionProblems.length > 0) {
        revisionProblems.forEach(problem => {
            // Create a copy with revision status for display
            const revisedProblem = {
                ...problem,
                status: 'Needs Revision'
            };
            
            const problemItem = createProblemItem(revisedProblem);
            revisionContainer.appendChild(problemItem);
        });
    } else {
        revisionContainer.innerHTML = '<div class="problem-item">No problems need revision today.</div>';
    }
}

function addDebugControls() {
    const plannerTab = document.getElementById('planner-tab');
    if (!plannerTab || document.getElementById('debug-controls')) return;
    
    const debugDiv = document.createElement('div');
    debugDiv.id = 'debug-controls';
    debugDiv.style.marginTop = '20px';
    debugDiv.style.padding = '10px';
    debugDiv.style.border = '1px dashed var(--border)';
    debugDiv.style.borderRadius = '4px';
    debugDiv.style.backgroundColor = 'var(--bg-tertiary)';
    
    debugDiv.innerHTML = `
        <div style="font-size: 0.8rem; margin-bottom: 10px; color: var(--text-muted);">Troubleshooting Tools</div>
        <div style="display: flex; gap: 10px;">
            <button id="debug-state-btn" class="btn btn-secondary">Log Debug Info</button>
            <button id="reset-plan-btn" class="btn btn-secondary">Reset Study Plan</button>
        </div>
    `;
    
    plannerTab.appendChild(debugDiv);
    
    document.getElementById('debug-state-btn').addEventListener('click', debugState);
    document.getElementById('reset-plan-btn').addEventListener('click', resetStudyPlan);
}

function debugState() {
    console.log('Current user:', currentUser ? currentUser.uid : 'No user');
    console.log('Problems count:', userProblems.length);
    console.log('Study plan days:', studyPlan.length);
    
    if (studyPlan.length > 0) {
        console.log('Study plan date checks:');
        studyPlan.forEach((day, index) => {
            const validDate = day.date instanceof Date && !isNaN(day.date.getTime());
            console.log(`Day ${index}: date=${day.date}, valid=${validDate}`);
            
            if (!validDate) {
                console.warn('Invalid date found:', day.date);
            }
        });
    }
    
    alert(`Debug info logged to console.\nUser: ${currentUser ? 'Logged in' : 'Not logged in'}\nProblems: ${userProblems.length}\nStudy Plan Days: ${studyPlan.length}`);
}

function resetStudyPlan() {
    if (confirm('Are you sure you want to reset your study plan? This cannot be undone.')) {
        console.log('Resetting study plan');
        studyPlan = [];
        
        renderTodayProblems();
        renderPendingProblems();
        renderRevisionProblems();
        updateStatusCounts();
        
        saveUserData()
            .then(() => {
                alert('Study plan has been reset successfully.');
            })
            .catch(error => {
                console.error('Failed to save reset study plan:', error);
                alert('There was an error resetting your study plan. Please try again.');
            });
    }
}

// End of LeetCode Tracker Script
    </script>
</body>
</html>
