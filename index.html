<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Navigator - Problem Tracker</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    
    <!-- AG Grid CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/styles/ag-theme-alpine-dark.css">
    
    <style>
        :root {
            --accent-color: #ffffff; /* White */
            --accent-hover: #e2e8f0; /* Light gray on hover */
            --secondary-color: #f9fafb;
            --border-color: #334155;
            --header-bg: #1e293b;
            --sidebar-bg: #0f172a;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            --easy-color: #10b981; /* Changed to more subtle teal-green */
            --easy-color-dark: #0d9488; /* Darker variant for hover states */
            --medium-color: #f59e0b;
            --hard-color: #ef4444;
            --expired-color: #ef4444;
            --text-muted: #94a3b8;
            --text-color: #f1f5f9;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --accent-text: #10b981; /* Matching accent text color */
            --primary-color: var(--accent-color);
            --primary-hover: var(--accent-hover);
            --high-priority: #ef4444;
            --medium-priority: #f59e0b;
            --low-priority: #3b82f6;
        }
        
        /* Base Reset & Typography */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
        }
        
        /* Rotation Animation */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes colorChange {
            0% { stroke: #ffffff; }    /* White */
            25% { stroke: #22c55e; }   /* Green */
            50% { stroke: #3b82f6; }   /* Blue */
            75% { stroke: #facc15; }   /* Yellow */
            100% { stroke: #ffffff; }  /* Back to White */
        }
        
        /* Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background-color: var(--header-bg);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            z-index: 50;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .compass-icon {
            display: inline-block;
            margin: 0 8px;
            animation: rotate 4s linear infinite;
            transform-origin: center;
        }
        
        .compass-icon svg {
            stroke: var(--accent-color);
            animation: colorChange 4s linear infinite;
            display: block;
        }
        
        .app-logo h1 {
            display: flex;
            align-items: center;
            gap: 0px;
            margin: 0;
            font-size: 1.2rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
        }
        
        /* Auth Container */
        .auth-container {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-btn {
            background-color: #333;
            color: #ddd;
            border: 1px solid #555;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        
        .auth-btn:hover {
            background-color: #444;
        }
        
        /* Main Content Area */
        .main-content {
            margin-top: 64px;
            padding: 1.5rem;
        }
        
        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        /* Stats Section */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        .stat-value {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .total-value { color: white; }
        .completed-value { color: var(--easy-color); }
        .review-value { color: var(--accent-text); }
        .pending-value { color: var(--medium-color); }
        .today-value { color: var(--hard-color); }
        .priority-value { color: var(--accent-text); }
        
        /* Study Planner */
        .planner-row {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        .planner-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-text);
        }
        
        .planner-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .planner-input {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            color: white;
            padding: 0.25rem 0.5rem;
            width: 4rem;
            font-size: 0.875rem;
        }
        
        .planner-days {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .planner-btn {
            background-color: var(--easy-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .planner-btn:hover {
            background-color: var(--easy-color-dark);
        }
        
        /* Priority Checkboxes */
        .priority-filters {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-right: 1rem;
        }
        
        .priority-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .priority-check input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 1rem;
            height: 1rem;
            border-radius: 3px;
            border: 2px solid var(--border-color);
            outline: none;
            cursor: pointer;
            position: relative;
        }
        
        .priority-check input[type="checkbox"]:checked {
            background-color: var(--easy-color);
            border-color: var(--easy-color);
        }
        
        .priority-check input[type="checkbox"]:checked::after {
            content: "✓";
            position: absolute;
            top: -3px;
            left: 1px;
            color: white;
            font-size: 11px;
        }
        
        .priority-check.high input[type="checkbox"]:checked {
            background-color: var(--high-priority);
            border-color: var(--high-priority);
        }
        
        .priority-check.medium input[type="checkbox"]:checked {
            background-color: var(--medium-priority);
            border-color: var(--medium-priority);
        }
        
        .priority-check.low input[type="checkbox"]:checked {
            background-color: var(--low-priority);
            border-color: var(--low-priority);
        }
        
        .priority-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .priority-label.high {
            color: var(--high-priority);
        }
        
        .priority-label.medium {
            color: var(--medium-priority);
        }
        
        .priority-label.low {
            color: var(--low-priority);
        }
        
        /* View Tabs */
        .view-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .view-tab {
            background-color: var(--card-bg);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .view-tab:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .view-tab.active {
            background-color: var(--easy-color);
            color: white;
            border-color: var(--easy-color);
            font-weight: 500;
        }
        
        .revision-count {
            background-color: var(--easy-color);
            color: white;
            border-radius: 9999px;
            padding: 0.125rem 0.375rem;
            font-size: 0.625rem;
            font-weight: 500;
        }
        
        /* Problems Table */
        .problems-container {
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            height: calc(100vh - 250px);
            overflow-y: auto;
        }
        
        .problems-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .problems-table th {
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text-muted);
            font-weight: 500;
            text-align: left;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .problems-table td {
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        .problems-table tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        /* Problem Status */
        .status-checkbox {
            width: 1.125rem;
            height: 1.125rem;
            border-radius: 0.25rem;
            border: 2px solid var(--border-color);
            display: inline-block;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .status-checkbox.completed {
            background-color: var(--easy-color);
            border-color: var(--easy-color);
        }
        
        .status-checkbox.completed:after {
            content: "✓";
            position: absolute;
            top: -3px;
            left: 2px;
            color: white;
            font-size: 11px;
            font-weight: normal;
        }
        
        /* Problem Link */
        .problem-link {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .problem-link:hover {
            color: var(--accent-text);
        }
        
        /* Difficulty Tags */
        .difficulty-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .difficulty-tag.easy {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--easy-color);
        }
        
        .difficulty-tag.medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--medium-color);
        }
        
        .difficulty-tag.hard {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--hard-color);
        }
        
        /* Priority Tag */
        .priority-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .priority-tag.high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--high-priority);
        }
        
        .priority-tag.medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--medium-priority);
        }
        
        .priority-tag.low {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--low-priority);
        }
        
        /* Due Date */
        .due-date {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .due-date.expired {
            color: var(--expired-color);
            font-weight: 500;
        }
        
        /* Action Buttons */
        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--accent-text);
        }
        
        .action-btn.marked {
            color: var(--accent-text);
        }
        
        .action-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        /* Category Style */
        .category-tag {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
        
        /* AG Grid Custom Styles */
        .ag-theme-alpine-dark {
            --ag-background-color: var(--card-bg);
            --ag-foreground-color: var(--text-color);
            --ag-border-color: var(--border-color);
            --ag-header-background-color: rgba(0, 0, 0, 0.2);
            --ag-row-hover-color: rgba(255, 255, 255, 0.03);
            --ag-header-foreground-color: var(--text-muted);
            --ag-font-size: 0.875rem;
            --ag-font-family: 'Inter', sans-serif;
        }

        /* Table footer */
        .table-footer {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pagination {
            display: flex;
            gap: 0.25rem;
        }
        
        .pagination-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .pagination-btn.active {
            background-color: var(--easy-color);
            color: white;
            border-color: var(--easy-color);
            font-weight: 500;
        }
        
        /* Notes Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            overflow: auto;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 1.5rem;
            border-radius: 0.5rem;
            width: 60%;
            max-width: 700px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--text-muted);
            background: transparent;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: white;
        }
        
        .notes-textarea {
            width: 100%;
            height: 200px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: white;
            padding: 0.75rem;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: 1rem;
        }
        
        .save-notes {
            background-color: var(--easy-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .save-notes:hover {
            background-color: var(--easy-color-dark);
        }
        
        /* Notes View */
        .notes-view {
            display: none;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            height: calc(100vh - 250px);
        }
        
        .note-card {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .note-title {
            font-weight: 600;
        }
        
        .note-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .note-content {
            padding: 0.5rem 0;
            border-top: 1px solid var(--border-color);
            margin-top: 0.5rem;
            white-space: pre-wrap;
        }
        
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            padding: 1rem;
            overflow-y: auto;
            max-height: calc(100vh - 250px);
        }
        
        /* Firebase Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--easy-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.error {
            background-color: var(--hard-color);
        }
        /* Updated Stats Section CSS */
.stats-row {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 0.5rem;
    margin-bottom: 0.75rem; /* Reduced margin */
}

.stat-card {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    padding: 0.35rem; /* Reduced padding */
    text-align: center;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    font-size: 0.875rem; /* Smaller font size */
}

.stat-value {
    font-size: 1rem; /* Reduced from 1.125rem */
    font-weight: 600;
    margin-bottom: 0.15rem; /* Reduced margin */
}

.stat-label {
    font-size: 0.7rem; /* Reduced from 0.75rem */
    color: var(--text-muted);
}
        /* Problems Table - increased height */
.problems-container {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    height: calc(100vh - 215px); /* Increased from 250px */
    overflow-y: auto;
}

/* Notes View - match the problems container height */
.notes-view {
    display: none;
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    height: calc(100vh - 215px); /* Increased from 250px */
}

.notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
    padding: 1rem;
    overflow-y: auto;
    max-height: calc(100vh - 215px); /* Increased from 250px */
}
        /* Study Planner - more compact */
.planner-row {
    background-color: var(--card-bg);
    border-radius: 0.5rem;
    padding: 0.5rem 1rem; /* Reduced from 0.75rem */
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem; /* Reduced from 1rem */
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
}

/* View Tabs - more compact */
.view-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem; /* Reduced from 1rem */
}

.view-tab {
    background-color: var(--card-bg);
    color: var(--text-muted);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    padding: 0.35rem 0.75rem; /* Reduced from 0.5rem 1rem */
    font-size: 0.7rem; /* Reduced from 0.75rem */
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
}
        .reset-plan-btn {
    background-color: rgba(239, 68, 68, 0.2);
    color: var(--high-priority);
    border: 1px solid var(--high-priority);
    border-radius: 0.25rem;
    padding: 0.25rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    margin-left: 1rem;
}

.reset-plan-btn:hover {
    background-color: rgba(239, 68, 68, 0.3);
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="app-logo">
            <h1>
                <span>Tech</span>
                <div class="compass-icon">
                    <svg fill="none" height="28" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="28" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M16.24 7.76l-2.12 6.36-6.36 2.12 2.12-6.36 6.36-2.12z"></path>
                    </svg>
                </div>
                <span>Navigator</span>
            </h1>
        </div>
        <div class="auth-container">
            <button class="auth-btn" id="authBtn">
                <img alt="Google" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width: 18px; margin-right: 8px;"/>
                Sign in
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Stats Section -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value total-value" id="totalProblems">175</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value completed-value" id="completedProblems">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value review-value" id="reviewProblems">0</div>
                <div class="stat-label">Review</div>
            </div>
            <div class="stat-card">
                <div class="stat-value pending-value" id="pendingProblems">175</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-value today-value" id="todayProblems">0</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="highPriorityStats">0/95</div>
                <div class="stat-label">High</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="mediumPriorityStats">0/60</div>
                <div class="stat-label">Medium</div>
            </div>
            <div class="stat-card">
                <div class="stat-value priority-value" id="lowPriorityStats">0/20</div>
                <div class="stat-label">Low</div>
            </div>
        </div>
        
        <!-- Study Planner -->
        <div class="planner-row">
            <div class="planner-title">Study Planner</div>
            <div class="planner-controls">
                <div class="priority-filters">
                    <label class="priority-check high">
                        <input type="checkbox" checked id="highPriorityCheck">
                        <span class="priority-label high">High</span>
                    </label>
                    <label class="priority-check medium">
                        <input type="checkbox" checked id="mediumPriorityCheck">
                        <span class="priority-label medium">Medium</span>
                    </label>
                    <label class="priority-check low">
                        <input type="checkbox" checked id="lowPriorityCheck">
                        <span class="priority-label low">Low</span>
                    </label>
                </div>
                <input type="number" class="planner-input" id="plannerDays" value="30" min="1">
                <span class="planner-days">days</span>
                <button class="planner-btn" id="generatePlanBtn">Generate</button>
                <button class="reset-plan-btn" id="resetPlanBtn">Reset Plan</button>
            </div>
        </div>
        
        <!-- View Tabs -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="all">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 6h13"></path>
                    <path d="M8 12h13"></path>
                    <path d="M8 18h13"></path>
                    <path d="M3 6h.01"></path>
                    <path d="M3 12h.01"></path>
                    <path d="M3 18h.01"></path>
                </svg>
                All Problems (<span id="allCount">175</span>)
            </button>
            <button class="view-tab" data-view="today">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Today (<span id="todayCount">0</span>)
            </button>
            <button class="view-tab" data-view="completed">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                Completed (<span id="completedCount">0</span>)
            </button>
            <button class="view-tab" data-view="review">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 11 12 14 22 4"></polyline>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                For Review (<span id="reviewCount">0</span>)
            </button>
            <button class="view-tab" data-view="pending">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                    <polyline points="13 2 13 9 20 9"></polyline>
                </svg>
                Pending (<span id="pendingCount">175</span>)
            </button>
            <button class="view-tab" data-view="notes">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <path d="M14 2v6h6"></path>
                    <path d="M16 13H8"></path>
                    <path d="M16 17H8"></path>
                    <path d="M10 9H8"></path>
                </svg>
                Notes (<span id="notesCount">0</span>)
            </button>
        </div>
        
        <!-- Problems Table -->
        <div class="problems-container" id="problemsContainer">
            <table class="problems-table" id="problemsTable">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Problem</th>
                        <th>Category</th>
                        <th>Difficulty</th>
                        <th>Priority</th>
                        <th>Due Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="problemsTableBody">
                    <!-- Table rows will be added here dynamically -->
                </tbody>
            </table>
            
            <!-- Table Footer with Pagination -->
            <div class="table-footer">
                <div id="tableInfo">Showing 0 of 175 problems</div>
                <div class="pagination" id="pagination">
                <button class="pagination-btn" id="prevPageBtn">Prev</button>
                <!-- Page buttons will be generated dynamically -->
                <button class="pagination-btn" id="nextPageBtn">Next</button>
            </div>
            </div>
        </div>
        
        <!-- Notes View -->
        <div class="notes-view" id="notesView">
            <div class="notes-grid" id="notesGrid">
                <!-- Notes will be populated here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Notes Modal -->
    <div class="modal" id="notesModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h3 class="modal-title" id="problemTitle">Problem Notes</h3>
            <textarea class="notes-textarea" id="notesTextarea" placeholder="Add your notes here..."></textarea>
            <button class="save-notes" id="saveNotesBtn">Save Notes</button>
        </div>
    </div>
    
    <!-- Toast Message -->
    <div class="toast" id="toast"></div>

    <!-- AG Grid JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@30.0.3/dist/ag-grid-community.min.js"></script>
    
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth-compat.js"></script>
    
    <script>
        // JavaScript code will go here
        // Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyBnbrX52t_Y2QgJv5nNA4xeb0ZX94_kKeY",
  authDomain: "technavigator-8ecd1.firebaseapp.com",
  projectId: "technavigator-8ecd1",
  storageBucket: "technavigator-8ecd1.firebasestorage.app",
  messagingSenderId: "316020740391",
  appId: "1:316020740391:web:2f3ba461d5a179154cd902",
  measurementId: "G-WE013C9L92"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Main data store and application state
let problems = []; // Will be populated from paste.txt data
let userProblems = []; // Will store user-specific problem data from Firebase
let currentUser = null;
let currentView = 'all';
let currentPage = 1;
const itemsPerPage = 20;
let problemsToShow = [];
let notesData = []; // Stores user notes

// DOM Elements
const authBtn = document.getElementById('authBtn');
const problemsContainer = document.getElementById('problemsContainer');
const notesView = document.getElementById('notesView');
const problemsTableBody = document.getElementById('problemsTableBody');
const tableInfo = document.getElementById('tableInfo');
const pagination = document.getElementById('pagination');
const prevPageBtn = document.getElementById('prevPageBtn');
const nextPageBtn = document.getElementById('nextPageBtn');
const notesModal = document.getElementById('notesModal');
const closeModal = document.getElementById('closeModal');
const problemTitle = document.getElementById('problemTitle');
const notesTextarea = document.getElementById('notesTextarea');
const saveNotesBtn = document.getElementById('saveNotesBtn');
const notesGrid = document.getElementById('notesGrid');
const generatePlanBtn = document.getElementById('generatePlanBtn');
const plannerDays = document.getElementById('plannerDays');
const highPriorityCheck = document.getElementById('highPriorityCheck');
const mediumPriorityCheck = document.getElementById('mediumPriorityCheck');
const lowPriorityCheck = document.getElementById('lowPriorityCheck');
const viewTabs = document.querySelectorAll('.view-tab');
const toast = document.getElementById('toast');

// Counter elements
const totalProblemsEl = document.getElementById('totalProblems');
const completedProblemsEl = document.getElementById('completedProblems');
const reviewProblemsEl = document.getElementById('reviewProblems');
const pendingProblemsEl = document.getElementById('pendingProblems');
const todayProblemsEl = document.getElementById('todayProblems');
const highPriorityStatsEl = document.getElementById('highPriorityStats');
const mediumPriorityStatsEl = document.getElementById('mediumPriorityStats');
const lowPriorityStatsEl = document.getElementById('lowPriorityStats');

// Tab count elements
const allCountEl = document.getElementById('allCount');
const todayCountEl = document.getElementById('todayCount');
const completedCountEl = document.getElementById('completedCount');
const reviewCountEl = document.getElementById('reviewCount');
const pendingCountEl = document.getElementById('pendingCount');
const notesCountEl = document.getElementById('notesCount');

// Load problems data from the variable in paste.txt
function loadProblemsData() {
    // This is the data from paste.txt
    // Include the full problems data from paste.txt
    
// Main data store - initializing these variables at the top level
problems = [
{ id: 1, problem: "Contains Duplicate", number: 217, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/contains-duplicate/", codeUrl: "https://leetcode.com/problems/contains-duplicate/description/" },
{ id: 2, problem: "Two Sum", number: 1, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/two-sum/", codeUrl: "https://leetcode.com/problems/two-sum/description/" },
{ id: 3, problem: "Valid Anagram", number: 242, category: "Arrays & Hashing", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-anagram/", codeUrl: "https://leetcode.com/problems/valid-anagram/description/" },
{ id: 4, problem: "Group Anagrams", number: 49, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/group-anagrams/", codeUrl: "https://leetcode.com/problems/group-anagrams/description/" },
{ id: 5, problem: "Top K Frequent Elements", number: 347, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/top-k-frequent-elements/", codeUrl: "https://leetcode.com/problems/top-k-frequent-elements/description/" },
{ id: 6, problem: "Product of Array Except Self", number: 238, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/product-of-array-except-self/", codeUrl: "https://leetcode.com/problems/product-of-array-except-self/description/" },
{ id: 7, problem: "Longest Consecutive Sequence", number: 128, category: "Arrays & Hashing", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-consecutive-sequence/", codeUrl: "https://leetcode.com/problems/longest-consecutive-sequence/description/" },
{ id: 8, problem: "Valid Palindrome", number: 125, category: "Two Pointers", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-palindrome/", codeUrl: "https://leetcode.com/problems/valid-palindrome/description/" },
{ id: 9, problem: "3Sum", number: 15, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/3sum/", codeUrl: "https://leetcode.com/problems/3sum/description/" },
{ id: 10, problem: "Container With Most Water", number: 11, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/container-with-most-water/", codeUrl: "https://leetcode.com/problems/container-with-most-water/description/" },
{ id: 11, problem: "Trapping Rain Water", number: 42, category: "Two Pointers", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/trapping-rain-water/", codeUrl: "https://leetcode.com/problems/trapping-rain-water/description/" },
{ id: 12, problem: "Two Sum II - Input Array Is Sorted", number: 167, category: "Two Pointers", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/", codeUrl: "https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/description/" },
{ id: 13, problem: "Best Time to Buy and Sell Stock", number: 121, category: "Sliding Window", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", codeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/description/" },
{ id: 14, problem: "Longest Substring Without Repeating Characters", number: 3, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", codeUrl: "https://leetcode.com/problems/longest-substring-without-repeating-characters/description/" },
{ id: 15, problem: "Longest Repeating Character Replacement", number: 424, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-repeating-character-replacement/", codeUrl: "https://leetcode.com/problems/longest-repeating-character-replacement/description/" },
{ id: 16, problem: "Permutation in String", number: 567, category: "Sliding Window", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/permutation-in-string/", codeUrl: "https://leetcode.com/problems/permutation-in-string/description/" },
{ id: 17, problem: "Minimum Window Substring", number: 76, category: "Sliding Window", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/minimum-window-substring/", codeUrl: "https://leetcode.com/problems/minimum-window-substring/description/" },
{ id: 18, problem: "Valid Parentheses", number: 20, category: "Stack", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/valid-parentheses/", codeUrl: "https://leetcode.com/problems/valid-parentheses/description/" },
{ id: 19, problem: "Min Stack", number: 155, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/min-stack/", codeUrl: "https://leetcode.com/problems/min-stack/description/" },
{ id: 20, problem: "Generate Parentheses", number: 22, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/generate-parentheses/", codeUrl: "https://leetcode.com/problems/generate-parentheses/description/" },
{ id: 21, problem: "Daily Temperatures", number: 739, category: "Stack", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/daily-temperatures/", codeUrl: "https://leetcode.com/problems/daily-temperatures/description/" },
{ id: 22, problem: "Largest Rectangle in Histogram", number: 84, category: "Stack", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/largest-rectangle-in-histogram/", codeUrl: "https://leetcode.com/problems/largest-rectangle-in-histogram/description/" },
{ id: 23, problem: "Binary Search", number: 704, category: "Binary Search", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/binary-search/", codeUrl: "https://leetcode.com/problems/binary-search/description/" },
{ id: 24, problem: "Search a 2D Matrix", number: 74, category: "Binary Search", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/search-a-2d-matrix/", codeUrl: "https://leetcode.com/problems/search-a-2d-matrix/description/" },
{ id: 25, problem: "Find Minimum in Rotated Sorted Array", number: 153, category: "Binary Search", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", codeUrl: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/description/" },
{ id: 26, problem: "Search in Rotated Sorted Array", number: 33, category: "Binary Search", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/search-in-rotated-sorted-array/", codeUrl: "https://leetcode.com/problems/search-in-rotated-sorted-array/description/" },
{ id: 27, problem: "Median of Two Sorted Arrays", number: 4, category: "Binary Search", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/median-of-two-sorted-arrays/", codeUrl: "https://leetcode.com/problems/median-of-two-sorted-arrays/description/" },
{ id: 28, problem: "Reverse Linked List", number: 206, category: "Linked List", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/reverse-linked-list/", codeUrl: "https://leetcode.com/problems/reverse-linked-list/description/" },
{ id: 29, problem: "Merge Two Sorted Lists", number: 21, category: "Linked List", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/merge-two-sorted-lists/", codeUrl: "https://leetcode.com/problems/merge-two-sorted-lists/description/" },
{ id: 30, problem: "Reorder List", number: 143, category: "Linked List", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/reorder-list/", codeUrl: "https://leetcode.com/problems/reorder-list/description/" },
{ id: 31, problem: "LRU Cache", number: 146, category: "Linked List", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/lru-cache/", codeUrl: "https://leetcode.com/problems/lru-cache/description/" },
{ id: 32, problem: "Merge k Sorted Lists", number: 23, category: "Linked List", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/merge-k-sorted-lists/", codeUrl: "https://leetcode.com/problems/merge-k-sorted-lists/description/" },
{ id: 33, problem: "Invert Binary Tree", number: 226, category: "Trees", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/invert-binary-tree/", codeUrl: "https://leetcode.com/problems/invert-binary-tree/description/" },
{ id: 34, problem: "Maximum Depth of Binary Tree", number: 104, category: "Trees", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/maximum-depth-of-binary-tree/", codeUrl: "https://leetcode.com/problems/maximum-depth-of-binary-tree/description/" },
{ id: 35, problem: "Binary Tree Level Order Traversal", number: 102, category: "Trees", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/binary-tree-level-order-traversal/", codeUrl: "https://leetcode.com/problems/binary-tree-level-order-traversal/description/" },
{ id: 36, problem: "Lowest Common Ancestor of a Binary Tree", number: 236, category: "Trees", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/", codeUrl: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/description/" },
{ id: 37, problem: "Binary Tree Maximum Path Sum", number: 124, category: "Trees", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/binary-tree-maximum-path-sum/", codeUrl: "https://leetcode.com/problems/binary-tree-maximum-path-sum/description/" },
{ id: 38, problem: "Validate Binary Search Tree", number: 98, category: "Trees", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/validate-binary-search-tree/", codeUrl: "https://leetcode.com/problems/validate-binary-search-tree/description/" },
{ id: 39, problem: "Serialize and Deserialize Binary Tree", number: 297, category: "Trees", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/serialize-and-deserialize-binary-tree/", codeUrl: "https://leetcode.com/problems/serialize-and-deserialize-binary-tree/description/" },
{ id: 40, problem: "Implement Trie (Prefix Tree)", number: 208, category: "Tries", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/implement-trie-prefix-tree/", codeUrl: "https://leetcode.com/problems/implement-trie-prefix-tree/description/" },
{ id: 41, problem: "Design Add and Search Words Data Structure", number: 211, category: "Tries", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/design-add-and-search-words-data-structure/", codeUrl: "https://leetcode.com/problems/design-add-and-search-words-data-structure/description/" },
{ id: 42, problem: "Word Search II", number: 212, category: "Tries", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/word-search-ii/", codeUrl: "https://leetcode.com/problems/word-search-ii/description/" },
{ id: 43, problem: "Kth Largest Element in an Array", number: 215, category: "Heap / Priority Queue", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/kth-largest-element-in-an-array/", codeUrl: "https://leetcode.com/problems/kth-largest-element-in-an-array/description/" },
{ id: 44, problem: "Task Scheduler", number: 621, category: "Heap / Priority Queue", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/task-scheduler/", codeUrl: "https://leetcode.com/problems/task-scheduler/description/" },
{ id: 45, problem: "Find Median from Data Stream", number: 295, category: "Heap / Priority Queue", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-median-from-data-stream/", codeUrl: "https://leetcode.com/problems/find-median-from-data-stream/description/" },
{ id: 46, problem: "Subsets", number: 78, category: "Backtracking", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/subsets/", codeUrl: "https://leetcode.com/problems/subsets/description/" },
{ id: 47, problem: "Combination Sum", number: 39, category: "Backtracking", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/combination-sum/", codeUrl: "https://leetcode.com/problems/combination-sum/description/" },
{ id: 48, problem: "Word Search", number: 79, category: "Backtracking", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/word-search/", codeUrl: "https://leetcode.com/problems/word-search/description/" },
{ id: 49, problem: "Insert Interval", number: 57, category: "Intervals", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/insert-interval/", codeUrl: "https://leetcode.com/problems/insert-interval/description/" },
{ id: 50, problem: "Merge Intervals", number: 56, category: "Intervals", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/merge-intervals/", codeUrl: "https://leetcode.com/problems/merge-intervals/description/" },
{ id: 51, problem: "Non-overlapping Intervals", number: 435, category: "Intervals", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/non-overlapping-intervals/", codeUrl: "https://leetcode.com/problems/non-overlapping-intervals/description/" },
{ id: 52, problem: "Meeting Rooms II", number: 253, category: "Intervals", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/meeting-rooms-ii/", codeUrl: "https://leetcode.com/problems/meeting-rooms-ii/description/" },
{ id: 53, problem: "Jump Game", number: 55, category: "Greedy", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/jump-game/", codeUrl: "https://leetcode.com/problems/jump-game/description/" },
{ id: 54, problem: "Jump Game II", number: 45, category: "Greedy", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/jump-game-ii/", codeUrl: "https://leetcode.com/problems/jump-game-ii/description/" },
{ id: 55, problem: "Gas Station", number: 134, category: "Greedy", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/gas-station/", codeUrl: "https://leetcode.com/problems/gas-station/description/" },
{ id: 56, problem: "Climbing Stairs", number: 70, category: "1D Dynamic Programming", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/climbing-stairs/", codeUrl: "https://leetcode.com/problems/climbing-stairs/description/" },
{ id: 57, problem: "House Robber", number: 198, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/house-robber/", codeUrl: "https://leetcode.com/problems/house-robber/description/" },
{ id: 58, problem: "House Robber II", number: 213, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/house-robber-ii/", codeUrl: "https://leetcode.com/problems/house-robber-ii/description/" },
{ id: 59, problem: "Longest Palindromic Substring", number: 5, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-palindromic-substring/", codeUrl: "https://leetcode.com/problems/longest-palindromic-substring/description/" },
{ id: 60, problem: "Palindromic Substrings", number: 647, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/palindromic-substrings/", codeUrl: "https://leetcode.com/problems/palindromic-substrings/description/" },
{ id: 61, problem: "Decode Ways", number: 91, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/decode-ways/", codeUrl: "https://leetcode.com/problems/decode-ways/description/" },
{ id: 62, problem: "Coin Change", number: 322, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/coin-change/", codeUrl: "https://leetcode.com/problems/coin-change/description/" },
{ id: 63, problem: "Maximum Subarray", number: 53, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/maximum-subarray/", codeUrl: "https://leetcode.com/problems/maximum-subarray/description/" },
{ id: 64, problem: "Maximum Product Subarray", number: 152, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/maximum-product-subarray/", codeUrl: "https://leetcode.com/problems/maximum-product-subarray/description/" },
{ id: 65, problem: "Word Break", number: 139, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/word-break/", codeUrl: "https://leetcode.com/problems/word-break/description/" },
{ id: 66, problem: "Longest Increasing Subsequence", number: 300, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-increasing-subsequence/", codeUrl: "https://leetcode.com/problems/longest-increasing-subsequence/description/" },
{ id: 67, problem: "Partition Equal Subset Sum", number: 416, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/partition-equal-subset-sum/", codeUrl: "https://leetcode.com/problems/partition-equal-subset-sum/description/" },
{ id: 68, problem: "Combination Sum IV", number: 377, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/combination-sum-iv/", codeUrl: "https://leetcode.com/problems/combination-sum-iv/description/" },
{ id: 69, problem: "Unique Paths", number: 62, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/unique-paths/", codeUrl: "https://leetcode.com/problems/unique-paths/description/" },
{ id: 70, problem: "Longest Common Subsequence", number: 1143, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-common-subsequence/", codeUrl: "https://leetcode.com/problems/longest-common-subsequence/description/" },
{ id: 71, problem: "Best Time to Buy and Sell Stock with Cooldown", number: 309, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/", codeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/description/" },
{ id: 72, problem: "Edit Distance", number: 72, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/edit-distance/", codeUrl: "https://leetcode.com/problems/edit-distance/description/" },
{ id: 73, problem: "Target Sum", number: 494, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/target-sum/", codeUrl: "https://leetcode.com/problems/target-sum/description/" },
{ id: 74, problem: "Interleaving String", number: 97, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/interleaving-string/", codeUrl: "https://leetcode.com/problems/interleaving-string/description/" },
{ id: 75, problem: "Coin Change II", number: 518, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/coin-change-ii/", codeUrl: "https://leetcode.com/problems/coin-change-ii/description/" },
{ id: 76, problem: "Number of Islands", number: 200, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/number-of-islands/", codeUrl: "https://leetcode.com/problems/number-of-islands/description/" },
{ id: 77, problem: "Clone Graph", number: 133, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/clone-graph/", codeUrl: "https://leetcode.com/problems/clone-graph/description/" },
{ id: 78, problem: "Pacific Atlantic Water Flow", number: 417, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/pacific-atlantic-water-flow/", codeUrl: "https://leetcode.com/problems/pacific-atlantic-water-flow/description/" },
{ id: 79, problem: "Course Schedule", number: 207, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/course-schedule/", codeUrl: "https://leetcode.com/problems/course-schedule/description/" },
{ id: 80, problem: "Course Schedule II", number: 210, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/course-schedule-ii/", codeUrl: "https://leetcode.com/problems/course-schedule-ii/description/" },
{ id: 81, problem: "Graph Valid Tree", number: 261, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/graph-valid-tree/", codeUrl: "https://leetcode.com/problems/graph-valid-tree/description/" },
{ id: 82, problem: "Number of Connected Components", number: 323, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/number-of-connected-components-in-an-undirected-graph/", codeUrl: "https://leetcode.com/problems/number-of-connected-components-in-an-undirected-graph/description/" },
{ id: 83, problem: "Word Ladder", number: 127, category: "Graphs", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/word-ladder/", codeUrl: "https://leetcode.com/problems/word-ladder/description/" },
{ id: 84, problem: "Network Delay Time", number: 743, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/network-delay-time/", codeUrl: "https://leetcode.com/problems/network-delay-time/description/" },
{ id: 85, problem: "Redundant Connection", number: 684, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/redundant-connection/", codeUrl: "https://leetcode.com/problems/redundant-connection/description/" },
{ id: 86, problem: "Rotting Oranges", number: 994, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/rotting-oranges/", codeUrl: "https://leetcode.com/problems/rotting-oranges/description/" },
{ id: 87, problem: "Surrounded Regions", number: 130, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/surrounded-regions/", codeUrl: "https://leetcode.com/problems/surrounded-regions/description/" },
{ id: 88, problem: "Alien Dictionary", number: 269, category: "Graphs", difficulty: "Hard", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/alien-dictionary/", codeUrl: "https://leetcode.com/problems/alien-dictionary/description/" },
{ id: 89, problem: "Cheapest Flights Within K Stops", number: 787, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/cheapest-flights-within-k-stops/", codeUrl: "https://leetcode.com/problems/cheapest-flights-within-k-stops/description/" },
{ id: 90, problem: "Evaluate Division", number: 399, category: "Graphs", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/evaluate-division/", codeUrl: "https://leetcode.com/problems/evaluate-division/description/" },
{ id: 91, problem: "Design Twitter", number: 355, category: "Design", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/design-twitter/", codeUrl: "https://leetcode.com/problems/design-twitter/description/" },
{ id: 92, problem: "Design Browser History", number: 1472, category: "Design", difficulty: "Medium", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/design-browser-history/", codeUrl: "https://leetcode.com/problems/design-browser-history/description/" },
{ id: 93, problem: "Single Number", number: 136, category: "Bit Manipulation", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/single-number/", codeUrl: "https://leetcode.com/problems/single-number/description/" },
{ id: 94, problem: "Counting Bits", number: 338, category: "Bit Manipulation", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/counting-bits/", codeUrl: "https://leetcode.com/problems/counting-bits/description/" },
{ id: 95, problem: "Number of 1 Bits", number: 191, category: "Bit Manipulation", difficulty: "Easy", priority: "High", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/number-of-1-bits/", codeUrl: "https://leetcode.com/problems/number-of-1-bits/description/" },
{ id: 96, problem: "Insert Delete GetRandom O(1)", number: 380, category: "Arrays & Hashing", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/insert-delete-getrandom-o1/", codeUrl: "https://leetcode.com/problems/insert-delete-getrandom-o1/description/" },
{ id: 97, problem: "Find All Duplicates in an Array", number: 442, category: "Arrays & Hashing", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-all-duplicates-in-an-array/", codeUrl: "https://leetcode.com/problems/find-all-duplicates-in-an-array/description/" },
{ id: 98, problem: "First Missing Positive", number: 41, category: "Arrays & Hashing", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/first-missing-positive/", codeUrl: "https://leetcode.com/problems/first-missing-positive/description/" },
{ id: 99, problem: "Find the Duplicate Number", number: 287, category: "Arrays & Hashing", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-the-duplicate-number/", codeUrl: "https://leetcode.com/problems/find-the-duplicate-number/description/" },
{ id: 100, problem: "Set Matrix Zeroes", number: 73, category: "Arrays & Hashing", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/set-matrix-zeroes/", codeUrl: "https://leetcode.com/problems/set-matrix-zeroes/description/" },
{ id: 101, problem: "Rotate Image", number: 48, category: "Arrays & Hashing", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/rotate-image/", codeUrl: "https://leetcode.com/problems/rotate-image/description/" },
{ id: 102, problem: "Next Permutation", number: 31, category: "Two Pointers", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/next-permutation/", codeUrl: "https://leetcode.com/problems/next-permutation/description/" },
{ id: 103, problem: "3Sum Closest", number: 16, category: "Two Pointers", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/3sum-closest/", codeUrl: "https://leetcode.com/problems/3sum-closest/description/" },
{ id: 104, problem: "Sort Colors", number: 75, category: "Two Pointers", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/sort-colors/", codeUrl: "https://leetcode.com/problems/sort-colors/description/" },
{ id: 105, problem: "Reverse Words in a String", number: 151, category: "Two Pointers", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/reverse-words-in-a-string/", codeUrl: "https://leetcode.com/problems/reverse-words-in-a-string/description/" },
{ id: 106, problem: "Find All Anagrams in a String", number: 438, category: "Sliding Window", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-all-anagrams-in-a-string/", codeUrl: "https://leetcode.com/problems/find-all-anagrams-in-a-string/description/" },
{ id: 107, problem: "Basic Calculator", number: 224, category: "Stack", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/basic-calculator/", codeUrl: "https://leetcode.com/problems/basic-calculator/description/" },
{ id: 108, problem: "Sum of Subarray Minimums", number: 907, category: "Stack", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/sum-of-subarray-minimums/", codeUrl: "https://leetcode.com/problems/sum-of-subarray-minimums/description/" },
{ id: 109, problem: "Decode String", number: 394, category: "Stack", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/decode-string/", codeUrl: "https://leetcode.com/problems/decode-string/description/" },
{ id: 110, problem: "Find First and Last Position of Element in Sorted Array", number: 34, category: "Binary Search", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/find-first-and-last-position-of-element-in-sorted-array/", codeUrl: "https://leetcode.com/problems/find-first-and-last-position-of-element-in-sorted-array/description/" },
{ id: 111, problem: "Split Array Largest Sum", number: 410, category: "Binary Search", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/split-array-largest-sum/", codeUrl: "https://leetcode.com/problems/split-array-largest-sum/description/" },
{ id: 112, problem: "Reverse Nodes in k-Group", number: 25, category: "Linked List", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/reverse-nodes-in-k-group/", codeUrl: "https://leetcode.com/problems/reverse-nodes-in-k-group/description/" },
{ id: 113, problem: "Linked List Cycle II", number: 142, category: "Linked List", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/linked-list-cycle-ii/", codeUrl: "https://leetcode.com/problems/linked-list-cycle-ii/description/" },
{ id: 114, problem: "Odd Even Linked List", number: 328, category: "Linked List", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/odd-even-linked-list/", codeUrl: "https://leetcode.com/problems/odd-even-linked-list/description/" },
{ id: 115, problem: "Construct Binary Tree from Preorder and Inorder Traversal", number: 105, category: "Trees", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/", codeUrl: "https://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/description/" },
{ id: 116, problem: "Binary Tree Right Side View", number: 199, category: "Trees", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/binary-tree-right-side-view/", codeUrl: "https://leetcode.com/problems/binary-tree-right-side-view/description/" },
{ id: 117, problem: "Kth Smallest Element in a BST", number: 230, category: "Trees", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", codeUrl: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/description/" },
{ id: 118, problem: "House Robber III", number: 337, category: "Trees", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/house-robber-iii/", codeUrl: "https://leetcode.com/problems/house-robber-iii/description/" },
{ id: 119, problem: "Longest Increasing Path in a Matrix", number: 329, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/longest-increasing-path-in-a-matrix/", codeUrl: "https://leetcode.com/problems/longest-increasing-path-in-a-matrix/description/" },
{ id: 120, problem: "Distinct Subsequences", number: 115, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/distinct-subsequences/", codeUrl: "https://leetcode.com/problems/distinct-subsequences/description/" },
{ id: 121, problem: "Regular Expression Matching", number: 10, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/regular-expression-matching/", codeUrl: "https://leetcode.com/problems/regular-expression-matching/description/" },
{ id: 122, problem: "Minimum Path Sum", number: 64, category: "2D Dynamic Programming", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/minimum-path-sum/", codeUrl: "https://leetcode.com/problems/minimum-path-sum/description/" },
{ id: 123, problem: "Maximal Square", number: 221, category: "2D Dynamic Programming", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/maximal-square/", codeUrl: "https://leetcode.com/problems/maximal-square/description/" },
{ id: 124, problem: "Wildcard Matching", number: 44, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/wildcard-matching/", codeUrl: "https://leetcode.com/problems/wildcard-matching/description/" },
{ id: 125, problem: "Best Time to Buy and Sell Stock III", number: 123, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/", codeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/description/" },
{ id: 126, problem: "Burst Balloons", number: 312, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/burst-balloons/", codeUrl: "https://leetcode.com/problems/burst-balloons/description/" },
{ id: 127, problem: "Best Time to Buy and Sell Stock IV", number: 188, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/", codeUrl: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/description/" },
{ id: 128, problem: "Minimum Cost to Cut a Stick", number: 1547, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/minimum-cost-to-cut-a-stick/", codeUrl: "https://leetcode.com/problems/minimum-cost-to-cut-a-stick/description/" },
{ id: 129, problem: "Cherry Pickup II", number: 1463, category: "2D Dynamic Programming", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/cherry-pickup-ii/", codeUrl: "https://leetcode.com/problems/cherry-pickup-ii/description/" },
{ id: 130, problem: "Minimum Cost For Tickets", number: 983, category: "2D Dynamic Programming", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/minimum-cost-for-tickets/", codeUrl: "https://leetcode.com/problems/minimum-cost-for-tickets/description/" },
{ id: 131, problem: "Accounts Merge", number: 721, category: "Graphs", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/accounts-merge/", codeUrl: "https://leetcode.com/problems/accounts-merge/description/" },
{ id: 132, problem: "Min Cost to Connect All Points", number: 1584, category: "Graphs", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/min-cost-to-connect-all-points/", codeUrl: "https://leetcode.com/problems/min-cost-to-connect-all-points/description/" },
{ id: 133, problem: "Reconstruct Itinerary", number: 332, category: "Graphs", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/reconstruct-itinerary/", codeUrl: "https://leetcode.com/problems/reconstruct-itinerary/description/" },
{ id: 134, problem: "Is Graph Bipartite?", number: 785, category: "Graphs", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/is-graph-bipartite/", codeUrl: "https://leetcode.com/problems/is-graph-bipartite/description/" },
{ id: 135, problem: "Number of Provinces", number: 547, category: "Graphs", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/number-of-provinces/", codeUrl: "https://leetcode.com/problems/number-of-provinces/description/" },
{ id: 136, problem: "Open the Lock", number: 752, category: "Graphs", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/open-the-lock/", codeUrl: "https://leetcode.com/problems/open-the-lock/description/" },
{ id: 137, problem: "Bus Routes", number: 815, category: "Graphs", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/bus-routes/", codeUrl: "https://leetcode.com/problems/bus-routes/description/" },
{ id: 138, problem: "LFU Cache", number: 460, category: "Design", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/lfu-cache/", codeUrl: "https://leetcode.com/problems/lfu-cache/description/" },
{ id: 139, problem: "Design File System", number: 1166, category: "Design", difficulty: "Medium", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/design-file-system/", codeUrl: "https://leetcode.com/problems/design-file-system/description/" },
{ id: 140, problem: "Design Search Autocomplete System", number: 642, category: "Design", difficulty: "Hard", priority: "Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/design-search-autocomplete-system/", codeUrl: "https://leetcode.com/problems/design-search-autocomplete-system/description/" },
{ id: 141, problem: "Hand of Straights", number: 846, category: "Greedy", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/hand-of-straights/", codeUrl: "https://leetcode.com/problems/hand-of-straights/description/" },
{ id: 142, problem: "Candy", number: 135, category: "Greedy", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/candy/", codeUrl: "https://leetcode.com/problems/candy/description/" },
{ id: 143, problem: "Partition Labels", number: 763, category: "Greedy", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/partition-labels/", codeUrl: "https://leetcode.com/problems/partition-labels/description/" },
{ id: 144, problem: "Minimum Number of Refueling Stops", number: 871, category: "Greedy", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/minimum-number-of-refueling-stops/", codeUrl: "https://leetcode.com/problems/minimum-number-of-refueling-stops/description/" },
{ id: 145, problem: "Minimum Number of Arrows to Burst Balloons", number: 452, category: "Greedy", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/minimum-number-of-arrows-to-burst-balloons/", codeUrl: "https://leetcode.com/problems/minimum-number-of-arrows-to-burst-balloons/description/" },
{ id: 146, problem: "Car Fleet", number: 853, category: "Greedy", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/car-fleet/", codeUrl: "https://leetcode.com/problems/car-fleet/description/" },
{ id: 147, problem: "Remove Covered Intervals", number: 1288, category: "Intervals", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/remove-covered-intervals/", codeUrl: "https://leetcode.com/problems/remove-covered-intervals/description/" },
{ id: 148, problem: "Swim in Rising Water", number: 778, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/swim-in-rising-water/", codeUrl: "https://leetcode.com/problems/swim-in-rising-water/description/" },
{ id: 149, problem: "Making A Large Island", number: 827, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/making-a-large-island/", codeUrl: "https://leetcode.com/problems/making-a-large-island/description/" },
{ id: 150, problem: "Minimum Height Trees", number: 310, category: "Graphs", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/minimum-height-trees/", codeUrl: "https://leetcode.com/problems/minimum-height-trees/description/" },
{ id: 151, problem: "Find the City With the Smallest Number of Neighbors", number: 1334, category: "Graphs", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/find-the-city-with-the-smallest-number-of-neighbors-at-a-threshold-distance/", codeUrl: "https://leetcode.com/problems/find-the-city-with-the-smallest-number-of-neighbors-at-a-threshold-distance/description/" },
{ id: 152, problem: "Critical Connections in a Network", number: 1192, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/critical-connections-in-a-network/", codeUrl: "https://leetcode.com/problems/critical-connections-in-a-network/description/" },
{ id: 153, problem: "Path with Maximum Minimum Value", number: 1102, category: "Graphs", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/path-with-maximum-minimum-value/", codeUrl: "https://leetcode.com/problems/path-with-maximum-minimum-value/description/" },
{ id: 154, problem: "Shortest Path in a Grid with Obstacles Elimination", number: 1293, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/shortest-path-in-a-grid-with-obstacles-elimination/", codeUrl: "https://leetcode.com/problems/shortest-path-in-a-grid-with-obstacles-elimination/description/" },
{ id: 155, problem: "Shortest Path to Get All Keys", number: 864, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/shortest-path-to-get-all-keys/", codeUrl: "https://leetcode.com/problems/shortest-path-to-get-all-keys/description/" },
{ id: 156, problem: "Connecting Cities With Minimum Cost", number: 1135, category: "Graphs", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/connecting-cities-with-minimum-cost/", codeUrl: "https://leetcode.com/problems/connecting-cities-with-minimum-cost/description/" },
{ id: 157, problem: "Reachable Nodes In Subdivided Graph", number: 882, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/reachable-nodes-in-subdivided-graph/", codeUrl: "https://leetcode.com/problems/reachable-nodes-in-subdivided-graph/description/" },
{ id: 158, problem: "Stone Game", number: 877, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/stone-game/", codeUrl: "https://leetcode.com/problems/stone-game/description/" },
{ id: 159, problem: "Longest Arithmetic Subsequence", number: 1027, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/longest-arithmetic-subsequence/", codeUrl: "https://leetcode.com/problems/longest-arithmetic-subsequence/description/" },
{ id: 160, problem: "Palindrome Partitioning II", number: 132, category: "1D Dynamic Programming", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/palindrome-partitioning-ii/", codeUrl: "https://leetcode.com/problems/palindrome-partitioning-ii/description/" },
{ id: 161, problem: "Minimum Falling Path Sum", number: 931, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/minimum-falling-path-sum/", codeUrl: "https://leetcode.com/problems/minimum-falling-path-sum/description/" },
{ id: 162, problem: "Number of Ways to Stay in the Same Place After Some Steps", number: 1269, category: "1D Dynamic Programming", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/number-of-ways-to-stay-in-the-same-place-after-some-steps/", codeUrl: "https://leetcode.com/problems/number-of-ways-to-stay-in-the-same-place-after-some-steps/description/" },
{ id: 163, problem: "Count Square Submatrices with All Ones", number: 1277, category: "2D Dynamic Programming", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/count-square-submatrices-with-all-ones/", codeUrl: "https://leetcode.com/problems/count-square-submatrices-with-all-ones/description/" },
{ id: 164, problem: "Number of Dice Rolls With Target Sum", number: 1155, category: "1D Dynamic Programming", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/number-of-dice-rolls-with-target-sum/", codeUrl: "https://leetcode.com/problems/number-of-dice-rolls-with-target-sum/description/" },
{ id: 165, problem: "Profitable Schemes", number: 879, category: "2D Dynamic Programming", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/profitable-schemes/", codeUrl: "https://leetcode.com/problems/profitable-schemes/description/" },
{ id: 166, problem: "Frog Jump", number: 403, category: "1D Dynamic Programming", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/frog-jump/", codeUrl: "https://leetcode.com/problems/frog-jump/description/" },
{ id: 167, problem: "Student Attendance Record II", number: 552, category: "1D Dynamic Programming", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/student-attendance-record-ii/", codeUrl: "https://leetcode.com/problems/student-attendance-record-ii/description/" },
{ id: 168, problem: "Trapping Rain Water II", number: 407, category: "Heap / Priority Queue", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/trapping-rain-water-ii/", codeUrl: "https://leetcode.com/problems/trapping-rain-water-ii/description/" },
{ id: 169, problem: "Text Justification", number: 68, category: "Arrays & Hashing", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/text-justification/", codeUrl: "https://leetcode.com/problems/text-justification/description/" },
{ id: 170, problem: "Sudoku Solver", number: 37, category: "Backtracking", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/sudoku-solver/", codeUrl: "https://leetcode.com/problems/sudoku-solver/description/" },
{ id: 171, problem: "Robot Room Cleaner", number: 489, category: "Backtracking", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/robot-room-cleaner/", codeUrl: "https://leetcode.com/problems/robot-room-cleaner/description/" },
{ id: 172, problem: "Design Underground System", number: 1396, category: "Design", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/design-underground-system/", codeUrl: "https://leetcode.com/problems/design-underground-system/description/" },
{ id: 173, problem: "Snapshot Array", number: 1146, category: "Design", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/snapshot-array/", codeUrl: "https://leetcode.com/problems/snapshot-array/description/" },
{ id: 174, problem: "Sum of Two Integers", number: 371, category: "Bit Manipulation", difficulty: "Medium", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "Neetcode", leetCodeUrl: "https://leetcode.com/problems/sum-of-two-integers/", codeUrl: "https://leetcode.com/problems/sum-of-two-integers/description/" },
{ id: 175, problem: "Sliding Puzzle", number: 773, category: "Graphs", difficulty: "Hard", priority: "High-Medium", status: "Not Started", lastAttempt: "", notes: "", leetCodeUrl: "https://leetcode.com/problems/sliding-puzzle/", codeUrl: "https://leetcode.com/problems/sliding-puzzle/description/" }
];

    // Set up initial user problems based on master data
    userProblems = problems.map(problem => ({
        ...problem,
        status: "Not Started",
        forReview: false,
        dueDate: null,
        userNotes: ""
    }));

    // Initialize the view with the data
    updateStats();
    showProblems(currentView);
}

// Authentication functions
function setupAuth() {
    authBtn.addEventListener('click', () => {
        if (currentUser) {
            // User is signed in, sign out
            auth.signOut()
                .then(() => {
                    showToast('Successfully signed out');
                })
                .catch(error => {
                    showToast('Error signing out: ' + error.message, true);
                });
        } else {
            // User is not signed in, sign in
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .catch(error => {
                    showToast('Error signing in: ' + error.message, true);
                });
        }
    });

    // Listen for auth state changes
    auth.onAuthStateChanged(user => {
        currentUser = user;
        if (user) {
            authBtn.innerHTML = `
                <img src="${user.photoURL || ''}" alt="${user.displayName || 'User'}" style="width: 18px; height: 18px; border-radius: 50%; margin-right: 8px;">
                Sign Out
            `;
            loadUserData();
        } else {
            authBtn.innerHTML = `
                <img alt="Google" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width: 18px; margin-right: 8px;"/>
                Sign in
            `;
            // Reset to default data when signed out
            userProblems = problems.map(problem => ({
                ...problem,
                status: "Not Started",
                forReview: false,
                dueDate: null,
                userNotes: ""
            }));
            notesData = [];
            updateStats();
            showProblems(currentView);
        }
    });
}

// Firebase data functions
function loadUserData() {
    if (!currentUser) return;

    const userRef = db.collection('users').doc(currentUser.uid);
    
    // Get user problems data
    userRef.collection('problems').get()
        .then(snapshot => {
            if (!snapshot.empty) {
                const data = {};
                snapshot.forEach(doc => {
                    data[doc.id] = doc.data();
                });
                
                // Update userProblems with user-specific data
                userProblems = problems.map(problem => {
                    const userData = data[problem.id.toString()] || {};
                    return {
                        ...problem,
                        status: userData.status || "Not Started",
                        forReview: userData.forReview || false,
                        dueDate: userData.dueDate || null,
                        userNotes: userData.userNotes || ""
                    };
                });
                
                updateStats();
                showProblems(currentView);
            }
        })
        .catch(error => {
            console.error("Error loading user data: ", error);
            showToast('Error loading your data: ' + error.message, true);
        });
    
    // Get user notes
    userRef.collection('notes').get()
        .then(snapshot => {
            notesData = [];
            snapshot.forEach(doc => {
                notesData.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            updateNotesCount();
        })
        .catch(error => {
            console.error("Error loading notes: ", error);
        });
}

// Save problem data to Firebase
function saveProblemData(problemId, data) {
    if (!currentUser) return Promise.reject(new Error("User not signed in"));
    
    return db.collection('users').doc(currentUser.uid)
        .collection('problems').doc(problemId.toString())
        .set(data, { merge: true });
}

// Save a note to Firebase
function saveNote(problemId, content) {
    if (!currentUser) return Promise.reject(new Error("User not signed in"));
    
    const noteData = {
        problemId: problemId,
        problemName: userProblems.find(p => p.id === problemId)?.problem || "",
        content: content,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    return db.collection('users').doc(currentUser.uid)
        .collection('notes').add(noteData);
}

function updateStats() {
    const today = new Date();
    
    const completedCount = userProblems.filter(p => p.status === "Completed").length;
    const reviewCount = userProblems.filter(p => p.forReview).length;
    
    // Update pending count to include overdue problems
   const pendingCount = userProblems.filter(p => {
    // Only count problems with due dates in the past that aren't completed
        if (p.dueDate) {
            const dueDate = new Date(p.dueDate);
            return dueDate < today && p.status !== "Completed";
        }
        return false;
    }).length;
    
    const todayCount = userProblems.filter(p => {
        if (!p.dueDate) return false;
        const dueDate = new Date(p.dueDate);
        
        // Compare only the date parts
        return dueDate.getFullYear() === today.getFullYear() && 
               dueDate.getMonth() === today.getMonth() && 
               dueDate.getDate() === today.getDate();
    }).length;
    
    // Map data priorities to UI priorities
    const highPriority = userProblems.filter(p => p.priority === "High");
    const mediumPriority = userProblems.filter(p => p.priority === "High-Medium");
    const lowPriority = userProblems.filter(p => p.priority === "Medium");
    
    const highCompleted = highPriority.filter(p => p.status === "Completed").length;
    const mediumCompleted = mediumPriority.filter(p => p.status === "Completed").length;
    const lowCompleted = lowPriority.filter(p => p.status === "Completed").length;
    
    // Update stats display
    totalProblemsEl.textContent = userProblems.length;
    completedProblemsEl.textContent = completedCount;
    reviewProblemsEl.textContent = reviewCount;
    pendingProblemsEl.textContent = pendingCount;
    todayProblemsEl.textContent = todayCount;
    
    highPriorityStatsEl.textContent = `${highCompleted}/${highPriority.length}`;
    mediumPriorityStatsEl.textContent = `${mediumCompleted}/${mediumPriority.length}`;
    lowPriorityStatsEl.textContent = `${lowCompleted}/${lowPriority.length}`;
    
    // Update tab counts too
    allCountEl.textContent = userProblems.length;
    todayCountEl.textContent = todayCount;
    completedCountEl.textContent = completedCount;
    reviewCountEl.textContent = reviewCount;
    pendingCountEl.textContent = pendingCount;
    
    // Update notes count too
    updateNotesCount();
}

function updateNotesCount() {
    // Count problems with notes (rather than number of note entries)
    const problemsWithNotes = userProblems.filter(p => p.userNotes && p.userNotes.trim() !== "").length;
    notesCountEl.textContent = problemsWithNotes;
}

function savePrioritySelection() {
    // Save current priority checkbox states
    const lastPrioritySelection = {
        high: highPriorityCheck.checked,
        medium: mediumPriorityCheck.checked,
        low: lowPriorityCheck.checked
    };
    
    // Save to localStorage if available
    if (window.localStorage) {
        localStorage.setItem('techNavigator_prioritySelection', JSON.stringify(lastPrioritySelection));
    }
}

function loadPrioritySelection() {
    // Try to load from localStorage
    if (window.localStorage) {
        const saved = localStorage.getItem('techNavigator_prioritySelection');
        if (saved) {
            try {
                const lastPrioritySelection = JSON.parse(saved);
                
                // Apply saved selections to checkboxes
                highPriorityCheck.checked = lastPrioritySelection.high !== false; // default to true if undefined
                mediumPriorityCheck.checked = lastPrioritySelection.medium !== false; // default to true if undefined
                lowPriorityCheck.checked = lastPrioritySelection.low !== false; // default to true if undefined
            } catch (e) {
                console.error("Error loading saved priority selection:", e);
                // Set default values if there's an error
                highPriorityCheck.checked = true;
                mediumPriorityCheck.checked = true;
                lowPriorityCheck.checked = true;
            }
        } else {
            // Set default values if nothing saved
            highPriorityCheck.checked = true;
            mediumPriorityCheck.checked = true;
            lowPriorityCheck.checked = true;
        }
    }
}

// Generate a random due date within the specified days
function generateDueDate(days) {
    const date = new Date();
    const randomDays = Math.floor(Math.random() * days) + 1;
    date.setDate(date.getDate() + randomDays);
    return date.toISOString().split('T')[0];
}

function resetStudyPlan() {
    // Confirm with the user before proceeding
    if (!confirm("Are you sure you want to reset the study plan? This will clear all scheduled due dates.")) {
        return;
    }
    
    // Clear all due dates
    let updatePromises = [];
    let changedCount = 0;
    
    userProblems.forEach(problem => {
        if (problem.dueDate) {
            const index = userProblems.findIndex(p => p.id === problem.id);
            if (index !== -1) {
                userProblems[index].dueDate = null;
                changedCount++;
                
                // Save to Firebase if user is signed in
                if (currentUser) {
                    const savePromise = saveProblemData(problem.id, { dueDate: null });
                    updatePromises.push(savePromise);
                }
            }
        }
    });
    
    // Wait for all updates to complete
    if (updatePromises.length > 0) {
        Promise.all(updatePromises)
            .then(() => {
                showToast(`Study plan reset: cleared ${changedCount} scheduled problems`);
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error resetting study plan: ", error);
                showToast("Error resetting study plan", true);
            });
    } else {
        if (changedCount > 0) {
            showToast(`Study plan reset: cleared ${changedCount} scheduled problems`);
            updateStats();
            showProblems(currentView);
        } else {
            showToast("No scheduled problems to reset");
        }
    }
}

function generateStudyPlan() {
    const days = parseInt(plannerDays.value) || 30;
    if (days < 1) {
        showToast("Please enter a valid number of days (minimum 1)", true);
        return;
    }

    // Filter problems based on priority checkboxes
    const includeHigh = highPriorityCheck.checked;
    const includeMedium = mediumPriorityCheck.checked;
    const includeLow = lowPriorityCheck.checked;
    
    if (!includeHigh && !includeMedium && !includeLow) {
        showToast("Please select at least one priority level", true);
        return;
    }
    
    // Save the current priority selection
    savePrioritySelection();
    
    // Filter eligible problems - Fixed priority filtering logic
    let eligibleProblems = userProblems.filter(p => {
        if (p.status !== "Not Started") return false;
        
        // Check priorities with exact matching
        if (p.priority === "High" && includeHigh) return true;
        if (p.priority === "High-Medium" && includeMedium) return true;
        if (p.priority === "Medium" && includeLow) return true;
        
        return false;
    });
    
    console.log("Priority selection:", { high: includeHigh, medium: includeMedium, low: includeLow });
    console.log("Found eligible problems:", eligibleProblems.length);
    
    if (eligibleProblems.length === 0) {
        showToast("No eligible problems found for the selected priorities", true);
        return;
    }
    
    // Define category order following NeetCode roadmap
    const categoryOrder = [
        "Arrays & Hashing",     // Start with basics
        "Two Pointers",         // Simple technique
        "Sliding Window",       // Extension of two pointers
        "Stack",                // Fundamental data structure
        "Binary Search",        // Important search algorithm
        "Linked List",          // Fundamental data structure
        "Trees",                // Tree traversals and manipulations
        "Tries",                // Special tree structure
        "Heap / Priority Queue", // Advanced data structure
        "Backtracking",         // Recursive technique
        "Graphs",               // Graph algorithms (moderate complexity)
        "1D Dynamic Programming", // Start with simpler DP
        "2D Dynamic Programming", // Advanced DP
        "Greedy",               // Optimization technique
        "Intervals",            // Range processing problems
        "Bit Manipulation",     // Low-level operations
        "Design"                // System design problems (most complex)
    ];
    
    // Priority weights (higher is more important)
    const priorityWeight = {
        "High": 3,
        "High-Medium": 2,
        "Medium": 1
    };
    
    // Difficulty weights
    const difficultyWeight = {
        "Easy": 1,
        "Medium": 2,
        "Hard": 3
    };
    
    // IMPROVED: Sort all eligible problems first by priority, then by category, then by difficulty
    // This ensures consistent ordering with the sorting in the main view
    eligibleProblems.sort((a, b) => {
        // First sort by priority (High > High-Medium > Medium)
        if (priorityWeight[a.priority] !== priorityWeight[b.priority]) {
            return priorityWeight[b.priority] - priorityWeight[a.priority];
        }
        
        // Then by category (following NeetCode roadmap order)
        const categoryA = categoryOrder.indexOf(a.category);
        const categoryB = categoryOrder.indexOf(b.category);
        if (categoryA !== categoryB) {
            return categoryA - categoryB;
        }
        
        // Finally by difficulty (Easy > Medium > Hard)
        return difficultyWeight[a.difficulty] - difficultyWeight[b.difficulty];
    });
    
    // Now group problems by category while maintaining their sorted order
    const problemsByCategory = {};
    
    // Initialize categories
    categoryOrder.forEach(category => {
        problemsByCategory[category] = [];
    });
    
    // Group problems by category - they are already pre-sorted by priority and difficulty
    eligibleProblems.forEach(problem => {
        if (problemsByCategory[problem.category]) {
            problemsByCategory[problem.category].push(problem);
        }
    });
    
    // Create a roadmap-ordered list of problems
    let orderedProblems = [];
    
    // Calculate distribution of problems across categories
    const totalCategories = categoryOrder.length;
    let remainingProblems = eligibleProblems.length;
    let categoryWeights = {};
    
    // Assign weights based on position in the roadmap (earlier categories get higher weights)
    let totalWeight = 0;
    for (let i = 0; i < totalCategories; i++) {
        // Decreasing weight: earlier categories get more problems
        const weight = (totalCategories - i) / totalCategories;
        const category = categoryOrder[i];
        categoryWeights[category] = weight;
        totalWeight += weight;
    }
    
    // Calculate problems per category based on normalized weights
    let problemsPerCategory = {};
    for (const category of categoryOrder) {
        const normalizedWeight = categoryWeights[category] / totalWeight;
        const numProblems = Math.min(
            problemsByCategory[category].length,
            Math.max(1, Math.round(eligibleProblems.length * normalizedWeight))
        );
        problemsPerCategory[category] = numProblems;
        remainingProblems -= numProblems;
    }
    
    // Adjust if we've allocated too many or too few problems
    while (remainingProblems !== 0) {
        if (remainingProblems > 0) {
            // Find category with the most problems and add one
            let maxCategory = categoryOrder[0];
            for (const category of categoryOrder) {
                if (problemsByCategory[category].length > problemsPerCategory[category]) {
                    maxCategory = category;
                    break;
                }
            }
            
            if (problemsByCategory[maxCategory].length > problemsPerCategory[maxCategory]) {
                problemsPerCategory[maxCategory]++;
                remainingProblems--;
            } else {
                break; // No more problems to allocate
            }
        } else {
            // Find category with the most allocated problems and remove one
            let maxCategory = categoryOrder[0];
            let maxAllocated = problemsPerCategory[maxCategory];
            
            for (const category of categoryOrder) {
                if (problemsPerCategory[category] > maxAllocated) {
                    maxCategory = category;
                    maxAllocated = problemsPerCategory[category];
                }
            }
            
            if (problemsPerCategory[maxCategory] > 1) {
                problemsPerCategory[maxCategory]--;
                remainingProblems++;
            } else {
                break; // Cannot reduce further
            }
        }
    }
    
    // Build the final ordered problem list
    // IMPROVED: Use internal sorting to ensure priority ordering is preserved
    // This approach maintains priority consistency while respecting the roadmap progression
    
    // First, get the allocated problems from each category
    let categoryOrderedProblems = [];
    for (const category of categoryOrder) {
        const problemsToTake = problemsPerCategory[category] || 0;
        if (problemsToTake > 0 && problemsByCategory[category]) {
            // Take the pre-sorted problems from this category
            categoryOrderedProblems.push({
                category: category,
                problems: problemsByCategory[category].slice(0, problemsToTake)
            });
        }
    }
    
    // Now assign problems to days, prioritizing higher priority problems first across all categories
    // This ensures high priority problems are scheduled earlier regardless of their category
    while (categoryOrderedProblems.length > 0) {
        // Find the highest priority problem across all categories
        let highestPriorityIdx = 0;
        let highestPriorityValue = 0;
        let highestPriorityCategory = 0;
        
        for (let i = 0; i < categoryOrderedProblems.length; i++) {
            if (categoryOrderedProblems[i].problems.length > 0) {
                const topProblem = categoryOrderedProblems[i].problems[0];
                const priorityValue = priorityWeight[topProblem.priority];
                
                // If this is a higher priority or same priority but earlier category
                if (priorityValue > highestPriorityValue || 
                    (priorityValue === highestPriorityValue && 
                     categoryOrder.indexOf(categoryOrderedProblems[i].category) < highestPriorityCategory)) {
                    highestPriorityIdx = i;
                    highestPriorityValue = priorityValue;
                    highestPriorityCategory = categoryOrder.indexOf(categoryOrderedProblems[i].category);
                }
            }
        }
        
        // Add the highest priority problem to our ordered list
        if (categoryOrderedProblems[highestPriorityIdx].problems.length > 0) {
            orderedProblems.push(categoryOrderedProblems[highestPriorityIdx].problems.shift());
            
            // Remove this category if it's now empty
            if (categoryOrderedProblems[highestPriorityIdx].problems.length === 0) {
                categoryOrderedProblems.splice(highestPriorityIdx, 1);
            }
        }
    }
    
    console.log("Priority-ordered problems:", orderedProblems.length);
    
    // Calculate problems per day (at least 1)
    const problemsPerDay = Math.max(1, Math.ceil(orderedProblems.length / days));
    
    // Save current plan settings to localStorage
    if (window.localStorage) {
        localStorage.setItem('techNavigator_planDays', days.toString());
    }
    
    // Assign due dates following the priority-based order
    let dueDate = new Date();
    let problemsAssigned = 0;
    let updatePromises = [];
    
    for (let i = 0; i < orderedProblems.length; i++) {
        // Move to next day if we've assigned enough problems for today
        if (problemsAssigned >= problemsPerDay) {
            dueDate.setDate(dueDate.getDate() + 1);
            problemsAssigned = 0;
        }
        
        const problem = orderedProblems[i];
        const dueDateStr = dueDate.toISOString().split('T')[0];
        
        // Update problem due date
        const index = userProblems.findIndex(p => p.id === problem.id);
        if (index !== -1) {
            userProblems[index].dueDate = dueDateStr;
            
            // Save to Firebase if user is signed in
            if (currentUser) {
                const savePromise = saveProblemData(problem.id, { dueDate: dueDateStr });
                updatePromises.push(savePromise);
            }
        }
        
        problemsAssigned++;
    }
    
    // Wait for all updates to complete
    if (updatePromises.length > 0) {
        Promise.all(updatePromises)
            .then(() => {
                showToast(`Study plan generated: ${orderedProblems.length} problems over ${days} days prioritized by importance`);
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving study plan: ", error);
                showToast("Error saving study plan", true);
            });
    } else {
        showToast(`Study plan generated: ${orderedProblems.length} problems over ${days} days prioritized by importance`);
        updateStats();
        showProblems(currentView);
    }
}

// Helper function to shuffle an array
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Filter problems based on current view
function filterProblems(view) {
    const today = new Date();
    let filteredProblems = [];
    
    switch (view) {
        case 'today':
            filteredProblems = userProblems.filter(p => {
                if (!p.dueDate) return false;
                const dueDate = new Date(p.dueDate);
                
                // Compare only the date parts (year, month, day)
                return dueDate.getFullYear() === today.getFullYear() && 
                       dueDate.getMonth() === today.getMonth() && 
                       dueDate.getDate() === today.getDate();
            });
            break;
        case 'completed':
            filteredProblems = userProblems.filter(p => p.status === "Completed");
            break;
        case 'review':
            filteredProblems = userProblems.filter(p => p.forReview);
            break;
        case 'pending':
            filteredProblems = userProblems.filter(p => {
                // Only show problems that have a due date in the past and aren't completed
                if (p.dueDate) {
                    const dueDate = new Date(p.dueDate);
                    return dueDate < today && p.status !== "Completed";
                }
                return false;
            });
            break;
        case 'notes':
            filteredProblems = userProblems.filter(p => p.userNotes && p.userNotes.trim() !== "");
            break;
        case 'all':
        default:
            filteredProblems = [...userProblems];
            break;
    }
    
    // Define category ordering for NeetCode roadmap
    const categoryOrder = [
        "Arrays & Hashing",
        "Two Pointers",
        "Sliding Window",
        "Stack",
        "Binary Search", 
        "Linked List",
        "Trees",
        "Tries",
        "Heap / Priority Queue",
        "Backtracking",
        "Graphs",
        "1D Dynamic Programming",
        "2D Dynamic Programming",
        "Greedy",
        "Intervals",
        "Bit Manipulation",
        "Design"
    ];
    
    // Define priority and difficulty weights with CORRECT mapping
    const priorityWeight = {
        "High": 3,          // Highest priority (displayed as "High")
        "High-Medium": 2,   // Medium priority (displayed as "Medium")
        "Medium": 1         // Lowest priority (displayed as "Low")
    };
    
    const difficultyWeight = {
        "Easy": 1,
        "Medium": 2,
        "Hard": 3
    };
    
    // Sort problems by priority, then category, then difficulty
    filteredProblems.sort((a, b) => {
        // First by priority (high to low)
        if (priorityWeight[a.priority] !== priorityWeight[b.priority]) {
            return priorityWeight[b.priority] - priorityWeight[a.priority];
        }
        
        // Then by category (following NeetCode roadmap order)
        const categoryA = categoryOrder.indexOf(a.category);
        const categoryB = categoryOrder.indexOf(b.category);
        if (categoryA !== categoryB) {
            return categoryA - categoryB;
        }
        
        // Finally by difficulty (easy to hard)
        const diffA = difficultyWeight[a.difficulty];
        const diffB = difficultyWeight[b.difficulty];
        return diffA - diffB;
    });
    
    return filteredProblems;
}

// Update the problems table
function showProblems(view) {
    currentView = view;
    
    // Show problems container or notes view based on the selected view
    if (view === 'notes') {
        problemsContainer.style.display = 'none';
        notesView.style.display = 'block';
        renderNotes();
        return;
    } else {
        problemsContainer.style.display = 'block';
        notesView.style.display = 'none';
    }
    
    // Filter problems for the current view
    problemsToShow = filterProblems(view);
    
    // Clear table
    problemsTableBody.innerHTML = '';
    
    // Populate table with all problems (no pagination)
    problemsToShow.forEach(problem => {
        const row = document.createElement('tr');
        
        // Add problem status checkbox
        const statusTd = document.createElement('td');
        statusTd.style.textAlign = 'center';
        const statusCheckbox = document.createElement('span');
        statusCheckbox.className = `status-checkbox${problem.status === "Completed" ? " completed" : ""}`;
        statusCheckbox.dataset.id = problem.id;
        statusTd.appendChild(statusCheckbox);
        
        // Add problem name with link
        const problemTd = document.createElement('td');
        const problemLink = document.createElement('a');
        problemLink.href = problem.leetCodeUrl;
        problemLink.className = 'problem-link';
        problemLink.textContent = problem.problem;
        problemLink.target = '_blank';
        problemTd.appendChild(problemLink);
        
        // Add category
        const categoryTd = document.createElement('td');
        const categoryTag = document.createElement('span');
        categoryTag.className = 'category-tag';
        categoryTag.textContent = problem.category;
        categoryTd.appendChild(categoryTag);
        
        // Add difficulty
        const difficultyTd = document.createElement('td');
        const difficultyTag = document.createElement('span');
        difficultyTag.className = `difficulty-tag ${problem.difficulty.toLowerCase()}`;
        difficultyTag.textContent = problem.difficulty;
        difficultyTd.appendChild(difficultyTag);
        
        // Add priority
        const priorityTd = document.createElement('td');
        const priorityTag = document.createElement('span');

        // Map data priorities to UI priorities for styling
        let priorityClass;
        switch(problem.priority) {
            case "High":
                priorityClass = "high";
                break;
            case "High-Medium":
                priorityClass = "medium";
                break;
            case "Medium":
                priorityClass = "low";
                break;
            default:
                priorityClass = problem.priority.toLowerCase();
        }
        priorityTag.className = `priority-tag ${priorityClass}`;
        priorityTag.textContent = getPriorityDisplayName(problem.priority);
        priorityTd.appendChild(priorityTag);
        
        // Add due date with fixed date comparison
        const dueDateTd = document.createElement('td');
        if (problem.dueDate) {
            const dueDate = new Date(problem.dueDate);
            const today = new Date();
            
            // Compare date parts for "expired" check
            const isExpired = 
                (dueDate.getFullYear() < today.getFullYear()) ||
                (dueDate.getFullYear() === today.getFullYear() && 
                 dueDate.getMonth() < today.getMonth()) ||
                (dueDate.getFullYear() === today.getFullYear() && 
                 dueDate.getMonth() === today.getMonth() && 
                 dueDate.getDate() < today.getDate());
            
            const dueDateSpan = document.createElement('span');
            dueDateSpan.className = `due-date${isExpired ? " expired" : ""}`;
            
            // Format date as Month Day, Year
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            dueDateSpan.textContent = dueDate.toLocaleDateString('en-US', options);
            
            dueDateTd.appendChild(dueDateSpan);
        }
        
        // Add action buttons
        const actionsTd = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'action-cell';
        
        // Review button
        const reviewBtn = document.createElement('button');
        reviewBtn.className = `action-btn${problem.forReview ? " marked" : ""}`;
        reviewBtn.title = "Mark for revision";
        reviewBtn.dataset.id = problem.id;
        reviewBtn.dataset.action = "review";
        reviewBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="${problem.forReview ? "currentColor" : "none"}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        `;
        
        // Notes button
        const notesBtn = document.createElement('button');
        notesBtn.className = `action-btn${problem.userNotes && problem.userNotes.trim() !== "" ? " marked" : ""}`;
        notesBtn.title = "Add notes";
        notesBtn.dataset.id = problem.id;
        notesBtn.dataset.action = "notes";
        notesBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <path d="M14 2v6h6"></path>
                <path d="M16 13H8"></path>
                <path d="M16 17H8"></path>
                <path d="M10 9H8"></path>
            </svg>
        `;
        
        // Code solution button
        const codeBtn = document.createElement('button');
        codeBtn.className = 'action-btn';
        codeBtn.title = "View code solution";
        codeBtn.dataset.url = problem.codeUrl;
        codeBtn.dataset.action = "code";
        codeBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
        `;
        
        actionsDiv.appendChild(reviewBtn);
        actionsDiv.appendChild(notesBtn);
        actionsDiv.appendChild(codeBtn);
        actionsTd.appendChild(actionsDiv);
        
        // Add all cells to the row
        row.appendChild(statusTd);
        row.appendChild(problemTd);
        row.appendChild(categoryTd);
        row.appendChild(difficultyTd);
        row.appendChild(priorityTd);
        row.appendChild(dueDateTd);
        row.appendChild(actionsTd);
        
        // Add row to table
        problemsTableBody.appendChild(row);
    });
    
    // Update table info - show all problems now
    tableInfo.textContent = `Showing all ${problemsToShow.length} problems`;
    
    // Hide pagination since we're showing all problems
    pagination.style.display = 'none';
}
        
function getPriorityDisplayName(dataPriority) {
    switch(dataPriority) {
        case "High": return "High";
        case "High-Medium": return "Medium";
        case "Medium": return "Low";
        default: return dataPriority;
    }
}

function setupPlannerEvents() {
    // Event listener for the generate plan button
    generatePlanBtn.addEventListener('click', generateStudyPlan);
    
    // Event listener for the reset plan button
    const resetPlanBtn = document.getElementById('resetPlanBtn');
    if (resetPlanBtn) {
        resetPlanBtn.addEventListener('click', resetStudyPlan);
    }
    
    // Event listeners for the priority checkboxes to save preferences on change
    highPriorityCheck.addEventListener('change', savePrioritySelection);
    mediumPriorityCheck.addEventListener('change', savePrioritySelection);
    lowPriorityCheck.addEventListener('change', savePrioritySelection);
}

// Render pagination controls
function renderPagination(totalPages) {
    // Clear existing page buttons except prev and next
    const pageButtons = pagination.querySelectorAll('.pagination-btn:not(#prevPageBtn):not(#nextPageBtn)');
    pageButtons.forEach(btn => btn.remove());
    
    // Add page buttons
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    // Adjust if we're near the end
    if (endPage - startPage < maxVisiblePages - 1) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    // Add first page button if not visible
    if (startPage > 1) {
        const firstBtn = document.createElement('button');
        firstBtn.className = 'pagination-btn';
        firstBtn.textContent = '1';
        firstBtn.dataset.page = 1;
        pagination.insertBefore(firstBtn, nextPageBtn);
        
        // Add ellipsis if needed
        if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.margin = '0 0.25rem';
            pagination.insertBefore(ellipsis, nextPageBtn);
        }
    }
    
    // Add visible page buttons
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-btn${i === currentPage ? " active" : ""}`;
        pageBtn.textContent = i;
        pageBtn.dataset.page = i;
        pagination.insertBefore(pageBtn, nextPageBtn);
    }
    
    // Add last page button if not visible
    if (endPage < totalPages) {
        // Add ellipsis if needed
        if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.margin = '0 0.25rem';
            pagination.insertBefore(ellipsis, nextPageBtn);
        }
        
        const lastBtn = document.createElement('button');
        lastBtn.className = 'pagination-btn';
        lastBtn.textContent = totalPages;
        lastBtn.dataset.page = totalPages;
        pagination.insertBefore(lastBtn, nextPageBtn);
    }
    
    // Update prev/next button states
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages;
}

// Render notes in the notes view
function renderNotes() {
    notesGrid.innerHTML = '';
    
    if (notesData.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'note-card';
        emptyMessage.innerHTML = `
            <div class="note-header">
                <div class="note-title">No Notes Yet</div>
            </div>
            <div class="note-content">
                Add notes to problems by clicking the notes button in the actions column.
            </div>
        `;
        notesGrid.appendChild(emptyMessage);
        return;
    }
    
    // Sort notes by updated time, newest first
    const sortedNotes = [...notesData].sort((a, b) => {
        const dateA = a.updatedAt?.toDate() || new Date(0);
        const dateB = b.updatedAt?.toDate() || new Date(0);
        return dateB - dateA;
    });
    
    sortedNotes.forEach(note => {
        const noteCard = document.createElement('div');
        noteCard.className = 'note-card';
        
        const updatedDate = note.updatedAt?.toDate() || new Date();
        const formattedDate = updatedDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        noteCard.innerHTML = `
            <div class="note-header">
                <div class="note-title">${note.problemName}</div>
                <div class="note-meta">Updated: ${formattedDate}</div>
            </div>
            <div class="note-content">${note.content}</div>
        `;
        
        notesGrid.appendChild(noteCard);
    });
}

// Show toast message
function showToast(message, isError = false) {
    toast.textContent = message;
    toast.className = `toast${isError ? " error" : ""}`;
    
    // Show the toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Hide the toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Handle problem status toggle
function toggleProblemStatus(problemId) {
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    const newStatus = userProblems[index].status === "Completed" ? "Not Started" : "Completed";
    userProblems[index].status = newStatus;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        saveProblemData(problemId, { status: newStatus })
            .then(() => {
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving problem status: ", error);
                showToast("Error saving problem status", true);
                // Revert the change
                userProblems[index].status = userProblems[index].status === "Completed" ? "Not Started" : "Completed";
                showProblems(currentView);
            });
    } else {
        updateStats();
        showProblems(currentView);
    }
}

// Handle review toggle
function toggleReview(problemId) {
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    const newReviewStatus = !userProblems[index].forReview;
    userProblems[index].forReview = newReviewStatus;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        saveProblemData(problemId, { forReview: newReviewStatus })
            .then(() => {
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving review status: ", error);
                showToast("Error saving review status", true);
                // Revert the change
                userProblems[index].forReview = !newReviewStatus;
                showProblems(currentView);
            });
    } else {
        updateStats();
        showProblems(currentView);
    }
}

// Open notes modal
function openNotesModal(problemId) {
    const problem = userProblems.find(p => p.id === problemId);
    if (!problem) return;
    
    problemTitle.textContent = problem.problem;
    notesTextarea.value = problem.userNotes || "";
    notesTextarea.dataset.problemId = problemId;
    
    notesModal.style.display = 'block';
}

// Close notes modal
function closeNotesModal() {
    notesModal.style.display = 'none';
}

// Save notes
function saveNotes() {
    const problemId = parseInt(notesTextarea.dataset.problemId);
    const content = notesTextarea.value.trim();
    
    if (!problemId) return;
    
    const index = userProblems.findIndex(p => p.id === problemId);
    if (index === -1) return;
    
    userProblems[index].userNotes = content;
    
    // Save to Firebase if user is signed in
    if (currentUser) {
        // Update problem user notes
        saveProblemData(problemId, { userNotes: content })
            .then(() => {
                // Add to notes collection if there's content
                if (content) {
                    return saveNote(problemId, content);
                }
                return Promise.resolve();
            })
            .then(() => {
                showToast("Notes saved successfully");
                closeNotesModal();
                
                // Reload notes data
                if (currentUser) {
                    db.collection('users').doc(currentUser.uid).collection('notes').get()
                        .then(snapshot => {
                            notesData = [];
                            snapshot.forEach(doc => {
                                notesData.push({
                                    id: doc.id,
                                    ...doc.data()
                                });
                            });
                            
                            updateNotesCount();
                            if (currentView === 'notes') {
                                renderNotes();
                            }
                        });
                }
                
                updateStats();
                showProblems(currentView);
            })
            .catch(error => {
                console.error("Error saving notes: ", error);
                showToast("Error saving notes", true);
            });
    } else {
        showToast("Notes saved locally. Sign in to save permanently");
        closeNotesModal();
        updateStats();
        showProblems(currentView);
    }
}

// Set up event listeners
function setupEventListeners() {
    // Status checkbox toggle
    problemsTableBody.addEventListener('click', (e) => {
        const statusCheckbox = e.target.closest('.status-checkbox');
        if (statusCheckbox) {
            const problemId = parseInt(statusCheckbox.dataset.id);
            toggleProblemStatus(problemId);
        }
    });
    
    // Action buttons
    problemsTableBody.addEventListener('click', (e) => {
        const actionBtn = e.target.closest('.action-btn');
        if (!actionBtn) return;
        
        const action = actionBtn.dataset.action;
        const problemId = parseInt(actionBtn.dataset.id);
        
        switch (action) {
            case 'review':
                toggleReview(problemId);
                break;
            case 'notes':
                openNotesModal(problemId);
                break;
            case 'code':
                if (actionBtn.dataset.url) {
                    window.open(actionBtn.dataset.url, '_blank');
                }
                break;
        }
    });
    
    // Notes modal
    closeModal.addEventListener('click', closeNotesModal);
    window.addEventListener('click', (e) => {
        if (e.target === notesModal) {
            closeNotesModal();
        }
    });
    
    // Save notes button
    saveNotesBtn.addEventListener('click', saveNotes);
    
    // Study plan generator
    setupPlannerEvents();
    
    // View tabs
    viewTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            viewTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            const view = tab.dataset.view;
            showProblems(view);
        });
    });
    
    // Remove pagination event listeners since we're displaying all problems
}

function initApp() {
    loadProblemsData();
    
    // Update priority labels to match the data mapping
    const highLabel = document.querySelector('.priority-check.high .priority-label');
    const mediumLabel = document.querySelector('.priority-check.medium .priority-label');
    const lowLabel = document.querySelector('.priority-check.low .priority-label');
    
    if (highLabel) highLabel.textContent = "High";
    if (mediumLabel) mediumLabel.textContent = "High-Medium"; 
    if (lowLabel) lowLabel.textContent = "Medium";
    
    // Load saved priority selection preferences
    loadPrioritySelection();
    
    // Load saved days setting
    if (window.localStorage) {
        const savedDays = localStorage.getItem('techNavigator_planDays');
        if (savedDays && plannerDays) {
            plannerDays.value = savedDays;
        }
    }
    
    setupAuth();
    setupEventListeners();
}

// Start the application when DOM is loaded
document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
