<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Tracker - 175 Google Interview Problems</title>
    <!-- Add Firebase and Google Auth SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-highlight: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --blue: #3b82f6;
            --blue-dark: #2563eb;
            --green: #10b981;
            --yellow: #f59e0b;
            --orange: #f97316;
            --red: #ef4444;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 1.25rem;
            color: var(--blue);
        }

        .header-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 0.75rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .tab-button {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 500;
        }

        .tab-button.active {
            color: var(--blue);
            border-bottom: 2px solid var(--blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }

        th {
            text-align: left;
            padding: 0.5rem;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 500;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:nth-child(even) {
            background-color: var(--bg-secondary);
        }

        tr:nth-child(odd) {
            background-color: #263149;
        }

        .table-container {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background-color: var(--bg-tertiary);
            font-size: 0.75rem;
        }

        .pagination-info {
            color: var(--text-muted);
        }

        .pagination-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: var(--blue);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--blue-dark);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background-color: var(--bg-highlight);
        }

        .btn-disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        /* Filter styles */
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        select, input {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        input[type="search"] {
            padding-left: 1.5rem;
            width: 200px;
        }

        /* Card styles */
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .problem-list {
            list-style: none;
        }

        .problem-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background-color: #263149;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .problem-info {
            flex: 1;
        }

        .problem-title {
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .problem-meta {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .problem-actions {
            display: flex;
            gap: 0.25rem;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-button:hover {
            background-color: var(--bg-tertiary);
        }

        /* Progress bars */
        .progress-container {
            margin-bottom: 0.75rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .progress-bar {
            height: 0.375rem;
            background-color: var(--bg-tertiary);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--blue);
        }

        .easy {
            color: var(--green);
        }

        .medium {
            color: var(--yellow);
        }

        .hard {
            color: var(--red);
        }

        .status-dot {
            display: inline-block;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            margin-right: 0.25rem;
        }

        .status-complete {
            background-color: var(--green);
        }

        .status-in-progress {
            background-color: var(--yellow);
        }

        .status-needs-revision {
            background-color: var(--orange);
        }

        .status-not-started {
            background-color: var(--text-muted);
        }

        a {
            color: var(--blue);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Small status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            font-size: 0.7rem;
        }

        .planner-day {
            margin-bottom: 1rem;
            border-left: 3px solid var(--blue);
            padding-left: 0.5rem;
        }

        .planner-day-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .planner-day-title {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .planner-day-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Form controls for planner */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.8rem;
        }

        .form-control {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Compact cards */
        .compact-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }

        .compact-card-title {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Revision settings */
        .revision-settings {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .revision-setting {
            flex: 1;
        }

        /* Priority checkboxes */
        .priority-checkboxes {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .priority-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .priority-checkbox input[type="checkbox"] {
            appearance: none;
            width: 1rem;
            height: 1rem;
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            cursor: pointer;
            position: relative;
        }

        .priority-checkbox input[type="checkbox"]:checked {
            background-color: var(--blue);
        }

        .priority-checkbox input[type="checkbox"]:checked::after {
            content: "‚úì";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
        }

        /* Auth styles */
        .auth-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }

        .auth-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auth-button.google {
            background-color: #4285F4;
            color: white;
        }

        .auth-button.signout {
            background-color: var(--red);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .user-name {
            font-size: 0.75rem;
        }

        /* Calculation results */
        .calculation-results {
            background-color: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            font-size: 0.75rem;
        }

        .calculation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .calculation-total {
            font-weight: bold;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>LeetCode Tracker</h1>
                <div class="header-subtitle">175 Google Interview Problems</div>
            </div>
            <div class="auth-container" id="auth-container">
                <!-- Auth buttons will be loaded here -->
            </div>
        </header>
        
        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="stat-total">0</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-completed" style="color: var(--green);">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-needs-revision" style="color: var(--orange);">0</div>
                <div class="stat-label">Needs Review</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-not-started" style="color: var(--text-muted);">0</div>
                <div class="stat-label">Not Started</div>
            </div>
        </div>
        
        <!-- Compact Stats Cards -->
        <div class="card-grid">
            <div class="compact-card">
                <div class="compact-card-title">Problem Priorities</div>
                <div id="priority-progress">
                    <!-- Priority progress will be loaded here -->
                </div>
            </div>
            <div class="compact-card">
                <div class="compact-card-title">Progress by Difficulty</div>
                <div id="difficulty-progress">
                    <!-- Difficulty progress will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="tracker">Problem Tracker</button>
            <button class="tab-button" data-tab="planner">Study Planner</button>
            <button class="tab-button" data-tab="analytics">Analytics</button>
        </div>
        
        <!-- Tracker Tab -->
        <div id="tracker-tab" class="tab-content active">
            <div class="filters">
                <div class="filter-group">
                    <select id="category-filter">
                        <option value="All">All Categories</option>
                    </select>
                    <select id="difficulty-filter">
                        <option value="All">All Difficulties</option>
                    </select>
                    <select id="priority-filter">
                        <option value="All">All Priorities</option>
                    </select>
                </div>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="search" id="search-input" placeholder="Search problems...">
                </div>
            </div>
            <div class="table-container">
                <table id="problems-table">
                    <thead>
                        <tr>
                            <th style="width: 50px">#</th>
                            <th>Problem</th>
                            <th style="width: 150px">Category</th>
                            <th style="width: 80px">Difficulty</th>
                            <th style="width: 80px">Priority</th>
                            <th style="width: 100px">Last Attempt</th>
                            <th style="width: 130px">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="problems-table-body">
                        <!-- Problems will be loaded here -->
                    </tbody>
                </table>
                <div class="pagination">
                    <div class="pagination-info" id="pagination-info">Showing 0-0 of 0</div>
                    <div class="pagination-controls">
                        <button class="btn btn-disabled" id="prev-page">Prev</button>
                        <span id="page-info">0 / 0</span>
                        <button class="btn btn-disabled" id="next-page">Next</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Planner Tab -->
        <div id="planner-tab" class="tab-content">
            <div class="card">
                <div class="card-title">Study Plan Configuration</div>
                
                <div class="priority-checkboxes">
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-high" checked>
                        <span>High Priority</span>
                    </label>
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-high-medium" checked>
                        <span>High-Medium Priority</span>
                    </label>
                    <label class="priority-checkbox">
                        <input type="checkbox" id="priority-medium">
                        <span>Medium Priority</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="plan-days">Number of Study Days</label>
                    <input type="number" id="plan-days" class="form-control" min="1" value="30">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="problems-per-day">Problems Per Day</label>
                    <input type="number" id="problems-per-day" class="form-control" min="1" value="3" readonly>
                </div>
                
                <div id="calculation-results" class="calculation-results">
                    <div class="calculation-row">
                        <span>High Priority Problems:</span>
                        <span id="high-count">0</span>
                    </div>
                    <div class="calculation-row">
                        <span>High-Medium Priority Problems:</span>
                        <span id="high-medium-count">0</span>
                    </div>
                    <div class="calculation-row">
                        <span>Medium Priority Problems:</span>
                        <span id="medium-count">0</span>
                    </div>
                    <div class="calculation-row calculation-total">
                        <span>Total Selected Problems:</span>
                        <span id="total-selected">0</span>
                    </div>
                </div>
                
                <div class="revision-settings">
                    <div class="form-group revision-setting">
                        <label class="form-label" for="first-revision">First Revision (days)</label>
                        <input type="number" id="first-revision" class="form-control" min="1" value="5">
                    </div>
                    <div class="form-group revision-setting">
                        <label class="form-label" for="second-revision">Second Revision (days)</label>
                        <input type="number" id="second-revision" class="form-control" min="1" value="14">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="generate-plan" class="btn btn-primary">Generate Plan</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Today's Problems</div>
                <div id="today-problems" class="problem-list">
                    <!-- Today's problems will be loaded here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Pending Problems</div>
                <div id="pending-problems" class="problem-list">
                    <!-- Pending problems will be loaded here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Problems Needing Revision</div>
                <div id="revision-problems" class="problem-list">
                    <!-- Revision problems will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="card-grid">
                <div class="card">
                    <div class="card-title">Progress by Category</div>
                    <div id="category-progress">
                        <!-- Category progress will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Estimated Completion</div>
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Overall Progress</span>
                            <span id="overall-progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="progress-meta" id="estimated-days" style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--text-muted);">
                            Est. 0 days remaining (3 problems/day)
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem;">Status Breakdown</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;">
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--green);" id="status-complete-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Complete</div>
                            </div>
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--orange);" id="status-needs-revision-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Review</div>
                            </div>
                            <div style="padding: 0.5rem; background-color: #263149; border-radius: 0.25rem; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--text-muted);" id="status-not-started-percentage">0%</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Not Started</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    // Initialize Firebase with your configuration
const firebaseConfig = {
  apiKey: "AIzaSyBnbrX52t_Y2QgJv5nNA4xeb0ZX94_kKeY",
  authDomain: "technavigator-8ecd1.firebaseapp.com",
  projectId: "technavigator-8ecd1",
  storageBucket: "technavigator-8ecd1.firebasestorage.app",
  messagingSenderId: "316020740391",
  appId: "1:316020740391:web:2f3ba461d5a179154cd902",
  measurementId: "G-WE013C9L92"
};

// Main data store - initializing these variables at the top level
let problems = [];
let categories = [];
let studyPlan = [];
let currentPage = 0;
let rowsPerPage = 15;
let filteredProblems = [];
let currentUser = null;

// State for filters
let filters = {
    search: '',
    category: 'All',
    difficulty: 'All',
    priority: 'All'
};

// Stats
let stats = {
    total: 0,
    completed: 0,
    needsRevision: 0,
    notStarted: 0
};

function addStyles() {
  const styleElement = document.createElement('style');
  styleElement.textContent = `
    /* Improved Auth Buttons */
    .auth-button {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: background-color 0.2s, box-shadow 0.2s;
    }
    
    .auth-button.google {
      background-color: white;
      color: #757575;
      border: 1px solid #ddd;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .auth-button.google:hover {
      background-color: #f8f8f8;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    
    .auth-button.signout {
      background-color: #f44336;
      color: white;
    }
    
    .auth-button.signout:hover {
      background-color: #e53935;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    
    .google-logo {
      width: 18px;
      height: 18px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-right: 12px;
    }
    
    .user-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-name {
      font-size: 14px;
      color: var(--text-primary);
    }
    
    .auth-container {
      display: flex;
      align-items: center;
    }
  `;
  document.head.appendChild(styleElement);
}

document.addEventListener('DOMContentLoaded', () => {
    // Initialize Firebase
    if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Set up authentication
        setupAuth(auth, db);
    } else {
        console.error("Firebase SDK not loaded");
    }
    
    // Set up tab navigation
    setupTabs();
    
    // Load problem data
    loadProblems();
    
    // Set up event listeners
    setupEventListeners();

    addStyles();

});

// Update your setupAuth function to include the Google logo
function setupAuth(auth, db) {
    const authContainer = document.getElementById('auth-container');
    
    auth.onAuthStateChanged(user => {
        currentUser = user;
        
        if (user) {
            // User is signed in
            authContainer.innerHTML = `
                <div class="user-info">
                    <img class="user-avatar" src="${user.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.displayName)}" alt="${user.displayName}">
                    <span class="user-name">${user.displayName}</span>
                </div>
                <button class="auth-button signout" id="signout-button">
                    Sign Out
                </button>
            `;
            
            document.getElementById('signout-button').addEventListener('click', () => {
                auth.signOut();
            });
            
            // Load user data from Firestore
            loadUserData(db);
        } else {
            // User is signed out - now with Google logo
            authContainer.innerHTML = `
                <button class="auth-button google" id="signin-button">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-logo">
                    Sign in with Google
                </button>
            `;
            
            document.getElementById('signin-button').addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // For local testing, consider using redirect instead of popup
                auth.signInWithRedirect(provider).catch(error => {
                    console.error('Sign in error:', error);
                    // Show error message to user
                    alert('Sign in failed: ' + error.message);
                });
            });
        }
    });
}

// Load user data from Firestore
function loadUserData(db) {
    if (!currentUser) return;
    
    const userRef = db.collection('users').doc(currentUser.uid);
    
    userRef.get().then(doc => {
        if (doc.exists) {
            const data = doc.data();
            if (data.problems) {
                problems = data.problems;
                if (data.studyPlan) {
                    studyPlan = data.studyPlan.map(day => {
                        return {
                            ...day,
                            date: day.date.toDate()
                        };
                    });
                }
                
                // Initialize the app with user data
                initializeApp();
            }
        }
    }).catch(error => {
        console.error('Error loading user data:', error);
    });
}

// Save user data to Firestore
function saveUserData() {
    if (!currentUser || typeof firebase === 'undefined') return;
    
    const db = firebase.firestore();
    const userRef = db.collection('users').doc(currentUser.uid);
    
    // Convert dates to Firestore Timestamp
    const studyPlanForSave = studyPlan.map(day => {
        return {
            ...day,
            date: firebase.firestore.Timestamp.fromDate(day.date)
        };
    });
    
    userRef.set({
        problems: problems,
        studyPlan: studyPlanForSave,
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true }).catch(error => {
        console.error('Error saving user data:', error);
    });
}

// Tab navigation
function setupTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabName = button.getAttribute('data-tab');
            
            // Deactivate all tabs
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Activate the selected tab
            button.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        });
    });
}

// Event listeners
function setupEventListeners() {
    // Filter changes
    document.getElementById('search-input').addEventListener('input', handleFilterChange);
    document.getElementById('category-filter').addEventListener('change', handleFilterChange);
    document.getElementById('difficulty-filter').addEventListener('change', handleFilterChange);
    document.getElementById('priority-filter').addEventListener('change', handleFilterChange);
    
    // Pagination
    document.getElementById('prev-page').addEventListener('click', () => {
        if (currentPage > 0) {
            currentPage--;
            renderProblemsTable();
        }
    });
    
    document.getElementById('next-page').addEventListener('click', () => {
        const totalPages = Math.ceil(filteredProblems.length / rowsPerPage);
        if (currentPage < totalPages - 1) {
            currentPage++;
            renderProblemsTable();
        }
    });
    
    // Generate study plan
    document.getElementById('generate-plan').addEventListener('click', generateStudyPlan);
    
    // Priority checkboxes and days input
    document.getElementById('priority-high').addEventListener('change', updateProblemsPerDay);
    document.getElementById('priority-high-medium').addEventListener('change', updateProblemsPerDay);
    document.getElementById('priority-medium').addEventListener('change', updateProblemsPerDay);
    document.getElementById('plan-days').addEventListener('input', updateProblemsPerDay);
}

// Update problems per day based on priority selection and days
function updateProblemsPerDay() {
    const highChecked = document.getElementById('priority-high').checked;
    const highMediumChecked = document.getElementById('priority-high-medium').checked;
    const mediumChecked = document.getElementById('priority-medium').checked;
    
    // Count problems for each selected priority
    let highCount = 0;
    let highMediumCount = 0;
    let mediumCount = 0;
    
    if (highChecked) {
        highCount = problems.filter(p => p.priority === 'High' && (p.status === 'Not Started' || p.status === 'In Progress')).length;
    }
    
    if (highMediumChecked) {
        highMediumCount = problems.filter(p => p.priority === 'High-Medium' && (p.status === 'Not Started' || p.status === 'In Progress')).length;
    }
    
    if (mediumChecked) {
        mediumCount = problems.filter(p => p.priority === 'Medium' && (p.status === 'Not Started' || p.status === 'In Progress')).length;
    }
    
    const totalSelected = highCount + highMediumCount + mediumCount;
    const days = parseInt(document.getElementById('plan-days').value) || 1;
    
    // Update calculation results display
    document.getElementById('high-count').textContent = highChecked ? highCount : 'Not selected';
    document.getElementById('high-medium-count').textContent = highMediumChecked ? highMediumCount : 'Not selected';
    document.getElementById('medium-count').textContent = mediumChecked ? mediumCount : 'Not selected';
    document.getElementById('total-selected').textContent = totalSelected;
    
    // Calculate problems per day (rounded up to nearest integer)
    const problemsPerDay = Math.ceil(totalSelected / days);
    
    // Update problems per day field
    const problemsPerDayInput = document.getElementById('problems-per-day');
    problemsPerDayInput.value = problemsPerDay > 0 ? problemsPerDay : 0;
}

// Load and parse problems
function loadProblems() {
    // Sample data based on the structure of the paste.txt file
    const sampleData = `
High Priority List (95 Problems) - Complete Neetcode Roadmap + Google Focus
Arrays & Hashing (7)

Contains Duplicate (#217) - Easy - Neetcode
Two Sum (#1) - Easy - Neetcode
Valid Anagram (#242) - Easy - Neetcode
Group Anagrams (#49) - Medium - Neetcode
Top K Frequent Elements (#347) - Medium - Neetcode
Product of Array Except Self (#238) - Medium - Neetcode
Longest Consecutive Sequence (#128) - Medium - Neetcode

Two Pointers (5)

Valid Palindrome (#125) - Easy - Neetcode
3Sum (#15) - Medium - Neetcode
Container With Most Water (#11) - Medium - Neetcode
Trapping Rain Water (#42) - Hard - Neetcode
Two Sum II - Input Array Is Sorted (#167) - Medium - Neetcode

Sliding Window (5)

Best Time to Buy and Sell Stock (#121) - Easy - Neetcode
Longest Substring Without Repeating Characters (#3) - Medium - Neetcode
Longest Repeating Character Replacement (#424) - Medium - Neetcode
Permutation in String (#567) - Medium - Neetcode
Minimum Window Substring (#76) - Hard - Neetcode

Stack (5)

Valid Parentheses (#20) - Easy - Neetcode
Min Stack (#155) - Medium - Neetcode
Generate Parentheses (#22) - Medium - Neetcode
Daily Temperatures (#739) - Medium - Neetcode
Largest Rectangle in Histogram (#84) - Hard - Neetcode

Binary Search (5)

Binary Search (#704) - Easy - Neetcode
Search a 2D Matrix (#74) - Medium - Neetcode
Find Minimum in Rotated Sorted Array (#153) - Medium - Neetcode
Search in Rotated Sorted Array (#33) - Medium - Neetcode
Median of Two Sorted Arrays (#4) - Hard - Neetcode

Linked List (5)

Reverse Linked List (#206) - Easy - Neetcode
Merge Two Sorted Lists (#21) - Easy - Neetcode
Reorder List (#143) - Medium - Neetcode
LRU Cache (#146) - Medium - Neetcode
Merge k Sorted Lists (#23) - Hard - Neetcode

Trees (7)

Invert Binary Tree (#226) - Easy - Neetcode
Maximum Depth of Binary Tree (#104) - Easy - Neetcode
Binary Tree Level Order Traversal (#102) - Medium - Neetcode
Lowest Common Ancestor of a Binary Tree (#236) - Medium - Neetcode
Binary Tree Maximum Path Sum (#124) - Hard - Neetcode
Validate Binary Search Tree (#98) - Medium - Neetcode
Serialize and Deserialize Binary Tree (#297) - Hard - Neetcode

Tries (3)

Implement Trie (Prefix Tree) (#208) - Medium - Neetcode
Design Add and Search Words Data Structure (#211) - Medium - Neetcode
Word Search II (#212) - Hard - Neetcode

Heap / Priority Queue (3)

Kth Largest Element in an Array (#215) - Medium - Neetcode
Task Scheduler (#621) - Medium - Neetcode
Find Median from Data Stream (#295) - Hard - Neetcode

Backtracking (3)

Subsets (#78) - Medium - Neetcode
Combination Sum (#39) - Medium - Neetcode
Word Search (#79) - Medium - Neetcode

Intervals (4)

Insert Interval (#57) - Medium - Neetcode
Merge Intervals (#56) - Medium - Neetcode
Non-overlapping Intervals (#435) - Medium - Neetcode
Meeting Rooms II (#253) - Medium - Neetcode

Greedy (3)

Jump Game (#55) - Medium - Neetcode
Jump Game II (#45) - Medium - Neetcode
Gas Station (#134) - Medium - Neetcode

1D Dynamic Programming (13) - Expanded

Climbing Stairs (#70) - Easy - Neetcode
House Robber (#198) - Medium - Neetcode
House Robber II (#213) - Medium - Neetcode
Longest Palindromic Substring (#5) - Medium - Neetcode
Palindromic Substrings (#647) - Medium - Neetcode
Decode Ways (#91) - Medium - Neetcode
Coin Change (#322) - Medium - Neetcode
Maximum Subarray (#53) - Medium - Neetcode
Maximum Product Subarray (#152) - Medium - Neetcode
Word Break (#139) - Medium - Neetcode
Longest Increasing Subsequence (#300) - Medium - Neetcode
Partition Equal Subset Sum (#416) - Medium - Neetcode
Combination Sum IV (#377) - Medium - Neetcode

2D Dynamic Programming (7) - Expanded

Unique Paths (#62) - Medium - Neetcode
Longest Common Subsequence (#1143) - Medium - Neetcode
Best Time to Buy and Sell Stock with Cooldown (#309) - Medium - Neetcode
Edit Distance (#72) - Medium - Neetcode
Target Sum (#494) - Medium - Neetcode
Interleaving String (#97) - Medium - Neetcode
Coin Change II (#518) - Medium - Neetcode

Graphs (15) - Expanded

Number of Islands (#200) - Medium - Neetcode
Clone Graph (#133) - Medium - Neetcode
Pacific Atlantic Water Flow (#417) - Medium - Neetcode
Course Schedule (#207) - Medium - Neetcode
Course Schedule II (#210) - Medium - Neetcode
Graph Valid Tree (#261) - Medium - Neetcode
Number of Connected Components (#323) - Medium - Neetcode
Word Ladder (#127) - Hard - Neetcode
Network Delay Time (#743) - Medium - Neetcode
Redundant Connection (#684) - Medium - Neetcode
Rotting Oranges (#994) - Medium - Neetcode
Surrounded Regions (#130) - Medium - Neetcode
Alien Dictionary (#269) - Hard - Neetcode
Cheapest Flights Within K Stops (#787) - Medium - Neetcode
Evaluate Division (#399) - Medium - Neetcode

Design & Bit Manipulation (5)

Design Twitter (#355) - Medium - Neetcode
Design Browser History (#1472) - Medium - Neetcode
Single Number (#136) - Easy - Neetcode
Counting Bits (#338) - Easy - Neetcode
Number of 1 Bits (#191) - Easy - Neetcode

Medium Priority List (45 Problems) - Google Focus
1. Additional Arrays & Hashing (6)

Insert Delete GetRandom O(1) (#380) - Medium - Neetcode
Find All Duplicates in an Array (#442) - Medium - Neetcode
First Missing Positive (#41) - Hard - Neetcode
Find the Duplicate Number (#287) - Medium - Neetcode
Set Matrix Zeroes (#73) - Medium - Neetcode
Rotate Image (#48) - Medium - Neetcode

2. Additional Two Pointers & Sliding Window (5)

Next Permutation (#31) - Medium - Neetcode
3Sum Closest (#16) - Medium - Neetcode
Sort Colors (#75) - Medium - Neetcode
Reverse Words in a String (#151) - Medium - Neetcode
Find All Anagrams in a String (#438) - Medium - Neetcode

3. Additional Stack & Binary Search (5)

Basic Calculator (#224) - Hard - Neetcode
Sum of Subarray Minimums (#907) - Medium - Neetcode
Decode String (#394) - Medium - Neetcode
Find First and Last Position of Element in Sorted Array (#34) - Medium - Neetcode
Split Array Largest Sum (#410) - Hard - Neetcode

4. Additional Linked List & Trees (7)

Reverse Nodes in k-Group (#25) - Hard - Neetcode
Linked List Cycle II (#142) - Medium - Neetcode
Odd Even Linked List (#328) - Medium - Neetcode
Construct Binary Tree from Preorder and Inorder Traversal (#105) - Medium - Neetcode
Binary Tree Right Side View (#199) - Medium - Neetcode
Kth Smallest Element in a BST (#230) - Medium - Neetcode
House Robber III (#337) - Medium - Neetcode

5. Additional Dynamic Programming (12)

Longest Increasing Path in a Matrix (#329) - Hard - Neetcode
Distinct Subsequences (#115) - Hard - Neetcode
Regular Expression Matching (#10) - Hard - Neetcode
Minimum Path Sum (#64) - Medium - Neetcode
Maximal Square (#221) - Medium - Neetcode
Wildcard Matching (#44) - Hard - Neetcode
Best Time to Buy and Sell Stock III (#123) - Hard - Neetcode
Burst Balloons (#312) - Hard - Neetcode
Best Time to Buy and Sell Stock IV (#188) - Hard
Minimum Cost to Cut a Stick (#1547) - Hard
Cherry Pickup II (#1463) - Hard
Minimum Cost For Tickets (#983) - Medium

6. Additional Graphs & Design (10)

Accounts Merge (#721) - Medium - Neetcode
Min Cost to Connect All Points (#1584) - Medium - Neetcode
Reconstruct Itinerary (#332) - Hard - Neetcode
Is Graph Bipartite? (#785) - Medium - Neetcode
Number of Provinces (#547) - Medium
Open the Lock (#752) - Medium - Neetcode
Bus Routes (#815) - Hard - Neetcode
LFU Cache (#460) - Hard - Neetcode
Design File System (#1166) - Medium
Design Search Autocomplete System (#642) - Hard

High-Medium Priority (35 Problems) - Advanced Google Focus
1. Advanced Greedy & Interval Problems (7)

Hand of Straights (#846) - Medium - Neetcode
Candy (#135) - Hard - Neetcode
Partition Labels (#763) - Medium
Minimum Number of Refueling Stops (#871) - Hard
Minimum Number of Arrows to Burst Balloons (#452) - Medium - Neetcode
Car Fleet (#853) - Medium - Neetcode
Remove Covered Intervals (#1288) - Medium

2. Advanced Graph Problems (10)

Swim in Rising Water (#778) - Hard
Making A Large Island (#827) - Hard
Minimum Height Trees (#310) - Medium - Neetcode
Find the City With the Smallest Number of Neighbors (#1334) - Medium
Critical Connections in a Network (#1192) - Hard
Path with Maximum Minimum Value (#1102) - Medium
Shortest Path in a Grid with Obstacles Elimination (#1293) - Hard
Shortest Path to Get All Keys (#864) - Hard
Connecting Cities With Minimum Cost (#1135) - Medium
Reachable Nodes In Subdivided Graph (#882) - Hard

3. Advanced Dynamic Programming & Hard Problems (18)

Stone Game (#877) - Medium
Longest Arithmetic Subsequence (#1027) - Medium
Palindrome Partitioning II (#132) - Hard
Minimum Falling Path Sum (#931) - Medium
Number of Ways to Stay in the Same Place After Some Steps (#1269) - Hard
Count Square Submatrices with All Ones (#1277) - Medium
Number of Dice Rolls With Target Sum (#1155) - Medium
Profitable Schemes (#879) - Hard
Frog Jump (#403) - Hard
Student Attendance Record II (#552) - Hard
Trapping Rain Water II (#407) - Hard
Text Justification (#68) - Hard
Sudoku Solver (#37) - Hard - Neetcode
Robot Room Cleaner (#489) - Hard
Design Underground System (#1396) - Medium - Neetcode
Snapshot Array (#1146) - Medium
Sum of Two Integers (#371) - Medium - Neetcode
Sliding Puzzle (#773) - Hard
`;
    
    problems = parseProblems(sampleData);
    
    // Initialize the app with data
    initializeApp();
}

// Parse the problem text into structured data
function parseProblems(text) {
    const lines = text.split('\n');
    const parsedProblems = [];
    
    let currentCategory = '';
    let currentPriority = 'High';
    let inNumberedList = false;
    let currentSection = '';
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // Skip empty lines
        if (line === '') continue;
        
        // Check for priority headers
        if (line.includes('High Priority List')) {
            currentPriority = 'High';
            inNumberedList = false;
            continue;
        } else if (line.includes('Medium Priority List')) {
            currentPriority = 'Medium';
            inNumberedList = false;
            continue;
        } else if (line.includes('High-Medium Priority')) {
            currentPriority = 'High-Medium';
            inNumberedList = false;
            continue;
        }
        
        // Check for numbered sections (like "1. Additional Arrays & Hashing")
        const numberedSectionMatch = line.match(/^\d+\.\s+(.*?)(?:\s+\(\d+\))?$/);
        if (numberedSectionMatch) {
            currentSection = numberedSectionMatch[1].trim();
            inNumberedList = true;
            continue;
        }
        
        // Check for category headers
        const categoryMatch = line.match(/^([^(]+?)(?:\s+\((\d+)\))?(?:\s+-\s+.*)?$/);
        if (categoryMatch && !line.includes('(#') && !line.includes('Priority') && line.length > 0) {
            // This is a category header
            if (inNumberedList) {
                // If we're in a numbered list, prepend the section name
                currentCategory = currentSection + ': ' + categoryMatch[1].trim();
            } else {
                currentCategory = categoryMatch[1].trim();
            }
            continue;
        }
        
        // Check for problem lines with LeetCode numbers
        const problemMatch = line.match(/([^(]+)\s*\(#(\d+)\)\s*-\s*(Easy|Medium|Hard)/);
        
        if (problemMatch) {
            const problemName = problemMatch[1].trim();
            const problemNumber = problemMatch[2];
            const difficulty = problemMatch[3];
            
            // Extract Neetcode tag if present
            const isNeetcode = line.includes('Neetcode');
            
            // Generate slug for LeetCode URL
            const slug = problemName.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^a-z0-9-]/g, '');
            
            parsedProblems.push({
                id: parsedProblems.length + 1,
                problem: problemName,
                number: problemNumber,
                category: currentCategory,
                difficulty: difficulty,
                priority: currentPriority,
                status: 'Not Started',
                lastAttempt: '',
                notes: isNeetcode ? 'Neetcode' : '',
                leetCodeUrl: `https://leetcode.com/problems/${slug}/`,
                completedDate: null,
                revisionDates: []
            });
        }
    }
    
    return parsedProblems;
}

// Initialize the app with data
function initializeApp() {
    // Extract unique categories, difficulties, priorities
    updateFilters();
    
    // Apply initial filtering
    applyFilters();
    
    // Update stats
    updateStats();
    
    // Render the problems table
    renderProblemsTable();
    
    // Render analytics
    renderAnalytics();
    
    // Generate initial study plan
    updateProblemsPerDay();
    if (document.getElementById('generate-plan')) {
        generateStudyPlan();
    }
}

// Update filter dropdowns
function updateFilters() {
    if (!problems || problems.length === 0) return;
    
    // Get unique categories
    const uniqueCategories = [...new Set(problems.map(p => p.category))];
    const categoryFilter = document.getElementById('category-filter');
    
    if (!categoryFilter) return;
    
    // Clear existing options (except "All")
    while (categoryFilter.options.length > 1) {
        categoryFilter.remove(1);
    }
    
    // Add category options
    uniqueCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryFilter.appendChild(option);
    });
    
    // Get unique difficulties
    const uniqueDifficulties = [...new Set(problems.map(p => p.difficulty))];
    const difficultyFilter = document.getElementById('difficulty-filter');
    
    // Clear existing options (except "All")
    while (difficultyFilter.options.length > 1) {
        difficultyFilter.remove(1);
    }
    
    // Add difficulty options
    uniqueDifficulties.forEach(difficulty => {
        const option = document.createElement('option');
        option.value = difficulty;
        option.textContent = difficulty;
        difficultyFilter.appendChild(option);
    });
    
    // Get unique priorities
    const uniquePriorities = [...new Set(problems.map(p => p.priority))];
    const priorityFilter = document.getElementById('priority-filter');
    
    // Clear existing options (except "All")
    while (priorityFilter.options.length > 1) {
        priorityFilter.remove(1);
    }
    
    // Add priority options
    uniquePriorities.forEach(priority => {
        const option = document.createElement('option');
        option.value = priority;
        option.textContent = priority;
        priorityFilter.appendChild(option);
    });
    
    // Save categories for study plan
    categories = uniqueCategories;
}

// Handle filter changes
function handleFilterChange() {
    // Update filter values
    filters.search = document.getElementById('search-input').value.toLowerCase();
    filters.category = document.getElementById('category-filter').value;
    filters.difficulty = document.getElementById('difficulty-filter').value;
    filters.priority = document.getElementById('priority-filter').value;
    
    // Apply filters
    applyFilters();
    
    // Reset to first page
    currentPage = 0;
    
    // Render the updated table
    renderProblemsTable();
}

// Apply filters to problems
function applyFilters() {
    filteredProblems = [...problems];
    
    // Apply search filter
    if (filters.search) {
        filteredProblems = filteredProblems.filter(item => 
            item.problem.toLowerCase().includes(filters.search) ||
            item.number.toString().includes(filters.search) ||
            item.category.toLowerCase().includes(filters.search)
        );
    }
    
    // Apply category filter
    if (filters.category !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.category === filters.category);
    }
    
    // Apply difficulty filter
    if (filters.difficulty !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.difficulty === filters.difficulty);
    }
    
    // Apply priority filter
    if (filters.priority !== 'All') {
        filteredProblems = filteredProblems.filter(item => item.priority === filters.priority);
    }
}

// Update statistics
function updateStats() {
    stats.total = problems.length;
    stats.completed = problems.filter(p => p.status === 'Complete').length;
    stats.needsRevision = problems.filter(p => p.status === 'Needs Revision').length;
    stats.notStarted = stats.total - stats.completed - stats.needsRevision;
    
    // Update the stats UI
    document.getElementById('stat-total').textContent = stats.total;
    document.getElementById('stat-completed').textContent = stats.completed;
    document.getElementById('stat-needs-revision').textContent = stats.needsRevision;
    document.getElementById('stat-not-started').textContent = stats.notStarted;
}

// Render the problems table
function renderProblemsTable() {
    const tableBody = document.getElementById('problems-table-body');
    
    if (!tableBody) return;
    
    // Clear the table
    tableBody.innerHTML = '';
    
    // Calculate pagination
    const totalPages = Math.ceil(filteredProblems.length / rowsPerPage);
    const startIndex = currentPage * rowsPerPage;
    const endIndex = Math.min(startIndex + rowsPerPage, filteredProblems.length);
    const paginatedProblems = filteredProblems.slice(startIndex, endIndex);
    
    // Render problems
    paginatedProblems.forEach((problem, index) => {
        const row = document.createElement('tr');
        
        // ID column
        const idCell = document.createElement('td');
        idCell.textContent = problem.id;
        row.appendChild(idCell);
        
        // Problem column
        const problemCell = document.createElement('td');
        const problemLink = document.createElement('a');
        problemLink.href = problem.leetCodeUrl;
        problemLink.target = '_blank';
        problemLink.rel = 'noopener noreferrer';
        problemLink.textContent = problem.problem;
        problemCell.appendChild(problemLink);
        row.appendChild(problemCell);
        
        // Category column
        const categoryCell = document.createElement('td');
        categoryCell.textContent = problem.category;
        row.appendChild(categoryCell);
        
        // Difficulty column
        const difficultyCell = document.createElement('td');
        difficultyCell.classList.add(problem.difficulty.toLowerCase());
        difficultyCell.textContent = problem.difficulty;
        row.appendChild(difficultyCell);
        
        // Priority column
        const priorityCell = document.createElement('td');
        priorityCell.textContent = problem.priority;
        row.appendChild(priorityCell);
        
        // Last Attempt column
        const lastAttemptCell = document.createElement('td');
        lastAttemptCell.textContent = problem.lastAttempt || '-';
        row.appendChild(lastAttemptCell);
        
        // Actions column
        const actionsCell = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.style.display = 'flex';
        actionsDiv.style.gap = '4px';
        
        // Complete button
        const completeBtn = document.createElement('button');
        completeBtn.classList.add('icon-button');
        completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
        completeBtn.title = 'Mark Complete';
        completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
        actionsDiv.appendChild(completeBtn);
        
        // Needs Revision button
        const needsRevisionBtn = document.createElement('button');
        needsRevisionBtn.classList.add('icon-button');
        needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
        needsRevisionBtn.title = 'Mark Needs Revision';
        needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
        actionsDiv.appendChild(needsRevisionBtn);
        
        // Code button
        const codeBtn = document.createElement('a');
        codeBtn.classList.add('icon-button');
        codeBtn.href = problem.leetCodeUrl + 'description/';
        codeBtn.target = '_blank';
        codeBtn.rel = 'noopener noreferrer';
        codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
        codeBtn.title = 'View Problem Code';
        actionsDiv.appendChild(codeBtn);
        
        actionsCell.appendChild(actionsDiv);
        row.appendChild(actionsCell);
        
        tableBody.appendChild(row);
    });
    
    // Update pagination info
    const paginationInfo = document.getElementById('pagination-info');
    const pageInfo = document.getElementById('page-info');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    if (paginationInfo && pageInfo && prevPageBtn && nextPageBtn) {
        paginationInfo.textContent = `Showing ${startIndex + 1}-${endIndex} of ${filteredProblems.length}`;
        pageInfo.textContent = `${currentPage + 1} / ${Math.max(1, totalPages)}`;
        
        // Update pagination buttons
        prevPageBtn.classList.toggle('btn-disabled', currentPage === 0);
        prevPageBtn.classList.toggle('btn-primary', currentPage > 0);
        nextPageBtn.classList.toggle('btn-disabled', currentPage >= totalPages - 1);
        nextPageBtn.classList.toggle('btn-primary', currentPage < totalPages - 1);
    }
}

// Update problem status
function updateProblemStatus(id, status) {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    problems = problems.map(problem => {
        if (problem.id === id) {
            const updatedProblem = {
                ...problem, 
                status, 
                lastAttempt: status !== 'Not Started' ? today.toLocaleDateString() : ''
            };
            
            if (status === 'Complete') {
                updatedProblem.completedDate = today;
                const firstRevisionEl = document.getElementById('first-revision');
                const secondRevisionEl = document.getElementById('second-revision');
                
                if (firstRevisionEl && secondRevisionEl) {
                    updatedProblem.revisionDates = [
                        new Date(today.getTime() + parseInt(firstRevisionEl.value) * 24 * 60 * 60 * 1000),
                        new Date(today.getTime() + parseInt(secondRevisionEl.value) * 24 * 60 * 60 * 1000)
                    ];
                } else {
                    // Default revision dates if elements don't exist
                    updatedProblem.revisionDates = [
                        new Date(today.getTime() + 5 * 24 * 60 * 60 * 1000),
                        new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000)
                    ];
                }
            }
            
            return updatedProblem;
        }
        return problem;
    });
    
    // Update stats
    updateStats();
    
    // Re-apply filters and render
    applyFilters();
    renderProblemsTable();
    
    // Update analytics
    renderAnalytics();
    
    // Update planner
    renderTodayProblems();
    renderPendingProblems();
    renderRevisionProblems();
    
    // Save to Firebase
    saveUserData();
}

// Generate study plan
function generateStudyPlan() {
    const planDaysEl = document.getElementById('plan-days');
    const problemsPerDayEl = document.getElementById('problems-per-day');
    
    if (!planDaysEl || !problemsPerDayEl) return;
    
    const numDays = parseInt(planDaysEl.value) || 30;
    const problemsPerDay = parseInt(problemsPerDayEl.value) || 3;
    
    // Get selected priorities
    const selectedPriorities = [];
    const highEl = document.getElementById('priority-high');
    const highMediumEl = document.getElementById('priority-high-medium');
    const mediumEl = document.getElementById('priority-medium');
    
    if (highEl && highEl.checked) selectedPriorities.push('High');
    if (highMediumEl && highMediumEl.checked) selectedPriorities.push('High-Medium');
    if (mediumEl && mediumEl.checked) selectedPriorities.push('Medium');
    
    // Create a date object for today
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // Create a new plan
    studyPlan = [];
    
    // Get problems that are not started or in progress and match selected priorities
    const availableProblems = problems.filter(p => 
        (p.status === 'Not Started' || p.status === 'In Progress') &&
        selectedPriorities.includes(p.priority)
    );
    
    // Sort by priority (High first, then High-Medium, then Medium)
    // Within each priority, sort by difficulty (Easy first)
    const sortedProblems = [...availableProblems].sort((a, b) => {
        // First by priority
        const priorityOrder = { 'High': 0, 'High-Medium': 1, 'Medium': 2 };
        const priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];
        
        if (priorityDiff !== 0) return priorityDiff;
        
        // Then by status (In Progress first)
        if (a.status === 'In Progress' && b.status !== 'In Progress') return -1;
        if (a.status !== 'In Progress' && b.status === 'In Progress') return 1;
        
        // Then by difficulty
        const difficultyOrder = { 'Easy': 0, 'Medium': 1, 'Hard': 2 };
        return difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty];
    });
    
    // Assign problems to days
    let problemIndex = 0;
    
    for (let i = 0; i < numDays; i++) {
        const planDate = new Date(today);
        planDate.setDate(today.getDate() + i);
        planDate.setHours(0, 0, 0, 0);
        
        const dayProblems = [];
        
        // Add problems for this day
        for (let j = 0; j < problemsPerDay; j++) {
            if (problemIndex < sortedProblems.length) {
                dayProblems.push(sortedProblems[problemIndex]);
                problemIndex++;
            }
        }
        
        // Skip days with no problems
        if (dayProblems.length === 0) continue;
        
        // Determine categories for this day
        const dayCategories = [...new Set(dayProblems.map(p => p.category))];
        
        // Add to study plan
        studyPlan.push({
            day: i,
            date: planDate,
            problems: dayProblems,
            categories: dayCategories,
            focus: dayCategories.join(', ')
        });
    }
    
    // Save to Firebase
    saveUserData();
    
    // Update planner UI
    renderTodayProblems();
    renderPendingProblems();
    renderRevisionProblems();
}

// Create a problem list item
function createProblemItem(problem) {
    const item = document.createElement('li');
    item.className = 'problem-item';
    
    const problemInfo = document.createElement('div');
    problemInfo.className = 'problem-info';
    
    const problemTitle = document.createElement('div');
    problemTitle.className = 'problem-title';
    const problemLink = document.createElement('a');
    problemLink.href = problem.leetCodeUrl;
    problemLink.target = '_blank';
    problemLink.rel = 'noopener noreferrer';
    problemLink.textContent = problem.problem;
    problemTitle.appendChild(problemLink);
    problemInfo.appendChild(problemTitle);
    
    const problemMeta = document.createElement('div');
    problemMeta.className = 'problem-meta';
    problemMeta.innerHTML = `
        ${problem.category} - 
        <span class="${problem.difficulty.toLowerCase()}">${problem.difficulty}</span>
        ${problem.status !== 'Not Started' ? 
            `<span class="status-badge">
            <span class="status-dot status-${problem.status.toLowerCase().replace(' ', '-')}"></span>
            ${problem.status}
            </span>` : ''}
    `;
    problemInfo.appendChild(problemMeta);
    
    item.appendChild(problemInfo);
    
    const problemActions = document.createElement('div');
    problemActions.className = 'problem-actions';
    
    // Complete button
    const completeBtn = document.createElement('button');
    completeBtn.className = 'icon-button';
    completeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--green);"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    completeBtn.title = 'Mark Complete';
    completeBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Complete'));
    problemActions.appendChild(completeBtn);
    
    // Needs Revision button
    const needsRevisionBtn = document.createElement('button');
    needsRevisionBtn.className = 'icon-button';
    needsRevisionBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--orange);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>';
    needsRevisionBtn.title = 'Mark Needs Revision';
    needsRevisionBtn.addEventListener('click', () => updateProblemStatus(problem.id, 'Needs Revision'));
    problemActions.appendChild(needsRevisionBtn);
    
    // Code button
    const codeBtn = document.createElement('a');
    codeBtn.className = 'icon-button';
    codeBtn.href = problem.leetCodeUrl + 'description/';
    codeBtn.target = '_blank';
    codeBtn.rel = 'noopener noreferrer';
    codeBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--blue);"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>';
    codeBtn.title = 'View Problem Code';
    problemActions.appendChild(codeBtn);
    
    item.appendChild(problemActions);
    
    return item;
}

// Render today's problems
function renderTodayProblems() {
    const todayContainer = document.getElementById('today-problems');
    if (!todayContainer) return;
    
    todayContainer.innerHTML = '';
    
    // Find today's date in the study plan
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    let todayProblems = [];
    
    // Check if there's a study plan day for today
    const todayPlan = studyPlan.find(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        return planDate.getTime() === today.getTime();
    });
    
    if (todayPlan) {
        todayProblems = todayPlan.problems;
    }
    
    if (todayProblems.length > 0) {
        todayProblems.forEach(problem => {
            const problemItem = createProblemItem(problem);
            todayContainer.appendChild(problemItem);
        });
    } else {
        todayContainer.innerHTML = '<div class="problem-item">No problems scheduled for today.</div>';
    }
}

// Render pending problems
function renderPendingProblems() {
    const pendingContainer = document.getElementById('pending-problems');
    if (!pendingContainer) return;
    
    pendingContainer.innerHTML = '';
    
    // Find problems that should have been completed before today but are not
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const pendingProblems = [];
    
    studyPlan.forEach(day => {
        const planDate = new Date(day.date);
        planDate.setHours(0, 0, 0, 0);
        
        if (planDate.getTime() < today.getTime()) {
            // This day is in the past
            day.problems.forEach(problem => {
                if (problem.status === 'Not Started') {
                    pendingProblems.push(problem);
                }
            });
        }
    });
    
    if (pendingProblems.length > 0) {
        pendingProblems.forEach(problem => {
            const problemItem = createProblemItem(problem);
            pendingContainer.appendChild(problemItem);
        });
    } else {
        pendingContainer.innerHTML = '<div class="problem-item">No pending problems. You\'re all caught up!</div>';
    }
}

// Render revision problems
function renderRevisionProblems() {
    const revisionContainer = document.getElementById('revision-problems');
    if (!revisionContainer) return;
    
    revisionContainer.innerHTML = '';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const revisionProblems = problems.filter(problem => {
        if (problem.status === 'Complete' && problem.revisionDates) {
            return problem.revisionDates.some(date => {
                if (!date) return false;
                const revisionDate = new Date(date);
                revisionDate.setHours(0, 0, 0, 0);
                return revisionDate.getTime() === today.getTime();
            });
        }
        return false;
    });
    
    if (revisionProblems.length > 0) {
        revisionProblems.forEach(problem => {
            // Mark as needs revision
            const revisedProblem = {
                ...problem,
                status: 'Needs Revision'
            };
            
            const problemItem = createProblemItem(revisedProblem);
            revisionContainer.appendChild(problemItem);
        });
    } else {
        revisionContainer.innerHTML = '<div class="problem-item">No problems need revision today.</div>';
    }
}

// Render analytics
function renderAnalytics() {
    renderCategoryProgress();
    renderDifficultyProgress();
    renderPriorityProgress();
    renderEstimatedCompletion();
}

// Render category progress
function renderCategoryProgress() {
    const categoryContainer = document.getElementById('category-progress');
    if (!categoryContainer) return;
    
    categoryContainer.innerHTML = '';
    
    // Calculate category stats
    const categoryStats = {};
    
    categories.forEach(category => {
        const problemsInCategory = problems.filter(p => p.category === category);
        const completed = problemsInCategory.filter(p => p.status === 'Complete').length;
        
        categoryStats[category] = {
            total: problemsInCategory.length,
            completed: completed,
            percentage: problemsInCategory.length > 0 
                ? Math.round((completed / problemsInCategory.length) * 100) 
                : 0
        };
    });
    
    // Render progress bars
    Object.entries(categoryStats).forEach(([category, stats]) => {
        const progressContainer = document.createElement('div');
        progressContainer.className = 'progress-container';
        
        const progressHeader = document.createElement('div');
        progressHeader.className = 'progress-header';
        
        const categoryLabel = document.createElement('span');
        categoryLabel.textContent = category;
        progressHeader.appendChild(categoryLabel);
        
        const statsLabel = document.createElement('span');
        statsLabel.textContent = `${stats.completed}/${stats.total} (${stats.percentage}%)`;
        progressHeader.appendChild(statsLabel);
        
        progressContainer.appendChild(progressHeader);
        
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        
        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = `${stats.percentage}%`;
        progressBar.appendChild(progressFill);
        
        progressContainer.appendChild(progressBar);
        categoryContainer.appendChild(progressContainer);
    });
}

// Render difficulty progress
function renderDifficultyProgress() {
    const difficultyContainer = document.getElementById('difficulty-progress');
    if (!difficultyContainer) return;
    
    difficultyContainer.innerHTML = '';
    
    // Calculate difficulty stats
    const difficulties = ['Easy', 'Medium', 'Hard'];
    const difficultyStats = {};
    
    difficulties.forEach(difficulty => {
        const problemsWithDifficulty = problems.filter(p => p.difficulty === difficulty);
        const completed = problemsWithDifficulty.filter(p => p.status === 'Complete').length;
        
        difficultyStats[difficulty] = {
            total: problemsWithDifficulty.length,
            completed: completed,
            percentage: problemsWithDifficulty.length > 0 
                ? Math.round((completed / problemsWithDifficulty.length) * 100) 
                : 0
        };
    });
    
    // Render progress bars
    Object.entries(difficultyStats).forEach(([difficulty, stats]) => {
        const progressContainer = document.createElement('div');
        progressContainer.className = 'progress-container';
        
        const progressHeader = document.createElement('div');
        progressHeader.className = 'progress-header';
        
        const difficultyLabel = document.createElement('span');
        difficultyLabel.textContent = difficulty;
        difficultyLabel.className = difficulty.toLowerCase();
        progressHeader.appendChild(difficultyLabel);
        
        const statsLabel = document.createElement('span');
        statsLabel.textContent = `${stats.completed}/${stats.total} (${stats.percentage}%)`;
        progressHeader.appendChild(statsLabel);
        
        progressContainer.appendChild(progressHeader);
        
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        
        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = `${stats.percentage}%`;
        
        // Set color based on difficulty
        if (difficulty === 'Easy') {
            progressFill.style.backgroundColor = 'var(--green)';
        } else if (difficulty === 'Medium') {
            progressFill.style.backgroundColor = 'var(--yellow)';
        } else {
            progressFill.style.backgroundColor = 'var(--red)';
        }
        
        progressBar.appendChild(progressFill);
        
        progressContainer.appendChild(progressBar);
        difficultyContainer.appendChild(progressContainer);
    });
}

// Render priority progress
function renderPriorityProgress() {
    const priorityContainer = document.getElementById('priority-progress');
    if (!priorityContainer) return;
    
    priorityContainer.innerHTML = '';
    
    // Calculate priority stats
    const priorities = ['High', 'High-Medium', 'Medium'];
    const priorityStats = {};
    
    priorities.forEach(priority => {
        const problemsWithPriority = problems.filter(p => p.priority === priority);
        const completed = problemsWithPriority.filter(p => p.status === 'Complete').length;
        
        priorityStats[priority] = {
            total: problemsWithPriority.length,
            completed: completed,
            percentage: problemsWithPriority.length > 0 
                ? Math.round((completed / problemsWithPriority.length) * 100) 
                : 0
        };
    });
    
    // Render progress bars
    Object.entries(priorityStats).forEach(([priority, stats]) => {
        const progressContainer = document.createElement('div');
        progressContainer.className = 'progress-container';
        
        const progressHeader = document.createElement('div');
        progressHeader.className = 'progress-header';
        
        const priorityLabel = document.createElement('span');
        priorityLabel.textContent = `${priority} Priority (${stats.total})`;
        progressHeader.appendChild(priorityLabel);
        
        const statsLabel = document.createElement('span');
        statsLabel.textContent = `${stats.completed}/${stats.total} (${stats.percentage}%)`;
        progressHeader.appendChild(statsLabel);
        
        progressContainer.appendChild(progressHeader);
        
        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        
        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = `${stats.percentage}%`;
        
        // Set color based on priority
        if (priority === 'High') {
            progressFill.style.backgroundColor = 'var(--red)';
        } else if (priority === 'High-Medium') {
            progressFill.style.backgroundColor = 'var(--orange)';
        } else {
            progressFill.style.backgroundColor = 'var(--yellow)';
        }
        
        progressBar.appendChild(progressFill);
        
        progressContainer.appendChild(progressBar);
        priorityContainer.appendChild(progressContainer);
    });
}

// Render estimated completion
function renderEstimatedCompletion() {
    const overallProgressPercentage = document.getElementById('overall-progress-percentage');
    const overallProgressBar = document.getElementById('overall-progress-bar');
    const estimatedDaysEl = document.getElementById('estimated-days');
    const statusCompletePercentage = document.getElementById('status-complete-percentage');
    const statusNeedsRevisionPercentage = document.getElementById('status-needs-revision-percentage');
    const statusNotStartedPercentage = document.getElementById('status-not-started-percentage');
    
    if (!overallProgressPercentage || !overallProgressBar) return;
    
    // Calculate overall progress
    const completionPercentage = Math.round((stats.completed / stats.total) * 100);
    
    // Update progress bar
    overallProgressPercentage.textContent = `${completionPercentage}%`;
    overallProgressBar.style.width = `${completionPercentage}%`;
    
    // Calculate estimated days remaining
    let estimatedDays = "N/A (no progress yet)";
    const problemsPerDayEl = document.getElementById('problems-per-day');
    
    if (problemsPerDayEl) {
        const problemsPerDay = parseInt(problemsPerDayEl.value) || 3;
        
        if (stats.completed > 0 && problemsPerDay > 0) {
            const remainingProblems = stats.total - stats.completed;
            const days = Math.ceil(remainingProblems / problemsPerDay);
            estimatedDays = `${days} days remaining (${problemsPerDay} problems/day)`;
        }
    }
    
    if (estimatedDaysEl) {
        estimatedDaysEl.textContent = `Est. ${estimatedDays}`;
    }
    
    // Update status breakdown percentages
    if (statusCompletePercentage) {
        statusCompletePercentage.textContent = `${Math.round((stats.completed / stats.total) * 100)}%`;
    }
    
    if (statusNeedsRevisionPercentage) {
        statusNeedsRevisionPercentage.textContent = `${Math.round((stats.needsRevision / stats.total) * 100)}%`;
    }
    
    if (statusNotStartedPercentage) {
        statusNotStartedPercentage.textContent = `${Math.round((stats.notStarted / stats.total) * 100)}%`;
    }
}
    </script>
</body>
</html>
